{"title":"drf视图类 - APIView基类","slug":"django/4-drf 基于类的视图 (CBV)/APIView","date":"2021-01-18T10:34:55.626Z","updated":"2021-01-21T15:25:42.336Z","comments":true,"path":"api/articles/django/4-drf 基于类的视图 (CBV)/APIView.json","excerpt":null,"covers":null,"content":"<p>APIView是REST framework提供的所有视图的基类，继承自Django的View父类。</p>\n<p>APIView与View的不同之处在于</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">1</span> <span class=\"string\">&quot;request&quot;</span>:</span><br><span class=\"line\">    传入到视图方法中的是REST framework的Request对象，而不是Django的HttpRequeset对象；</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"number\">2</span> <span class=\"string\">&quot;Response&quot;</span>:</span><br><span class=\"line\">    视图方法可以返回REST framework的Response对象,视图会为响应数据设置（render）符合前端要求的格式；</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"number\">3</span> <span class=\"string\">&quot;APIException&quot;</span></span><br><span class=\"line\">    任何APIException异常都会被捕获到，并且处理成合适的响应信息；</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"number\">4</span> <span class=\"string\">&quot;权限控制等类&quot;</span>：</span><br><span class=\"line\">    在进行dispatch()分发前，会对请求进行<span class=\"string\">&quot;身份认证&quot;</span>、<span class=\"string\">&quot;权限检查&quot;</span>、<span class=\"string\">&quot;流量控制&quot;</span>。</span><br><span class=\"line\"></span><br><span class=\"line\">    支持定义的类属性：</span><br><span class=\"line\">        authentication_classes 列表或元祖，身份认证类</span><br><span class=\"line\">        permissoin_classes 列表或元祖，权限检查类</span><br><span class=\"line\">        throttle_classes 列表或元祖，流量控制类</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">特点：</span></span><br><span class=\"line\"><span class=\"string\">    - views</span></span><br><span class=\"line\"><span class=\"string\">        APIVIew内部映射了请求方法</span></span><br><span class=\"line\"><span class=\"string\">            get      获取一条、所有</span></span><br><span class=\"line\"><span class=\"string\">            post     新增</span></span><br><span class=\"line\"><span class=\"string\">            put      更新</span></span><br><span class=\"line\"><span class=\"string\">            patch    </span></span><br><span class=\"line\"><span class=\"string\">            delete   删除</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">        返回：请求对应序列化后的数据</span></span><br><span class=\"line\"><span class=\"string\">            return Response(serializer.data)</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">    - url：CBV</span></span><br><span class=\"line\"><span class=\"string\">        re_path(r&#x27;^students/$&#x27;, views.StudentsAPIView.as_view())</span></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>示例代码</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#view.py</span></span><br><span class=\"line\"><span class=\"keyword\">from</span> rest_framework.views <span class=\"keyword\">import</span> APIView</span><br><span class=\"line\"><span class=\"keyword\">from</span> rest_framework.response <span class=\"keyword\">import</span> Response</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">StudentsAPIView</span>(<span class=\"params\">APIView</span>):</span></span><br><span class=\"line\">    <span class=\"string\">&quot;自定义权限等&quot;</span></span><br><span class=\"line\">    authentication_classes = [...]</span><br><span class=\"line\">    permissoin_classes = [...]</span><br><span class=\"line\">    throttle_classes = [...]</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get</span>(<span class=\"params\">self, request</span>):</span></span><br><span class=\"line\">        data_list = Student.objects.<span class=\"built_in\">all</span>()</span><br><span class=\"line\">        serializer = StudentModelSerializer(instance=data_list, many=<span class=\"literal\">True</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Response(serializer.data)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">post</span>(<span class=\"params\">self, request</span>):</span></span><br><span class=\"line\">        ...</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">put</span>(<span class=\"params\">self, request</span>):</span></span><br><span class=\"line\">        ...</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># url.py</span></span><br><span class=\"line\">re_path(<span class=\"string\">r&#x27;^students/$&#x27;</span>, views.StudentsAPIView.as_view()),</span><br></pre></td></tr></table></figure>","more":"<p>APIView是REST framework提供的所有视图的基类，继承自Django的View父类。</p>\n<p>APIView与View的不同之处在于</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">1</span> <span class=\"string\">&quot;request&quot;</span>:</span><br><span class=\"line\">    传入到视图方法中的是REST framework的Request对象，而不是Django的HttpRequeset对象；</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"number\">2</span> <span class=\"string\">&quot;Response&quot;</span>:</span><br><span class=\"line\">    视图方法可以返回REST framework的Response对象,视图会为响应数据设置（render）符合前端要求的格式；</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"number\">3</span> <span class=\"string\">&quot;APIException&quot;</span></span><br><span class=\"line\">    任何APIException异常都会被捕获到，并且处理成合适的响应信息；</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"number\">4</span> <span class=\"string\">&quot;权限控制等类&quot;</span>：</span><br><span class=\"line\">    在进行dispatch()分发前，会对请求进行<span class=\"string\">&quot;身份认证&quot;</span>、<span class=\"string\">&quot;权限检查&quot;</span>、<span class=\"string\">&quot;流量控制&quot;</span>。</span><br><span class=\"line\"></span><br><span class=\"line\">    支持定义的类属性：</span><br><span class=\"line\">        authentication_classes 列表或元祖，身份认证类</span><br><span class=\"line\">        permissoin_classes 列表或元祖，权限检查类</span><br><span class=\"line\">        throttle_classes 列表或元祖，流量控制类</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">特点：</span></span><br><span class=\"line\"><span class=\"string\">    - views</span></span><br><span class=\"line\"><span class=\"string\">        APIVIew内部映射了请求方法</span></span><br><span class=\"line\"><span class=\"string\">            get      获取一条、所有</span></span><br><span class=\"line\"><span class=\"string\">            post     新增</span></span><br><span class=\"line\"><span class=\"string\">            put      更新</span></span><br><span class=\"line\"><span class=\"string\">            patch    </span></span><br><span class=\"line\"><span class=\"string\">            delete   删除</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">        返回：请求对应序列化后的数据</span></span><br><span class=\"line\"><span class=\"string\">            return Response(serializer.data)</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">    - url：CBV</span></span><br><span class=\"line\"><span class=\"string\">        re_path(r&#x27;^students/$&#x27;, views.StudentsAPIView.as_view())</span></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>示例代码</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#view.py</span></span><br><span class=\"line\"><span class=\"keyword\">from</span> rest_framework.views <span class=\"keyword\">import</span> APIView</span><br><span class=\"line\"><span class=\"keyword\">from</span> rest_framework.response <span class=\"keyword\">import</span> Response</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">StudentsAPIView</span>(<span class=\"params\">APIView</span>):</span></span><br><span class=\"line\">    <span class=\"string\">&quot;自定义权限等&quot;</span></span><br><span class=\"line\">    authentication_classes = [...]</span><br><span class=\"line\">    permissoin_classes = [...]</span><br><span class=\"line\">    throttle_classes = [...]</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get</span>(<span class=\"params\">self, request</span>):</span></span><br><span class=\"line\">        data_list = Student.objects.<span class=\"built_in\">all</span>()</span><br><span class=\"line\">        serializer = StudentModelSerializer(instance=data_list, many=<span class=\"literal\">True</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Response(serializer.data)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">post</span>(<span class=\"params\">self, request</span>):</span></span><br><span class=\"line\">        ...</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">put</span>(<span class=\"params\">self, request</span>):</span></span><br><span class=\"line\">        ...</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># url.py</span></span><br><span class=\"line\">re_path(<span class=\"string\">r&#x27;^students/$&#x27;</span>, views.StudentsAPIView.as_view()),</span><br></pre></td></tr></table></figure>","categories":[{"name":"restful","path":"api/categories/restful.json"},{"name":"django","path":"api/categories/django.json"}],"tags":[{"name":"drf","path":"api/tags/drf.json"},{"name":"django","path":"api/tags/django.json"},{"name":"python","path":"api/tags/python.json"}]}