{"title":"9-1 Flask","slug":"flask/9-1 总结_flask","date":"2021-01-18T11:39:27.130Z","updated":"2021-01-19T08:30:45.014Z","comments":true,"path":"api/articles/flask/9-1 总结_flask.json","excerpt":null,"covers":null,"content":"<meta name=\"referrer\" content=\"no-referrer\"/>\n<h2 id=\"0flask简介\"><a class=\"markdownIt-Anchor\" href=\"#0flask简介\"></a> 0.Flask简介</h2>\n<p>Flask是一个基于Python开发并且依赖jinja2模板和Werkzeug WSGI服务的一个微型框架，对于Werkzeug本质是Socket服务端，其用于接收http请求并对请求进行预处理，然后触发Flask框架，开发人员基于Flask框架提供的功能对请求进行相应的处理，并返回给用户，如果要返回给用户复杂的内容时，需要借助jinja2模板来实现对模板的处理，即：将模板和数据进行渲染，将渲染后的字符串返回给用户浏览器。</p>\n<p>“微”(micro) 并不表示你需要把整个 Web 应用塞进单个 Python 文件（虽然确实可以 ），也不意味着 Flask 在功能上有所欠缺。微框架中的“微”意味着 Flask 旨在保持核心简单而易于扩展。Flask 不会替你做出太多决策——比如使用何种数据库。而那些 Flask 所选择的——比如使用何种模板引擎——则很容易替换。除此之外的一切都由可由你掌握。如此，Flask 可以与您珠联璧合。</p>\n<p>默认情况下，Flask 不包含数据库抽象层、表单验证，或是其它任何已有多种库可以胜任的功能。然而，Flask 支持用扩展来给应用添加这些功能，如同是 Flask 本身实现的一样。众多的扩展提供了数据库集成、表单验证、上传处理、各种各样的开放认证技术等功能。Flask 也许是“微小”的，但它已准备好在需求繁杂的生产环境中投入使用</p>\n<h3 id=\"wsgiref\"><a class=\"markdownIt-Anchor\" href=\"#wsgiref\"></a> wsgiref</h3>\n<p>最简单的Web应用就是先把HTML用文件保存好，用一个现成的HTTP服务器软件，接收用户请求，从文件中读取HTML，返回。</p>\n<p>如果要动态生成HTML，就需要把上述步骤自己来实现。不过，接受HTTP请求、解析HTTP请求、发送HTTP响应都是苦力活，如果我们自己来写这些底层代码，还没开始写动态HTML呢，就得花个把月去读HTTP规范。</p>\n<p>正确的做法是底层代码由专门的服务器软件实现，我们用Python专注于生成HTML文档。因为我们不希望接触到TCP连接、HTTP原始请求和响应格式，所以，需要一个统一的接口协议来实现这样的服务器软件，让我们专心用Python编写Web业务。这个接口就是WSGI：Web Server Gateway Interface。而wsgiref模块就是python基于wsgi协议开发的服务模块</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> wsgiref.simple_server <span class=\"keyword\">import</span> make_server</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">mya</span>(<span class=\"params\">environ, start_response</span>):</span></span><br><span class=\"line\">    print(environ)</span><br><span class=\"line\">    start_response(<span class=\"string\">&#x27;200 OK&#x27;</span>, [(<span class=\"string\">&#x27;Content-Type&#x27;</span>, <span class=\"string\">&#x27;text/html&#x27;</span>)])</span><br><span class=\"line\">    <span class=\"keyword\">if</span> environ.get(<span class=\"string\">&#x27;PATH_INFO&#x27;</span>) == <span class=\"string\">&#x27;/index&#x27;</span>:</span><br><span class=\"line\">        <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(<span class=\"string\">&#x27;index.html&#x27;</span>,<span class=\"string\">&#x27;rb&#x27;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">            data=f.read()</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">elif</span> environ.get(<span class=\"string\">&#x27;PATH_INFO&#x27;</span>) == <span class=\"string\">&#x27;/login&#x27;</span>:</span><br><span class=\"line\">        <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(<span class=\"string\">&#x27;login.html&#x27;</span>, <span class=\"string\">&#x27;rb&#x27;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">            data = f.read()</span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        data=<span class=\"string\">b&#x27;&lt;h1&gt;Hello, web!&lt;/h1&gt;&#x27;</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> [data]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    myserver = make_server(<span class=\"string\">&#x27;&#x27;</span>, <span class=\"number\">8011</span>, mya)</span><br><span class=\"line\">    print(<span class=\"string\">&#x27;监听8010&#x27;</span>)</span><br><span class=\"line\">    myserver.serve_forever()</span><br><span class=\"line\"></span><br><span class=\"line\">wsgiref简单应用</span><br></pre></td></tr></table></figure>\n<h2 id=\"1安装\"><a class=\"markdownIt-Anchor\" href=\"#1安装\"></a> 1.安装</h2>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip3 install flask</span><br></pre></td></tr></table></figure>\n<h2 id=\"2werkzeug简介\"><a class=\"markdownIt-Anchor\" href=\"#2werkzeug简介\"></a> 2.werkzeug简介</h2>\n<p>Werkzeug是一个WSGI工具包，他可以作为一个Web框架的底层库。这里稍微说一下， werkzeug 不是一个web服务器，也不是一个web框架，而是一个工具包，官方的介绍说是一个 WSGI 工具包，它可以作为一个 Web 框架的底层库，因为它封装好了很多 Web 框架的东西，例如 Request，Response 等等</p>\n<p>代码示例：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> werkzeug.wrappers <span class=\"keyword\">import</span> Request, Response</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Request.application</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">hello</span>(<span class=\"params\">request</span>):</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> Response(<span class=\"string\">&#x27;Hello World!&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    <span class=\"keyword\">from</span> werkzeug.serving <span class=\"keyword\">import</span> run_simple</span><br><span class=\"line\">    run_simple(<span class=\"string\">&#x27;localhost&#x27;</span>, <span class=\"number\">4000</span>, hello)</span><br></pre></td></tr></table></figure>\n<h2 id=\"3flask快速使用\"><a class=\"markdownIt-Anchor\" href=\"#3flask快速使用\"></a> 3.flask快速使用</h2>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> Flask</span><br><span class=\"line\"><span class=\"comment\"># 实例化产生一个Flask对象</span></span><br><span class=\"line\">app = Flask(__name__)</span><br><span class=\"line\"><span class=\"comment\"># 将 &#x27;/&#x27;和视图函数hello_workd的对应关系添加到路由中</span></span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&#x27;/&#x27;</span></span>) </span><span class=\"comment\"># 1. v=app.route(&#x27;/&#x27;) 2. v(hello_world)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">hello_world</span>():</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&#x27;Hello World!&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    app.run() <span class=\"comment\"># 最终调用了run_simple()</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"案例登录显示用户信息\"><a class=\"markdownIt-Anchor\" href=\"#案例登录显示用户信息\"></a> 案例：登录，显示用户信息</h3>\n<p><a href=\"http://main.py\">main.py</a></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> Flask,render_template,request,redirect,session,url_for</span><br><span class=\"line\">app = Flask(__name__)</span><br><span class=\"line\">app.debug = <span class=\"literal\">True</span></span><br><span class=\"line\">app.secret_key = <span class=\"string\">&#x27;sdfsdfsdfsdf&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">USERS = &#123;</span><br><span class=\"line\">    <span class=\"number\">1</span>:&#123;<span class=\"string\">&#x27;name&#x27;</span>:<span class=\"string\">&#x27;张三&#x27;</span>,<span class=\"string\">&#x27;age&#x27;</span>:<span class=\"number\">18</span>,<span class=\"string\">&#x27;gender&#x27;</span>:<span class=\"string\">&#x27;男&#x27;</span>,<span class=\"string\">&#x27;text&#x27;</span>:<span class=\"string\">&quot;道路千万条&quot;</span>&#125;,</span><br><span class=\"line\">    <span class=\"number\">2</span>:&#123;<span class=\"string\">&#x27;name&#x27;</span>:<span class=\"string\">&#x27;李四&#x27;</span>,<span class=\"string\">&#x27;age&#x27;</span>:<span class=\"number\">28</span>,<span class=\"string\">&#x27;gender&#x27;</span>:<span class=\"string\">&#x27;男&#x27;</span>,<span class=\"string\">&#x27;text&#x27;</span>:<span class=\"string\">&quot;安全第一条&quot;</span>&#125;,</span><br><span class=\"line\">    <span class=\"number\">3</span>:&#123;<span class=\"string\">&#x27;name&#x27;</span>:<span class=\"string\">&#x27;王五&#x27;</span>,<span class=\"string\">&#x27;age&#x27;</span>:<span class=\"number\">18</span>,<span class=\"string\">&#x27;gender&#x27;</span>:<span class=\"string\">&#x27;女&#x27;</span>,<span class=\"string\">&#x27;text&#x27;</span>:<span class=\"string\">&quot;行车不规范&quot;</span>&#125;,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&#x27;/detail/&lt;int:nid&gt;&#x27;</span>,methods=[<span class=\"string\">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">detail</span>(<span class=\"params\">nid</span>):</span></span><br><span class=\"line\">    user = session.get(<span class=\"string\">&#x27;user_info&#x27;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> user:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> redirect(<span class=\"string\">&#x27;/login&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    info = USERS.get(nid)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> render_template(<span class=\"string\">&#x27;detail.html&#x27;</span>,info=info)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&#x27;/index&#x27;</span>,methods=[<span class=\"string\">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">index</span>():</span></span><br><span class=\"line\">    user = session.get(<span class=\"string\">&#x27;user_info&#x27;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> user:</span><br><span class=\"line\">        <span class=\"comment\"># return redirect(&#x27;/login&#x27;)</span></span><br><span class=\"line\">        url = url_for(<span class=\"string\">&#x27;l1&#x27;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> redirect(url)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> render_template(<span class=\"string\">&#x27;index.html&#x27;</span>,user_dict=USERS)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&#x27;/login&#x27;</span>,methods=[<span class=\"string\">&#x27;GET&#x27;</span>,<span class=\"string\">&#x27;POST&#x27;</span>],endpoint=<span class=\"string\">&#x27;l1&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">login</span>():</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> request.method == <span class=\"string\">&quot;GET&quot;</span>:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> render_template(<span class=\"string\">&#x27;login.html&#x27;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        <span class=\"comment\"># request.query_string</span></span><br><span class=\"line\">        user = request.form.get(<span class=\"string\">&#x27;user&#x27;</span>)</span><br><span class=\"line\">        pwd = request.form.get(<span class=\"string\">&#x27;pwd&#x27;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> user == <span class=\"string\">&#x27;cxw&#x27;</span> <span class=\"keyword\">and</span> pwd == <span class=\"string\">&#x27;123&#x27;</span>:</span><br><span class=\"line\">            session[<span class=\"string\">&#x27;user_info&#x27;</span>] = user</span><br><span class=\"line\">            <span class=\"keyword\">return</span> redirect(<span class=\"string\">&#x27;http://www.baidu.com&#x27;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> render_template(<span class=\"string\">&#x27;login.html&#x27;</span>,error=<span class=\"string\">&#x27;用户名或密码错误&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    app.run()</span><br></pre></td></tr></table></figure>\n<p>detail.html</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Title<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>详细信息 &#123;&#123;info.name&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        &#123;&#123;info.text&#125;&#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>index.html</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Title<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>用户列表<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">table</span>&gt;</span></span><br><span class=\"line\">        &#123;% for k,v in user_dict.items() %&#125;</span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">tr</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>&#123;&#123;k&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>&#123;&#123;v.name&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>&#123;&#123;v[&#x27;name&#x27;]&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>&#123;&#123;v.get(&#x27;name&#x27;)&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;/detail/&#123;&#123;k&#125;&#125;&quot;</span>&gt;</span>查看详细<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">tr</span>&gt;</span></span><br><span class=\"line\">        &#123;% endfor %&#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">table</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>login.html</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Title<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>用户登录<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">form</span> <span class=\"attr\">method</span>=<span class=\"string\">&quot;post&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;user&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;pwd&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;submit&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;登录&quot;</span>&gt;</span>&#123;&#123;error&#125;&#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">form</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"作业登录认证装饰器\"><a class=\"markdownIt-Anchor\" href=\"#作业登录认证装饰器\"></a> 作业：登录认证装饰器</h3>\n<p>-多个装饰器执行顺序</p>\n<p>-反向查找的名称（endpoint），不允许重复</p>\n<h2 id=\"4配置文件\"><a class=\"markdownIt-Anchor\" href=\"#4配置文件\"></a> 4.配置文件</h2>\n<p>flask中的配置文件是一个flask.config.Config对象（继承字典）,默认配置为：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"string\">&#x27;DEBUG&#x27;</span>:                                <span class=\"literal\">False</span>  <span class=\"comment\"># get_debug_flag(default=False),  是否开启Debug模式</span></span><br><span class=\"line\">    <span class=\"string\">&#x27;TESTING&#x27;</span>:                              <span class=\"literal\">False</span>, <span class=\"comment\"># 是否开启测试模式</span></span><br><span class=\"line\">    <span class=\"string\">&#x27;PROPAGATE_EXCEPTIONS&#x27;</span>:                 <span class=\"literal\">None</span>,                          </span><br><span class=\"line\">    <span class=\"string\">&#x27;PRESERVE_CONTEXT_ON_EXCEPTION&#x27;</span>:        <span class=\"literal\">None</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;SECRET_KEY&#x27;</span>:                           <span class=\"literal\">None</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;PERMANENT_SESSION_LIFETIME&#x27;</span>:           timedelta(days=<span class=\"number\">31</span>),</span><br><span class=\"line\">    <span class=\"string\">&#x27;USE_X_SENDFILE&#x27;</span>:                       <span class=\"literal\">False</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;LOGGER_NAME&#x27;</span>:                          <span class=\"literal\">None</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;LOGGER_HANDLER_POLICY&#x27;</span>:               <span class=\"string\">&#x27;always&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;SERVER_NAME&#x27;</span>:                          <span class=\"literal\">None</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;APPLICATION_ROOT&#x27;</span>:                     <span class=\"literal\">None</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;SESSION_COOKIE_NAME&#x27;</span>:                  <span class=\"string\">&#x27;session&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;SESSION_COOKIE_DOMAIN&#x27;</span>:                <span class=\"literal\">None</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;SESSION_COOKIE_PATH&#x27;</span>:                  <span class=\"literal\">None</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;SESSION_COOKIE_HTTPONLY&#x27;</span>:              <span class=\"literal\">True</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;SESSION_COOKIE_SECURE&#x27;</span>:                <span class=\"literal\">False</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;SESSION_REFRESH_EACH_REQUEST&#x27;</span>:         <span class=\"literal\">True</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;MAX_CONTENT_LENGTH&#x27;</span>:                   <span class=\"literal\">None</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;SEND_FILE_MAX_AGE_DEFAULT&#x27;</span>:            timedelta(hours=<span class=\"number\">12</span>),</span><br><span class=\"line\">    <span class=\"string\">&#x27;TRAP_BAD_REQUEST_ERRORS&#x27;</span>:              <span class=\"literal\">False</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;TRAP_HTTP_EXCEPTIONS&#x27;</span>:                 <span class=\"literal\">False</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;EXPLAIN_TEMPLATE_LOADING&#x27;</span>:             <span class=\"literal\">False</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;PREFERRED_URL_SCHEME&#x27;</span>:                 <span class=\"string\">&#x27;http&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;JSON_AS_ASCII&#x27;</span>:                        <span class=\"literal\">True</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;JSON_SORT_KEYS&#x27;</span>:                       <span class=\"literal\">True</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;JSONIFY_PRETTYPRINT_REGULAR&#x27;</span>:          <span class=\"literal\">True</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;JSONIFY_MIMETYPE&#x27;</span>:                     <span class=\"string\">&#x27;application/json&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;TEMPLATES_AUTO_RELOAD&#x27;</span>:                <span class=\"literal\">None</span>,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"方式一\"><a class=\"markdownIt-Anchor\" href=\"#方式一\"></a> 方式一</h3>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app.config[<span class=\"string\">&#x27;DEBUG&#x27;</span>] = <span class=\"literal\">True</span></span><br><span class=\"line\">   PS： 由于Config对象本质上是字典，所以还可以使用app.config.update(...)</span><br></pre></td></tr></table></figure>\n<h3 id=\"方式二\"><a class=\"markdownIt-Anchor\" href=\"#方式二\"></a> 方式二</h3>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#通过py文件配置</span></span><br><span class=\"line\">app.config.from_pyfile(<span class=\"string\">&quot;python文件名称&quot;</span>)</span><br><span class=\"line\">如：</span><br><span class=\"line\">settings.py</span><br><span class=\"line\">DEBUG = <span class=\"literal\">True</span></span><br><span class=\"line\"></span><br><span class=\"line\">app.config.from_pyfile(<span class=\"string\">&quot;settings.py&quot;</span>)</span><br><span class=\"line\"><span class=\"comment\">#通过环境变量配置</span></span><br><span class=\"line\">app.config.from_envvar(<span class=\"string\">&quot;环境变量名称&quot;</span>)</span><br><span class=\"line\"><span class=\"comment\">#app.config.from_pyfile(os.environ[&#x27;YOURAPPLICATION_SETTINGS&#x27;])</span></span><br><span class=\"line\">环境变量的值为python文件名称名称，内部调用from_pyfile方法</span><br><span class=\"line\"></span><br><span class=\"line\">app.config.from_json(<span class=\"string\">&quot;json文件名称&quot;</span>)</span><br><span class=\"line\">JSON文件名称，必须是json格式，因为内部会执行json.loads</span><br><span class=\"line\"></span><br><span class=\"line\">app.config.from_mapping(&#123;<span class=\"string\">&#x27;DEBUG&#x27;</span>: <span class=\"literal\">True</span>&#125;)</span><br><span class=\"line\">字典格式</span><br><span class=\"line\"></span><br><span class=\"line\">app.config.from_object(<span class=\"string\">&quot;python类或类的路径&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">app.config.from_object(<span class=\"string\">&#x27;pro_flask.settings.TestingConfig&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">settings.py</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Config</span>(<span class=\"params\"><span class=\"built_in\">object</span></span>):</span></span><br><span class=\"line\">    DEBUG = <span class=\"literal\">False</span></span><br><span class=\"line\">    TESTING = <span class=\"literal\">False</span></span><br><span class=\"line\">    DATABASE_URI = <span class=\"string\">&#x27;sqlite://:memory:&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ProductionConfig</span>(<span class=\"params\">Config</span>):</span></span><br><span class=\"line\">    DATABASE_URI = <span class=\"string\">&#x27;mysql://user@localhost/foo&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DevelopmentConfig</span>(<span class=\"params\">Config</span>):</span></span><br><span class=\"line\">    DEBUG = <span class=\"literal\">True</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TestingConfig</span>(<span class=\"params\">Config</span>):</span></span><br><span class=\"line\">    TESTING = <span class=\"literal\">True</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">PS: 从sys.path中已经存在路径开始写</span><br><span class=\"line\"></span><br><span class=\"line\">PS: settings.py文件默认路径要放在程序root_path目录，如果instance_relative_config为<span class=\"literal\">True</span>，则就是instance_path目录（Flask对象init方法的参数）</span><br></pre></td></tr></table></figure>\n<h3 id=\"典型写法\"><a class=\"markdownIt-Anchor\" href=\"#典型写法\"></a> 典型写法</h3>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&#x27;/detail/&lt;int:nid&gt;&#x27;</span>,methods=[<span class=\"string\">&#x27;GET&#x27;</span>],endpoint=<span class=\"string\">&#x27;detail&#x27;</span></span>)</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"默认转换器\"><a class=\"markdownIt-Anchor\" href=\"#默认转换器\"></a> 默认转换器</h3>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">DEFAULT_CONVERTERS = &#123;</span><br><span class=\"line\">    <span class=\"string\">&#x27;default&#x27;</span>:          UnicodeConverter,</span><br><span class=\"line\">    <span class=\"string\">&#x27;string&#x27;</span>:           UnicodeConverter,</span><br><span class=\"line\">    <span class=\"string\">&#x27;any&#x27;</span>:              AnyConverter,</span><br><span class=\"line\">    <span class=\"string\">&#x27;path&#x27;</span>:             PathConverter,</span><br><span class=\"line\">    <span class=\"string\">&#x27;int&#x27;</span>:              IntegerConverter,</span><br><span class=\"line\">    <span class=\"string\">&#x27;float&#x27;</span>:            FloatConverter,</span><br><span class=\"line\">    <span class=\"string\">&#x27;uuid&#x27;</span>:             UUIDConverter,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"路由系统本质\"><a class=\"markdownIt-Anchor\" href=\"#路由系统本质\"></a> 路由系统本质</h3>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">1. decorator = app.route(&#x27;/&#x27;,methods=[&#x27;GET&#x27;,&#x27;POST&#x27;],endpoint=&#x27;n1&#x27;)</span></span><br><span class=\"line\"><span class=\"string\">    def route(self, rule, **options):</span></span><br><span class=\"line\"><span class=\"string\">        # app对象</span></span><br><span class=\"line\"><span class=\"string\">        # rule= /</span></span><br><span class=\"line\"><span class=\"string\">        # options = &#123;methods=[&#x27;GET&#x27;,&#x27;POST&#x27;],endpoint=&#x27;n1&#x27;&#125;</span></span><br><span class=\"line\"><span class=\"string\">        def decorator(f):</span></span><br><span class=\"line\"><span class=\"string\">            endpoint = options.pop(&#x27;endpoint&#x27;, None)</span></span><br><span class=\"line\"><span class=\"string\">            self.add_url_rule(rule, endpoint, f, **options)</span></span><br><span class=\"line\"><span class=\"string\">            return f</span></span><br><span class=\"line\"><span class=\"string\">        return decorator</span></span><br><span class=\"line\"><span class=\"string\">2. @decorator</span></span><br><span class=\"line\"><span class=\"string\">    decorator(index)</span></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"comment\">#同理</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">login</span>():</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&#x27;登录&#x27;</span></span><br><span class=\"line\">app.add_url_rule(<span class=\"string\">&#x27;/login&#x27;</span>, <span class=\"string\">&#x27;n2&#x27;</span>, login, methods=[<span class=\"string\">&#x27;GET&#x27;</span>,<span class=\"string\">&quot;POST&quot;</span>])</span><br><span class=\"line\"><span class=\"comment\">#与django路由类似</span></span><br><span class=\"line\"><span class=\"comment\">#django与flask路由：flask路由基于装饰器，本质是基于：add_url_rule</span></span><br><span class=\"line\"><span class=\"comment\">#add_url_rule 源码中，endpoint如果为空，endpoint = _endpoint_from_view_func(view_func)，最终取view_func.__name__（函数名）</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"cbv源码分析\"><a class=\"markdownIt-Anchor\" href=\"#cbv源码分析\"></a> CBV(源码分析)</h3>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">auth</span>(<span class=\"params\">func</span>):</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">inner</span>(<span class=\"params\">*args, **kwargs</span>):</span></span><br><span class=\"line\">        print(<span class=\"string\">&#x27;before&#x27;</span>)</span><br><span class=\"line\">        result = func(*args, **kwargs)</span><br><span class=\"line\">        print(<span class=\"string\">&#x27;after&#x27;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> result</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> inner</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">IndexView</span>(<span class=\"params\">views.View</span>):</span></span><br><span class=\"line\">    methods = [<span class=\"string\">&#x27;GET&#x27;</span>]</span><br><span class=\"line\">    decorators = [auth, ]</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">dispatch_request</span>(<span class=\"params\">self</span>):</span></span><br><span class=\"line\">        print(<span class=\"string\">&#x27;Index&#x27;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&#x27;Index!&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">app.add_url_rule(<span class=\"string\">&#x27;/index&#x27;</span>, view_func=IndexView.as_view(name=<span class=\"string\">&#x27;index&#x27;</span>))  <span class=\"comment\"># name=endpoint</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#或者，通常用此方式</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">IndexView</span>(<span class=\"params\">views.MethodView</span>):</span></span><br><span class=\"line\">    methods = [<span class=\"string\">&#x27;GET&#x27;</span>]</span><br><span class=\"line\">    decorators = [auth, ]</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get</span>(<span class=\"params\">self</span>):</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&#x27;Index.GET&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">post</span>(<span class=\"params\">self</span>):</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&#x27;Index.POST&#x27;</span></span><br><span class=\"line\">    app.add_url_rule(<span class=\"string\">&#x27;/index&#x27;</span>, view_func=IndexView.as_view(name=<span class=\"string\">&#x27;index&#x27;</span>))  <span class=\"comment\"># name=endpoint</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"appadd_url_rule参数\"><a class=\"markdownIt-Anchor\" href=\"#appadd_url_rule参数\"></a> app.add_url_rule参数</h3>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@app.route和app.add_url_rule参数:</span></span><br><span class=\"line\">    </span><br><span class=\"line\">rule,       <span class=\"comment\"># URL规则</span></span><br><span class=\"line\">view_func,  <span class=\"comment\"># 视图函数名称</span></span><br><span class=\"line\">defaults = <span class=\"literal\">None</span>,  <span class=\"comment\"># 默认值, 当URL中无参数，函数需要参数时，使用defaults = &#123;&#x27;k&#x27;: &#x27;v&#x27;&#125;</span></span><br><span class=\"line\">为函数提供参数</span><br><span class=\"line\">endpoint = <span class=\"literal\">None</span>,  <span class=\"comment\"># 名称，用于反向生成URL，即： url_for(&#x27;名称&#x27;)</span></span><br><span class=\"line\">methods = <span class=\"literal\">None</span>,   <span class=\"comment\"># 允许的请求方式，如：[&quot;GET&quot;, &quot;POST&quot;]</span></span><br><span class=\"line\"><span class=\"comment\">#对URL最后的 / 符号是否严格要求</span></span><br><span class=\"line\">strict_slashes = <span class=\"literal\">None</span></span><br><span class=\"line\">    <span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"string\">        @app.route(&#x27;/index&#x27;, strict_slashes=False)</span></span><br><span class=\"line\"><span class=\"string\">        #访问http://www.xx.com/index/ 或http://www.xx.com/index均可</span></span><br><span class=\"line\"><span class=\"string\">        @app.route(&#x27;/index&#x27;, strict_slashes=True)</span></span><br><span class=\"line\"><span class=\"string\">        #仅访问http://www.xx.com/index</span></span><br><span class=\"line\"><span class=\"string\">    &#x27;&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"comment\">#重定向到指定地址</span></span><br><span class=\"line\">redirect_to = <span class=\"literal\">None</span>, </span><br><span class=\"line\">    <span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"string\">        @app.route(&#x27;/index/&lt;int:nid&gt;&#x27;, redirect_to=&#x27;/home/&lt;nid&gt;&#x27;)</span></span><br><span class=\"line\"><span class=\"string\">    &#x27;&#x27;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#子域名访问</span></span><br><span class=\"line\">subdomain = <span class=\"literal\">None</span>, </span><br><span class=\"line\">    <span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"string\">    #C:\\Windows\\System32\\drivers\\etc\\hosts</span></span><br><span class=\"line\"><span class=\"string\">    127.0.0.1       www.liuqingzheng.com</span></span><br><span class=\"line\"><span class=\"string\">\t127.0.0.1       admin.liuqingzheng.com</span></span><br><span class=\"line\"><span class=\"string\">\t127.0.0.1       buy.liuqingzheng.com</span></span><br><span class=\"line\"><span class=\"string\">    </span></span><br><span class=\"line\"><span class=\"string\">    from flask import Flask, views, url_for</span></span><br><span class=\"line\"><span class=\"string\">    app = Flask(import_name=__name__)</span></span><br><span class=\"line\"><span class=\"string\">    app.config[&#x27;SERVER_NAME&#x27;] = &#x27;liuqingzheng.com:5000&#x27;</span></span><br><span class=\"line\"><span class=\"string\">    @app.route(&quot;/&quot;, subdomain=&quot;admin&quot;)</span></span><br><span class=\"line\"><span class=\"string\">    def static_index():</span></span><br><span class=\"line\"><span class=\"string\">        &quot;&quot;&quot;Flask supports static subdomains</span></span><br><span class=\"line\"><span class=\"string\">        This is available at static.your-domain.tld&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">        return &quot;static.your-domain.tld&quot;</span></span><br><span class=\"line\"><span class=\"string\">    #可以传入任意的字符串，如传入的字符串为aa，显示为 aa.liuqingzheng.com</span></span><br><span class=\"line\"><span class=\"string\">    @app.route(&quot;/dynamic&quot;, subdomain=&quot;&lt;username&gt;&quot;)</span></span><br><span class=\"line\"><span class=\"string\">    def username_index(username):</span></span><br><span class=\"line\"><span class=\"string\">        &quot;&quot;&quot;Dynamic subdomains are also supported</span></span><br><span class=\"line\"><span class=\"string\">        Try going to user1.your-domain.tld/dynamic&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">        return username + &quot;.your-domain.tld&quot;</span></span><br><span class=\"line\"><span class=\"string\">    if __name__ == &#x27;__main__&#x27;:</span></span><br><span class=\"line\"><span class=\"string\">        app.run()</span></span><br><span class=\"line\"><span class=\"string\">        </span></span><br><span class=\"line\"><span class=\"string\">    访问：</span></span><br><span class=\"line\"><span class=\"string\">    http://www.liuqingzheng.com:5000/dynamic</span></span><br><span class=\"line\"><span class=\"string\">    http://admin.liuqingzheng.com:5000/dynamic</span></span><br><span class=\"line\"><span class=\"string\">    http://buy.liuqingzheng.com:5000/dynamic</span></span><br><span class=\"line\"><span class=\"string\">    &#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"支持正则\"><a class=\"markdownIt-Anchor\" href=\"#支持正则\"></a> 支持正则</h3>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#1 写类，继承BaseConverter</span></span><br><span class=\"line\"><span class=\"comment\">#2 注册：app.url_map.converters[&#x27;regex&#x27;] = RegexConverter</span></span><br><span class=\"line\"><span class=\"comment\">#3 使用：@app.route(&#x27;/index/&lt;regex(&quot;\\d+&quot;):nid&gt;&#x27;)  正则表达式会当作第二个参数传递到类中</span></span><br><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> Flask, views, url_for</span><br><span class=\"line\"><span class=\"keyword\">from</span> werkzeug.routing <span class=\"keyword\">import</span> BaseConverter</span><br><span class=\"line\"></span><br><span class=\"line\">app = Flask(import_name=__name__)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">RegexConverter</span>(<span class=\"params\">BaseConverter</span>):</span></span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">    自定义URL匹配正则表达式</span></span><br><span class=\"line\"><span class=\"string\">    &quot;&quot;&quot;</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span>(<span class=\"params\">self, <span class=\"built_in\">map</span>, regex</span>):</span></span><br><span class=\"line\">        <span class=\"built_in\">super</span>(RegexConverter, self).__init__(<span class=\"built_in\">map</span>)</span><br><span class=\"line\">        self.regex = regex</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">to_python</span>(<span class=\"params\">self, value</span>):</span></span><br><span class=\"line\">        <span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">        路由匹配时，匹配成功后传递给视图函数中参数的值</span></span><br><span class=\"line\"><span class=\"string\">        &quot;&quot;&quot;</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">int</span>(value)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">to_url</span>(<span class=\"params\">self, value</span>):</span></span><br><span class=\"line\">        <span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">        使用url_for反向生成URL时，传递的参数经过该方法处理，返回的值用于生成URL中的参数</span></span><br><span class=\"line\"><span class=\"string\">        &quot;&quot;&quot;</span></span><br><span class=\"line\">        val = <span class=\"built_in\">super</span>(RegexConverter, self).to_url(value)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> val</span><br><span class=\"line\"><span class=\"comment\"># 添加到flask中</span></span><br><span class=\"line\">app.url_map.converters[<span class=\"string\">&#x27;regex&#x27;</span>] = RegexConverter</span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&#x27;/index/&lt;regex(&quot;\\d+&quot;):nid&gt;&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">index</span>(<span class=\"params\">nid</span>):</span></span><br><span class=\"line\">    print(url_for(<span class=\"string\">&#x27;index&#x27;</span>, nid=<span class=\"string\">&#x27;888&#x27;</span>))</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&#x27;Index&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    app.run()</span><br></pre></td></tr></table></figure>\n<h2 id=\"6模版\"><a class=\"markdownIt-Anchor\" href=\"#6模版\"></a> 6.模版</h2>\n<h4 id=\"61渲染变量\"><a class=\"markdownIt-Anchor\" href=\"#61渲染变量\"></a> 6.1渲染变量</h4>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Title<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>用户列表<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">table</span>&gt;</span></span><br><span class=\"line\">        &#123;% for k,v in user_dict.items() %&#125;</span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">tr</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>&#123;&#123;k&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>&#123;&#123;v.name&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>&#123;&#123;v[&#x27;name&#x27;]&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>&#123;&#123;v.get(&#x27;name&#x27;)&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;/detail/&#123;&#123;k&#125;&#125;&quot;</span>&gt;</span>查看详细<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">tr</span>&gt;</span></span><br><span class=\"line\">        &#123;% endfor %&#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">table</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"62变量的循环\"><a class=\"markdownIt-Anchor\" href=\"#62变量的循环\"></a> 6.2变量的循环</h4>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Title<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>用户列表<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">table</span>&gt;</span></span><br><span class=\"line\">        &#123;% for k,v in user_dict.items() %&#125;</span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">tr</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>&#123;&#123;k&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>&#123;&#123;v.name&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>&#123;&#123;v[&#x27;name&#x27;]&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>&#123;&#123;v.get(&#x27;name&#x27;)&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;/detail/&#123;&#123;k&#125;&#125;&quot;</span>&gt;</span>查看详细<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">tr</span>&gt;</span></span><br><span class=\"line\">        &#123;% endfor %&#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">table</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"63逻辑判断\"><a class=\"markdownIt-Anchor\" href=\"#63逻辑判断\"></a> 6.3逻辑判断</h4>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Title<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>用户列表<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">table</span>&gt;</span></span><br><span class=\"line\">        &#123;% if name %&#125;</span><br><span class=\"line\">          <span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>Hello &#123;&#123; name &#125;&#125;!<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\">        &#123;% else %&#125;</span><br><span class=\"line\">          <span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>Hello World!<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\">        &#123;% endif %&#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">table</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>比django中多可以加括号，执行函数，传参数</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> Flask,render_template,Markup,jsonify,make_response</span><br><span class=\"line\">app = Flask(__name__)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">func1</span>(<span class=\"params\">arg</span>):</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> Markup(<span class=\"string\">&quot;&lt;input type=&#x27;text&#x27; value=&#x27;%s&#x27; /&gt;&quot;</span> %(arg,))</span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&#x27;/&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">index</span>():</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> render_template(<span class=\"string\">&#x27;index.html&#x27;</span>,ff = func1)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    app.run()</span><br></pre></td></tr></table></figure>\n<p>index.html</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Title<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    &#123;&#123;ff(&#x27;六五&#x27;)&#125;&#125;</span><br><span class=\"line\">\t&#123;&#123;ff(&#x27;六五&#x27;)|safe&#125;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>注意：</p>\n<p>1.Markup等价django的mark_safe ,</p>\n<p>2.extends,include一模一样</p>\n<h2 id=\"7请求响应\"><a class=\"markdownIt-Anchor\" href=\"#7请求响应\"></a> 7.请求响应</h2>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> Flask</span><br><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> request</span><br><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> render_template</span><br><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> redirect</span><br><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> make_response</span><br><span class=\"line\"></span><br><span class=\"line\">app = Flask(__name__)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&#x27;/login.html&#x27;</span>, methods=[<span class=\"string\">&#x27;GET&#x27;</span>, <span class=\"string\">&quot;POST&quot;</span>]</span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">login</span>():</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 请求相关信息</span></span><br><span class=\"line\">    <span class=\"comment\"># request.method  提交的方法</span></span><br><span class=\"line\">    <span class=\"comment\"># request.args  get请求提及的数据</span></span><br><span class=\"line\">    <span class=\"comment\"># request.form   post请求提交的数据</span></span><br><span class=\"line\">    <span class=\"comment\"># request.values  post和get提交的数据总和</span></span><br><span class=\"line\">    <span class=\"comment\"># request.cookies  客户端所带的cookie</span></span><br><span class=\"line\">    <span class=\"comment\"># request.headers  请求头</span></span><br><span class=\"line\">    <span class=\"comment\"># request.path     不带域名，请求路径</span></span><br><span class=\"line\">    <span class=\"comment\"># request.full_path  不带域名，带参数的请求路径</span></span><br><span class=\"line\">    <span class=\"comment\"># request.script_root  </span></span><br><span class=\"line\">    <span class=\"comment\"># request.url           带域名带参数的请求路径</span></span><br><span class=\"line\">    <span class=\"comment\"># request.base_url\t\t带域名请求路径</span></span><br><span class=\"line\">    <span class=\"comment\"># request.url_root      域名</span></span><br><span class=\"line\">    <span class=\"comment\"># request.host_url\t\t域名</span></span><br><span class=\"line\">    <span class=\"comment\"># request.host\t\t\t127.0.0.1:500</span></span><br><span class=\"line\">    <span class=\"comment\"># request.files</span></span><br><span class=\"line\">    <span class=\"comment\"># obj = request.files[&#x27;the_file_name&#x27;]</span></span><br><span class=\"line\">    <span class=\"comment\"># obj.save(&#x27;/var/www/uploads/&#x27; + secure_filename(f.filename))</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 响应相关信息</span></span><br><span class=\"line\">    <span class=\"comment\"># return &quot;字符串&quot;</span></span><br><span class=\"line\">    <span class=\"comment\"># return render_template(&#x27;html模板路径&#x27;,**&#123;&#125;)</span></span><br><span class=\"line\">    <span class=\"comment\"># return redirect(&#x27;/index.html&#x27;)</span></span><br><span class=\"line\">    <span class=\"comment\">#return jsonify(&#123;&#x27;k1&#x27;:&#x27;v1&#x27;&#125;)</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># response = make_response(render_template(&#x27;index.html&#x27;))</span></span><br><span class=\"line\">    <span class=\"comment\"># response是flask.wrappers.Response类型</span></span><br><span class=\"line\">    <span class=\"comment\"># response.delete_cookie(&#x27;key&#x27;)</span></span><br><span class=\"line\">    <span class=\"comment\"># response.set_cookie(&#x27;key&#x27;, &#x27;value&#x27;)</span></span><br><span class=\"line\">    <span class=\"comment\"># response.headers[&#x27;X-Something&#x27;] = &#x27;A value&#x27;</span></span><br><span class=\"line\">    <span class=\"comment\"># return response</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&quot;内容&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    app.run()</span><br></pre></td></tr></table></figure>\n<h2 id=\"8session\"><a class=\"markdownIt-Anchor\" href=\"#8session\"></a> 8.session</h2>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cookie:存放在客户端的键值对</span><br><span class=\"line\">session：存放在客户端的键值对</span><br><span class=\"line\">token:存放在客户端，通过算法来校验</span><br></pre></td></tr></table></figure>\n<p>在使用session之前必须现在设置一下密钥</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app.secret_key=<span class=\"string\">&quot;asdas&quot;</span> <span class=\"comment\">#值随便</span></span><br></pre></td></tr></table></figure>\n<p>除请求对象之外，还有一个 session 对象。它允许你在不同请求间存储特定用户的信息。它是在 Cookies 的基础上实现的，并且对 Cookies 进行密钥签名要使用会话，你需要设置一个密钥。 (app.session_interface对象)</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">设置：session[<span class=\"string\">&#x27;username&#x27;</span>] ＝ <span class=\"string\">&#x27;xxx&#x27;</span></span><br><span class=\"line\"><span class=\"comment\">#在django中发什么三件事，1，生成一个随机的字符串 2 往数据库存 3 写入cookie返回浏览器</span></span><br><span class=\"line\"><span class=\"comment\">#在flask中他没有数据库，但session是怎样实现的？</span></span><br><span class=\"line\">\t<span class=\"comment\"># 生成一个密钥写入这个cookie,然后下次请求的时候，通过这个cookie解密，然后赋值给session</span></span><br><span class=\"line\">    <span class=\"comment\">#我们通过app.session_interface来查看</span></span><br><span class=\"line\">  </span><br><span class=\"line\">删除：session.pop(<span class=\"string\">&#x27;username&#x27;</span>, <span class=\"literal\">None</span>)</span><br></pre></td></tr></table></figure>\n<h4 id=\"appsession_interface中save_session的参数设置cookie的参数\"><a class=\"markdownIt-Anchor\" href=\"#appsession_interface中save_session的参数设置cookie的参数\"></a> app.session_interface中save_session的参数（设置cookie的参数）</h4>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">key,             <span class=\"comment\"># 键</span></span><br><span class=\"line\">value=<span class=\"string\">&#x27;&#x27;</span>,        <span class=\"comment\"># 值</span></span><br><span class=\"line\">max_age=<span class=\"literal\">None</span>,    <span class=\"comment\"># 超时时间 cookie需要延续的时间（以秒为单位）如果参数是\\ None`` ，这个cookie会延续到浏览器关闭为止</span></span><br><span class=\"line\">expires=<span class=\"literal\">None</span>,    <span class=\"comment\"># 超时时间(IE requires expires, so set it if hasn&#x27;t been already.)</span></span><br><span class=\"line\">path=<span class=\"string\">&#x27;/&#x27;</span>,        <span class=\"comment\"># Cookie生效的路径，/ 表示根路径，特殊的：根路径的cookie可以被任何url的页面访问，浏览器只会把cookie回传给带有该路径的页面，这样可以避免将cookie传给站点中的其他的应用。</span></span><br><span class=\"line\">domain=<span class=\"literal\">None</span>,     <span class=\"comment\"># Cookie生效的域名 你可用这个参数来构造一个跨站cookie。如， domain=&quot;.example.com&quot;所构造的cookie对下面这些站点都是可读的：www.example.com 、 www2.example.com 和an.other.sub.domain.example.com 。如果该参数设置为 None ，cookie只能由设置它的站点读取</span></span><br><span class=\"line\">secure=<span class=\"literal\">False</span>,    <span class=\"comment\"># 浏览器将通过HTTPS来回传cookie</span></span><br><span class=\"line\">httponly=<span class=\"literal\">False</span>   <span class=\"comment\"># 只能http协议传输，无法被JavaScript获取（不是绝对，底层抓包可以获取到也可以被覆盖）</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"session源码的执行流程\"><a class=\"markdownIt-Anchor\" href=\"#session源码的执行流程\"></a> session源码的执行流程</h4>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-save_seesion</span><br><span class=\"line\">\t-响应的时候，把session中的值加密序列化放大到了cookie中，返回到浏览器中</span><br><span class=\"line\">-open_session</span><br><span class=\"line\">\t-请求来了，从cookie中取出值，反解，生成session对象，以后再视图函数中直接用sessoin就可以了。</span><br></pre></td></tr></table></figure>\n<h2 id=\"9闪现message\"><a class=\"markdownIt-Anchor\" href=\"#9闪现message\"></a> 9.闪现（message）</h2>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-设置:flash(<span class=\"string\">&#x27;aaa&#x27;</span>)</span><br><span class=\"line\">-取值：get_flashed_message()</span><br><span class=\"line\">-</span><br><span class=\"line\">-假设在a页面操作出错，跳转到b页面，在b页面显示a页面的错误信息</span><br></pre></td></tr></table></figure>\n<p>示例：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> Flask,flash,get_flashed_messages,request,redirect</span><br><span class=\"line\"></span><br><span class=\"line\">app = Flask(__name__)</span><br><span class=\"line\">app.secret_key = <span class=\"string\">&#x27;asdfasdf&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&#x27;/index&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">index</span>():</span></span><br><span class=\"line\">    <span class=\"comment\"># 从某个地方获取设置过的所有值，并清除。</span></span><br><span class=\"line\">    val = request.args.get(<span class=\"string\">&#x27;v&#x27;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> val == <span class=\"string\">&#x27;oldboy&#x27;</span>:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&#x27;Hello World!&#x27;</span></span><br><span class=\"line\">    flash(<span class=\"string\">&#x27;超时错误&#x27;</span>,category=<span class=\"string\">&quot;x1&quot;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&quot;ssdsdsdfsd&quot;</span></span><br><span class=\"line\">    <span class=\"comment\"># return redirect(&#x27;/error&#x27;)</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&#x27;/error&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">error</span>():</span></span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">    展示错误信息</span></span><br><span class=\"line\"><span class=\"string\">    :return:</span></span><br><span class=\"line\"><span class=\"string\">    如果get_flashed_messages(with_category=True)</span></span><br><span class=\"line\"><span class=\"string\">    &quot;&quot;&quot;</span></span><br><span class=\"line\">    data = get_flashed_messages(category_filter=[<span class=\"string\">&#x27;x1&#x27;</span>])</span><br><span class=\"line\">    <span class=\"keyword\">if</span> data:</span><br><span class=\"line\">        msg = data[<span class=\"number\">0</span>]</span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        msg = <span class=\"string\">&quot;...&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&quot;错误信息：%s&quot;</span> %(msg,)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    app.run()</span><br></pre></td></tr></table></figure>\n<h2 id=\"10请求扩展\"><a class=\"markdownIt-Anchor\" href=\"#10请求扩展\"></a> 10.请求扩展</h2>\n<h3 id=\"1-before_request\"><a class=\"markdownIt-Anchor\" href=\"#1-before_request\"></a> 1 before_request</h3>\n<p>类比django中间件中的process_request，在请求收到之前绑定一个函数做一些事情</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#基于它做用户登录认证</span></span><br><span class=\"line\"><span class=\"meta\">@app.before_request</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">process_request</span>(<span class=\"params\">*args,**kwargs</span>):</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> request.path == <span class=\"string\">&#x27;/login&#x27;</span>:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">None</span></span><br><span class=\"line\">    user = session.get(<span class=\"string\">&#x27;user_info&#x27;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> user:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">None</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> redirect(<span class=\"string\">&#x27;/login&#x27;</span>)</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-after_request\"><a class=\"markdownIt-Anchor\" href=\"#2-after_request\"></a> 2 after_request</h3>\n<p>类比django中间件中的process_response，每一个请求之后绑定一个函数，如果请求没有异常</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@app.after_request</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">process_response1</span>(<span class=\"params\">response</span>):</span></span><br><span class=\"line\">    print(<span class=\"string\">&#x27;process_response1 走了&#x27;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> response</span><br></pre></td></tr></table></figure>\n<h3 id=\"3-before_first_request\"><a class=\"markdownIt-Anchor\" href=\"#3-before_first_request\"></a> 3 before_first_request</h3>\n<p>第一次请求时,跟浏览器无关</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@app.before_first_request</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">first</span>():</span></span><br><span class=\"line\">    <span class=\"keyword\">pass</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"4-teardown_request\"><a class=\"markdownIt-Anchor\" href=\"#4-teardown_request\"></a> 4 teardown_request</h3>\n<p>每一个请求之后绑定一个函数，即使遇到了异常</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@app.teardown_request </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">ter</span>(<span class=\"params\">e</span>):</span></span><br><span class=\"line\">    <span class=\"keyword\">pass</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"5-errorhandler\"><a class=\"markdownIt-Anchor\" href=\"#5-errorhandler\"></a> 5 errorhandler</h3>\n<p>路径不存在时404，服务器内部错误500</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@app.errorhandler(<span class=\"params\"><span class=\"number\">404</span></span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">error_404</span>(<span class=\"params\">arg</span>):</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&quot;404错误了&quot;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"6-template_global\"><a class=\"markdownIt-Anchor\" href=\"#6-template_global\"></a> 6 template_global</h3>\n<p>标签</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@app.template_global()</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">sb</span>(<span class=\"params\">a1, a2</span>):</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> a1 + a2</span><br><span class=\"line\"><span class=\"comment\">#&#123;&#123;sb(1,2)&#125;&#125;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"7-template_filter\"><a class=\"markdownIt-Anchor\" href=\"#7-template_filter\"></a> 7 template_filter</h3>\n<p>过滤器</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@app.template_filter()</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">db</span>(<span class=\"params\">a1, a2, a3</span>):</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> a1 + a2 + a3</span><br><span class=\"line\"><span class=\"comment\">#&#123;&#123; 1|db(2,3)&#125;&#125;</span></span><br></pre></td></tr></table></figure>\n<p>总结：</p>\n<p>1 重点掌握before_request和after_request，</p>\n<p>2 注意有多个的情况，执行顺序</p>\n<p>3 before_request请求拦截后（也就是有return值），response所有都执行</p>\n<h2 id=\"11-中间件了解\"><a class=\"markdownIt-Anchor\" href=\"#11-中间件了解\"></a> 11 中间件（了解）</h2>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> Flask</span><br><span class=\"line\"></span><br><span class=\"line\">app = Flask(__name__)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&#x27;/&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">index</span>():</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&#x27;Hello World!&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># 模拟中间件</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Md</span>(<span class=\"params\"><span class=\"built_in\">object</span></span>):</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span>(<span class=\"params\">self,old_wsgi_app</span>):</span></span><br><span class=\"line\">        self.old_wsgi_app = old_wsgi_app</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__call__</span>(<span class=\"params\">self,  environ, start_response</span>):</span></span><br><span class=\"line\">        print(<span class=\"string\">&#x27;开始之前&#x27;</span>)</span><br><span class=\"line\">        ret = self.old_wsgi_app(environ, start_response)</span><br><span class=\"line\">        print(<span class=\"string\">&#x27;结束之后&#x27;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ret</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    <span class=\"comment\">#1我们发现当执行app.run方法的时候，最终执行run_simple，最后执行app(),也就是在执行app.__call__方法\t</span></span><br><span class=\"line\">    <span class=\"comment\">#2 在__call__里面，执行的是self.wsgi_app().那我们希望在执行他本身的wsgi之前做点事情。</span></span><br><span class=\"line\">    <span class=\"comment\">#3 所以我们先用Md类中__init__，保存之前的wsgi,然后我们用将app.wsgi转化成Md的对象。</span></span><br><span class=\"line\">    <span class=\"comment\">#4 那执行新的的app.wsgi_app，就是执行Md的__call__方法。</span></span><br><span class=\"line\">    <span class=\"comment\">#把原来的wsgi_app替换为自定义的，</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    app.wsgi_app = Md(app.wsgi_app)</span><br><span class=\"line\">    app.run()</span><br></pre></td></tr></table></figure>\n<p>请求所有的流程</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ctx = self.request_context(environ)</span><br><span class=\"line\">\terror = <span class=\"literal\">None</span></span><br><span class=\"line\">    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">        <span class=\"keyword\">try</span>:</span><br><span class=\"line\">            ctx.push()</span><br><span class=\"line\">            <span class=\"comment\">#根据路径去执行视图函数，视图类</span></span><br><span class=\"line\">            response = self.full_dispatch_request()</span><br><span class=\"line\">        <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">            error = e</span><br><span class=\"line\">            response = self.handle_exception(e)</span><br><span class=\"line\">    <span class=\"keyword\">except</span>:  <span class=\"comment\"># noqa: B001</span></span><br><span class=\"line\">        error = sys.exc_info()[<span class=\"number\">1</span>]</span><br><span class=\"line\">        <span class=\"keyword\">raise</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> response(environ, start_response)</span><br><span class=\"line\">    <span class=\"keyword\">finally</span>:</span><br><span class=\"line\">        <span class=\"comment\">#不管出不出异常，都会走这里</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> self.should_ignore_error(error):</span><br><span class=\"line\">            error = <span class=\"literal\">None</span></span><br><span class=\"line\">            ctx.auto_pop(error)</span><br></pre></td></tr></table></figure>\n<h2 id=\"12蓝图\"><a class=\"markdownIt-Anchor\" href=\"#12蓝图\"></a> 12.蓝图</h2>\n<p>对程序进行目录结构划分</p>\n<h3 id=\"不使用蓝图自己分文件\"><a class=\"markdownIt-Anchor\" href=\"#不使用蓝图自己分文件\"></a> 不使用蓝图，自己分文件</h3>\n<p>目录结构：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-templates</span><br><span class=\"line\">-views</span><br><span class=\"line\">\t-__init__.py</span><br><span class=\"line\">    -user.py</span><br><span class=\"line\">    -order.py</span><br><span class=\"line\">-app.py</span><br></pre></td></tr></table></figure>\n<p><a href=\"http://app.py\">app.py</a></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> views <span class=\"keyword\">import</span> app</span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    app.run()</span><br></pre></td></tr></table></figure>\n<p><a href=\"http://init.py\">init.py</a></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> Flask,request</span><br><span class=\"line\">app = Flask(__name__)</span><br><span class=\"line\"><span class=\"comment\">#不导入这个不行</span></span><br><span class=\"line\"><span class=\"keyword\">from</span> . <span class=\"keyword\">import</span> account</span><br><span class=\"line\"><span class=\"keyword\">from</span> . <span class=\"keyword\">import</span> order</span><br><span class=\"line\"><span class=\"keyword\">from</span> . <span class=\"keyword\">import</span> user</span><br></pre></td></tr></table></figure>\n<p><a href=\"http://user.py\">user.py</a></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> . <span class=\"keyword\">import</span> app</span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&#x27;/user&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">user</span>():</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&#x27;user&#x27;</span></span><br></pre></td></tr></table></figure>\n<p><a href=\"http://order.py\">order.py</a></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> . <span class=\"keyword\">import</span> app</span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&#x27;/order&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">order</span>():</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&#x27;order&#x27;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"使用蓝图之中小型系统\"><a class=\"markdownIt-Anchor\" href=\"#使用蓝图之中小型系统\"></a> 使用蓝图之中小型系统</h3>\n<p>详见代码：pro_flask_简单应用程序目录示例.zip</p>\n<p>目录结构：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-flask_pro</span><br><span class=\"line\">\t-flask_test</span><br><span class=\"line\">    \t-__init__.py</span><br><span class=\"line\">    \t-static</span><br><span class=\"line\">        -templates</span><br><span class=\"line\">        -views</span><br><span class=\"line\">        \t-order.py</span><br><span class=\"line\">            -user.py</span><br><span class=\"line\">     -manage.py </span><br><span class=\"line\">        </span><br></pre></td></tr></table></figure>\n<p>_<em>init</em>.py</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span>  Flask</span><br><span class=\"line\">app=Flask(__name__)</span><br><span class=\"line\"><span class=\"keyword\">from</span> flask_test.views <span class=\"keyword\">import</span> user</span><br><span class=\"line\"><span class=\"keyword\">from</span> flask_test.views <span class=\"keyword\">import</span> order</span><br><span class=\"line\">app.register_blueprint(user.us)</span><br><span class=\"line\">app.register_blueprint(order.<span class=\"built_in\">ord</span>)</span><br></pre></td></tr></table></figure>\n<p><a href=\"http://manage.py\">manage.py</a></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> flask_test <span class=\"keyword\">import</span>  app</span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    app.run(port=<span class=\"number\">8008</span>)</span><br></pre></td></tr></table></figure>\n<p><a href=\"http://user.py\">user.py</a></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> Blueprint</span><br><span class=\"line\">us=Blueprint(<span class=\"string\">&#x27;user&#x27;</span>,__name__)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@us.route(<span class=\"params\"><span class=\"string\">&#x27;/login&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">login</span>():</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&#x27;login&#x27;</span></span><br></pre></td></tr></table></figure>\n<p><a href=\"http://order.py\">order.py</a></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> Blueprint</span><br><span class=\"line\"><span class=\"built_in\">ord</span>=Blueprint(<span class=\"string\">&#x27;order&#x27;</span>,__name__)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@ord.route(<span class=\"params\"><span class=\"string\">&#x27;/test&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">test</span>():</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&#x27;order test&#x27;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"使用蓝图之大型系统\"><a class=\"markdownIt-Anchor\" href=\"#使用蓝图之大型系统\"></a> 使用蓝图之大型系统</h3>\n<p>详见代码：pro_flask_大型应用目录示例.zip</p>\n<p>总结：</p>\n<p>1 xxx = Blueprint(‘account’, <strong>name</strong>,url_prefix=’/xxx’) ：蓝图URL前缀，表示url的前缀，在该蓝图下所有url都加前缀</p>\n<p>2 xxx = Blueprint(‘account’, name,url_prefix=’/xxx’,template_folder=‘tpls’)：给当前蓝图单独使用templates，向上查找，当前找不到，会找总templates</p>\n<p>3 蓝图的befort_request，对当前蓝图有效</p>\n<p>4 大型项目，可以模拟出类似于django中app的概念</p>\n<h2 id=\"13请求上下文源码分析\"><a class=\"markdownIt-Anchor\" href=\"#13请求上下文源码分析\"></a> 13.请求上下文源码分析</h2>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">第一阶段：将ctx(request,session)放到Local对象上</span><br><span class=\"line\">\t\t\t\t   </span><br><span class=\"line\">第二阶段：视图函数导入：request/session </span><br><span class=\"line\">request.method</span><br><span class=\"line\">\t-LocalProxy对象.method,执行<span class=\"built_in\">getattr</span>方法，<span class=\"built_in\">getattr</span>(self._get_current_object(), name)</span><br><span class=\"line\">\t\t-self._get_current_object()返回<span class=\"keyword\">return</span> self.__local()，self.__local()，在LocakProxy实例化的时候,<span class=\"built_in\">object</span>.__setattr__(self, <span class=\"string\">&#x27;_LocalProxy__local&#x27;</span>, local),此处local就是：partial(_lookup_req_object, <span class=\"string\">&#x27;request&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">\t-<span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">_lookup_req_object</span>(<span class=\"params\">name</span>):</span></span><br><span class=\"line\">\t\t\ttop = _request_ctx_stack.top <span class=\"comment\">#_request_ctx_stack 就是LocalStack()对象，top方法把ctx取出来</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> top <span class=\"keyword\">is</span> <span class=\"literal\">None</span>:</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">raise</span> RuntimeError(_request_ctx_err_msg)</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"built_in\">getattr</span>(top, name)<span class=\"comment\">#获取ctx中的request或session对象</span></span><br><span class=\"line\"></span><br><span class=\"line\">第三阶段：请求处理完毕</span><br><span class=\"line\">\t\t- 获取session并保存到cookie</span><br><span class=\"line\">\t\t- 将ctx删除</span><br></pre></td></tr></table></figure>\n<p>程序运行，两个LocalStack()对象，一个里面放request和session，另一个放g和<code>current_app</code></p>\n<h2 id=\"14g对象\"><a class=\"markdownIt-Anchor\" href=\"#14g对象\"></a> 14.g对象</h2>\n<p>专门用来存储用户信息的g对象，g的全称的为global</p>\n<p>g对象在一次请求中的所有的代码的地方，都是可以使用的</p>\n<h3 id=\"g对象和session的区别\"><a class=\"markdownIt-Anchor\" href=\"#g对象和session的区别\"></a> g对象和session的区别</h3>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">session对象是可以跨request的，只要session还未失效，不同的request的请求会获取到同一个session，但是g对象不是，g对象不需要管过期时间，请求一次就g对象就改变了一次，或者重新赋值了一次</span><br></pre></td></tr></table></figure>\n<h2 id=\"15flask-session\"><a class=\"markdownIt-Anchor\" href=\"#15flask-session\"></a> 15.flask-session</h2>\n<p>作用：将默认保存的签名cookie中的值 保存到 redis/memcached/file/Mongodb/SQLAlchemy</p>\n<p>安装：pip3 install flask-session</p>\n<p>使用1：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> Flask,session</span><br><span class=\"line\"><span class=\"keyword\">from</span> flask_session <span class=\"keyword\">import</span> RedisSessionInterface</span><br><span class=\"line\"><span class=\"keyword\">import</span> redis</span><br><span class=\"line\">app = Flask(__name__)</span><br><span class=\"line\">conn=redis.Redis(host=<span class=\"string\">&#x27;127.0.0.1&#x27;</span>,port=<span class=\"number\">6379</span>)</span><br><span class=\"line\"><span class=\"comment\">#use_signer是否对key签名</span></span><br><span class=\"line\">app.session_interface=RedisSessionInterface(conn,key_prefix=<span class=\"string\">&#x27;lqz&#x27;</span>)</span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&#x27;/&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">hello_world</span>():</span></span><br><span class=\"line\">    session[<span class=\"string\">&#x27;name&#x27;</span>]=<span class=\"string\">&#x27;lqz&#x27;</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&#x27;Hello World!&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    app.run()</span><br></pre></td></tr></table></figure>\n<p>使用2：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> redis <span class=\"keyword\">import</span> Redis</span><br><span class=\"line\"><span class=\"keyword\">from</span> flask.ext.session <span class=\"keyword\">import</span> Session</span><br><span class=\"line\">app.config[<span class=\"string\">&#x27;SESSION_TYPE&#x27;</span>] = <span class=\"string\">&#x27;redis&#x27;</span></span><br><span class=\"line\">app.config[<span class=\"string\">&#x27;SESSION_REDIS&#x27;</span>] = Redis(host=<span class=\"string\">&#x27;192.168.0.94&#x27;</span>,port=<span class=\"string\">&#x27;6379&#x27;</span>)</span><br><span class=\"line\">Session(app)</span><br></pre></td></tr></table></figure>\n<p>问题：设置cookie时，如何设定关闭浏览器则cookie失效。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">response.set_cookie(<span class=\"string\">&#x27;k&#x27;</span>,<span class=\"string\">&#x27;v&#x27;</span>,exipre=<span class=\"literal\">None</span>)<span class=\"comment\">#这样设置即可</span></span><br><span class=\"line\"><span class=\"comment\">#在session中设置</span></span><br><span class=\"line\">app.session_interface=RedisSessionInterface(conn,key_prefix=<span class=\"string\">&#x27;lqz&#x27;</span>,permanent=<span class=\"literal\">False</span>)</span><br><span class=\"line\"><span class=\"comment\">#一般不用，我们一般都设置超时时间，多长时间后失效</span></span><br></pre></td></tr></table></figure>\n<p>问题：cookie默认超时时间是多少？如何设置超时时间</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#源码expires = self.get_expiration_time(app, session)</span></span><br><span class=\"line\"><span class=\"string\">&#x27;PERMANENT_SESSION_LIFETIME&#x27;</span>:           timedelta(days=<span class=\"number\">31</span>),<span class=\"comment\">#这个配置文件控制</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"16数据库连接池\"><a class=\"markdownIt-Anchor\" href=\"#16数据库连接池\"></a> 16.数据库连接池</h2>\n<h3 id=\"pymsql链接数据库\"><a class=\"markdownIt-Anchor\" href=\"#pymsql链接数据库\"></a> pymsql链接数据库</h3>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> pymysql</span><br><span class=\"line\"></span><br><span class=\"line\">conn = pymysql.connect(host=<span class=\"string\">&#x27;127.0.0.1&#x27;</span>, port=<span class=\"number\">3306</span>, user=<span class=\"string\">&#x27;root&#x27;</span>, passwd=<span class=\"string\">&#x27;123456&#x27;</span>, db=<span class=\"string\">&#x27;s8day127db&#x27;</span>)</span><br><span class=\"line\">cursor = conn.cursor(cursor=pymysql.cursors.DictCursor)</span><br><span class=\"line\"><span class=\"comment\"># cursor.execute(&quot;select id,name from users where name=%s and pwd=%s&quot;,[&#x27;lqz&#x27;,&#x27;123&#x27;,])</span></span><br><span class=\"line\">cursor.execute(<span class=\"string\">&quot;select id,name from users where name=%(user)s and pwd=%(pwd)s&quot;</span>,&#123;<span class=\"string\">&#x27;user&#x27;</span>:<span class=\"string\">&#x27;lqz&#x27;</span>,<span class=\"string\">&#x27;pwd&#x27;</span>:<span class=\"string\">&#x27;123&#x27;</span>&#125;)</span><br><span class=\"line\">obj = cursor.fetchone()</span><br><span class=\"line\">conn.commit()</span><br><span class=\"line\">cursor.close()</span><br><span class=\"line\">conn.close()</span><br><span class=\"line\"></span><br><span class=\"line\">print(obj)</span><br></pre></td></tr></table></figure>\n<h3 id=\"数据库连接池版\"><a class=\"markdownIt-Anchor\" href=\"#数据库连接池版\"></a> 数据库连接池版</h3>\n<p><a href=\"http://setting.py\">setting.py</a></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> datetime <span class=\"keyword\">import</span> timedelta</span><br><span class=\"line\"><span class=\"keyword\">from</span> redis <span class=\"keyword\">import</span> Redis</span><br><span class=\"line\"><span class=\"keyword\">import</span> pymysql</span><br><span class=\"line\"><span class=\"keyword\">from</span> DBUtils.PooledDB <span class=\"keyword\">import</span> PooledDB, SharedDBConnection</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Config</span>(<span class=\"params\"><span class=\"built_in\">object</span></span>):</span></span><br><span class=\"line\">    DEBUG = <span class=\"literal\">True</span></span><br><span class=\"line\">    SECRET_KEY = <span class=\"string\">&quot;umsuldfsdflskjdf&quot;</span></span><br><span class=\"line\">    PERMANENT_SESSION_LIFETIME = timedelta(minutes=<span class=\"number\">20</span>)</span><br><span class=\"line\">    SESSION_REFRESH_EACH_REQUEST= <span class=\"literal\">True</span></span><br><span class=\"line\">    SESSION_TYPE = <span class=\"string\">&quot;redis&quot;</span></span><br><span class=\"line\">    PYMYSQL_POOL = PooledDB(</span><br><span class=\"line\">        creator=pymysql,  <span class=\"comment\"># 使用链接数据库的模块</span></span><br><span class=\"line\">        maxconnections=<span class=\"number\">6</span>,  <span class=\"comment\"># 连接池允许的最大连接数，0和None表示不限制连接数</span></span><br><span class=\"line\">        mincached=<span class=\"number\">2</span>,  <span class=\"comment\"># 初始化时，链接池中至少创建的空闲的链接，0表示不创建</span></span><br><span class=\"line\">        maxcached=<span class=\"number\">5</span>,  <span class=\"comment\"># 链接池中最多闲置的链接，0和None不限制</span></span><br><span class=\"line\">        maxshared=<span class=\"number\">3</span>,</span><br><span class=\"line\">        <span class=\"comment\"># 链接池中最多共享的链接数量，0和None表示全部共享。PS: 无用，因为pymysql和MySQLdb等模块的 threadsafety都为1，所有值无论设置为多少，_maxcached永远为0，所以永远是所有链接都共享。</span></span><br><span class=\"line\">        blocking=<span class=\"literal\">True</span>,  <span class=\"comment\"># 连接池中如果没有可用连接后，是否阻塞等待。True，等待；False，不等待然后报错</span></span><br><span class=\"line\">        maxusage=<span class=\"literal\">None</span>,  <span class=\"comment\"># 一个链接最多被重复使用的次数，None表示无限制</span></span><br><span class=\"line\">        setsession=[],  <span class=\"comment\"># 开始会话前执行的命令列表。如：[&quot;set datestyle to ...&quot;, &quot;set time zone ...&quot;]</span></span><br><span class=\"line\">        ping=<span class=\"number\">0</span>,</span><br><span class=\"line\">        <span class=\"comment\"># ping MySQL服务端，检查是否服务可用。# 如：0 = None = never, 1 = default = whenever it is requested, 2 = when a cursor is created, 4 = when a query is executed, 7 = always</span></span><br><span class=\"line\">        host=<span class=\"string\">&#x27;127.0.0.1&#x27;</span>,</span><br><span class=\"line\">        port=<span class=\"number\">3306</span>,</span><br><span class=\"line\">        user=<span class=\"string\">&#x27;root&#x27;</span>,</span><br><span class=\"line\">        password=<span class=\"string\">&#x27;123456&#x27;</span>,</span><br><span class=\"line\">        database=<span class=\"string\">&#x27;s8day127db&#x27;</span>,</span><br><span class=\"line\">        charset=<span class=\"string\">&#x27;utf8&#x27;</span></span><br><span class=\"line\">    )</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ProductionConfig</span>(<span class=\"params\">Config</span>):</span></span><br><span class=\"line\">    SESSION_REDIS = Redis(host=<span class=\"string\">&#x27;192.168.0.94&#x27;</span>, port=<span class=\"string\">&#x27;6379&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DevelopmentConfig</span>(<span class=\"params\">Config</span>):</span></span><br><span class=\"line\">    SESSION_REDIS = Redis(host=<span class=\"string\">&#x27;127.0.0.1&#x27;</span>, port=<span class=\"string\">&#x27;6379&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TestingConfig</span>(<span class=\"params\">Config</span>):</span></span><br><span class=\"line\">    <span class=\"keyword\">pass</span></span><br></pre></td></tr></table></figure>\n<p>utils/sql.py</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> pymysql</span><br><span class=\"line\"><span class=\"keyword\">from</span> settings <span class=\"keyword\">import</span> Config</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SQLHelper</span>(<span class=\"params\"><span class=\"built_in\">object</span></span>):</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">    @staticmethod</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">open</span>(<span class=\"params\">cursor</span>):</span></span><br><span class=\"line\">        POOL = Config.PYMYSQL_POOL</span><br><span class=\"line\">        conn = POOL.connection()</span><br><span class=\"line\">        cursor = conn.cursor(cursor=cursor)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> conn,cursor</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">    @staticmethod</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">close</span>(<span class=\"params\">conn,cursor</span>):</span></span><br><span class=\"line\">        conn.commit()</span><br><span class=\"line\">        cursor.close()</span><br><span class=\"line\">        conn.close()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">    @classmethod</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">fetch_one</span>(<span class=\"params\">cls,sql,args,cursor =pymysql.cursors.DictCursor</span>):</span></span><br><span class=\"line\">        conn,cursor = cls.<span class=\"built_in\">open</span>(cursor)</span><br><span class=\"line\">        cursor.execute(sql, args)</span><br><span class=\"line\">        obj = cursor.fetchone()</span><br><span class=\"line\">        cls.close(conn,cursor)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> obj</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">    @classmethod</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">fetch_all</span>(<span class=\"params\">cls,sql, args,cursor =pymysql.cursors.DictCursor</span>):</span></span><br><span class=\"line\">        conn, cursor = cls.<span class=\"built_in\">open</span>(cursor)</span><br><span class=\"line\">        cursor.execute(sql, args)</span><br><span class=\"line\">        obj = cursor.fetchall()</span><br><span class=\"line\">        cls.close(conn, cursor)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> obj</span><br></pre></td></tr></table></figure>\n<p>使用：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">obj = SQLHelper.fetch_one(<span class=\"string\">&quot;select id,name from users where name=%(user)s and pwd=%(pwd)s&quot;</span>, form.data)</span><br></pre></td></tr></table></figure>\n<h2 id=\"17wtforms\"><a class=\"markdownIt-Anchor\" href=\"#17wtforms\"></a> 17.wtforms</h2>\n<p>安装:pip3 install wtforms</p>\n<h3 id=\"使用1\"><a class=\"markdownIt-Anchor\" href=\"#使用1\"></a> 使用1：</h3>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> Flask, render_template, request, redirect</span><br><span class=\"line\"><span class=\"keyword\">from</span> wtforms <span class=\"keyword\">import</span> Form</span><br><span class=\"line\"><span class=\"keyword\">from</span> wtforms.fields <span class=\"keyword\">import</span> simple</span><br><span class=\"line\"><span class=\"keyword\">from</span> wtforms <span class=\"keyword\">import</span> validators</span><br><span class=\"line\"><span class=\"keyword\">from</span> wtforms <span class=\"keyword\">import</span> widgets</span><br><span class=\"line\"></span><br><span class=\"line\">app = Flask(__name__, template_folder=<span class=\"string\">&#x27;templates&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">app.debug = <span class=\"literal\">True</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">LoginForm</span>(<span class=\"params\">Form</span>):</span></span><br><span class=\"line\">    <span class=\"comment\"># 字段（内部包含正则表达式）</span></span><br><span class=\"line\">    name = simple.StringField(</span><br><span class=\"line\">        label=<span class=\"string\">&#x27;用户名&#x27;</span>,</span><br><span class=\"line\">        validators=[</span><br><span class=\"line\">            validators.DataRequired(message=<span class=\"string\">&#x27;用户名不能为空.&#x27;</span>),</span><br><span class=\"line\">            validators.Length(<span class=\"built_in\">min</span>=<span class=\"number\">6</span>, <span class=\"built_in\">max</span>=<span class=\"number\">18</span>, message=<span class=\"string\">&#x27;用户名长度必须大于%(min)d且小于%(max)d&#x27;</span>)</span><br><span class=\"line\">        ],</span><br><span class=\"line\">        widget=widgets.TextInput(), <span class=\"comment\"># 页面上显示的插件</span></span><br><span class=\"line\">        render_kw=&#123;<span class=\"string\">&#x27;class&#x27;</span>: <span class=\"string\">&#x27;form-control&#x27;</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    )</span><br><span class=\"line\">    <span class=\"comment\"># 字段（内部包含正则表达式）</span></span><br><span class=\"line\">    pwd = simple.PasswordField(</span><br><span class=\"line\">        label=<span class=\"string\">&#x27;密码&#x27;</span>,</span><br><span class=\"line\">        validators=[</span><br><span class=\"line\">            validators.DataRequired(message=<span class=\"string\">&#x27;密码不能为空.&#x27;</span>),</span><br><span class=\"line\">            validators.Length(<span class=\"built_in\">min</span>=<span class=\"number\">8</span>, message=<span class=\"string\">&#x27;用户名长度必须大于%(min)d&#x27;</span>),</span><br><span class=\"line\">            validators.Regexp(regex=<span class=\"string\">&quot;^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)(?=.*[$@$!%*?&amp;])[A-Za-z\\d$@$!%*?&amp;]&#123;8,&#125;&quot;</span>,</span><br><span class=\"line\">                              message=<span class=\"string\">&#x27;密码至少8个字符，至少1个大写字母，1个小写字母，1个数字和1个特殊字符&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">        ],</span><br><span class=\"line\">        widget=widgets.PasswordInput(),</span><br><span class=\"line\">        render_kw=&#123;<span class=\"string\">&#x27;class&#x27;</span>: <span class=\"string\">&#x27;form-control&#x27;</span>&#125;</span><br><span class=\"line\">    )</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&#x27;/login&#x27;</span>, methods=[<span class=\"string\">&#x27;GET&#x27;</span>, <span class=\"string\">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">login</span>():</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> request.method == <span class=\"string\">&#x27;GET&#x27;</span>:</span><br><span class=\"line\">        form = LoginForm()</span><br><span class=\"line\">        <span class=\"keyword\">return</span> render_template(<span class=\"string\">&#x27;login.html&#x27;</span>, form=form)</span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        form = LoginForm(formdata=request.form)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> form.validate():</span><br><span class=\"line\">            print(<span class=\"string\">&#x27;用户提交数据通过格式验证，提交的值为：&#x27;</span>, form.data)</span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            print(form.errors)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> render_template(<span class=\"string\">&#x27;login.html&#x27;</span>, form=form)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    app.run()</span><br></pre></td></tr></table></figure>\n<p>login.html</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Title<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>登录<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">form</span> <span class=\"attr\">method</span>=<span class=\"string\">&quot;post&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>&#123;&#123;form.name.label&#125;&#125; &#123;&#123;form.name&#125;&#125; &#123;&#123;form.name.errors[0] &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>&#123;&#123;form.pwd.label&#125;&#125; &#123;&#123;form.pwd&#125;&#125; &#123;&#123;form.pwd.errors[0] &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;submit&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;提交&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">form</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"使用2\"><a class=\"markdownIt-Anchor\" href=\"#使用2\"></a> 使用2：</h3>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> Flask, render_template, request, redirect</span><br><span class=\"line\"><span class=\"keyword\">from</span> wtforms <span class=\"keyword\">import</span> Form</span><br><span class=\"line\"><span class=\"keyword\">from</span> wtforms.fields <span class=\"keyword\">import</span> core</span><br><span class=\"line\"><span class=\"keyword\">from</span> wtforms.fields <span class=\"keyword\">import</span> html5</span><br><span class=\"line\"><span class=\"keyword\">from</span> wtforms.fields <span class=\"keyword\">import</span> simple</span><br><span class=\"line\"><span class=\"keyword\">from</span> wtforms <span class=\"keyword\">import</span> validators</span><br><span class=\"line\"><span class=\"keyword\">from</span> wtforms <span class=\"keyword\">import</span> widgets</span><br><span class=\"line\"></span><br><span class=\"line\">app = Flask(__name__, template_folder=<span class=\"string\">&#x27;templates&#x27;</span>)</span><br><span class=\"line\">app.debug = <span class=\"literal\">True</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">RegisterForm</span>(<span class=\"params\">Form</span>):</span></span><br><span class=\"line\">    name = simple.StringField(</span><br><span class=\"line\">        label=<span class=\"string\">&#x27;用户名&#x27;</span>,</span><br><span class=\"line\">        validators=[</span><br><span class=\"line\">            validators.DataRequired()</span><br><span class=\"line\">        ],</span><br><span class=\"line\">        widget=widgets.TextInput(),</span><br><span class=\"line\">        render_kw=&#123;<span class=\"string\">&#x27;class&#x27;</span>: <span class=\"string\">&#x27;form-control&#x27;</span>&#125;,</span><br><span class=\"line\">        default=<span class=\"string\">&#x27;alex&#x27;</span></span><br><span class=\"line\">    )</span><br><span class=\"line\"></span><br><span class=\"line\">    pwd = simple.PasswordField(</span><br><span class=\"line\">        label=<span class=\"string\">&#x27;密码&#x27;</span>,</span><br><span class=\"line\">        validators=[</span><br><span class=\"line\">            validators.DataRequired(message=<span class=\"string\">&#x27;密码不能为空.&#x27;</span>)</span><br><span class=\"line\">        ],</span><br><span class=\"line\">        widget=widgets.PasswordInput(),</span><br><span class=\"line\">        render_kw=&#123;<span class=\"string\">&#x27;class&#x27;</span>: <span class=\"string\">&#x27;form-control&#x27;</span>&#125;</span><br><span class=\"line\">    )</span><br><span class=\"line\"></span><br><span class=\"line\">    pwd_confirm = simple.PasswordField(</span><br><span class=\"line\">        label=<span class=\"string\">&#x27;重复密码&#x27;</span>,</span><br><span class=\"line\">        validators=[</span><br><span class=\"line\">            validators.DataRequired(message=<span class=\"string\">&#x27;重复密码不能为空.&#x27;</span>),</span><br><span class=\"line\">            validators.EqualTo(<span class=\"string\">&#x27;pwd&#x27;</span>, message=<span class=\"string\">&quot;两次密码输入不一致&quot;</span>)</span><br><span class=\"line\">        ],</span><br><span class=\"line\">        widget=widgets.PasswordInput(),</span><br><span class=\"line\">        render_kw=&#123;<span class=\"string\">&#x27;class&#x27;</span>: <span class=\"string\">&#x27;form-control&#x27;</span>&#125;</span><br><span class=\"line\">    )</span><br><span class=\"line\"></span><br><span class=\"line\">    email = html5.EmailField(</span><br><span class=\"line\">        label=<span class=\"string\">&#x27;邮箱&#x27;</span>,</span><br><span class=\"line\">        validators=[</span><br><span class=\"line\">            validators.DataRequired(message=<span class=\"string\">&#x27;邮箱不能为空.&#x27;</span>),</span><br><span class=\"line\">            validators.Email(message=<span class=\"string\">&#x27;邮箱格式错误&#x27;</span>)</span><br><span class=\"line\">        ],</span><br><span class=\"line\">        widget=widgets.TextInput(input_type=<span class=\"string\">&#x27;email&#x27;</span>),</span><br><span class=\"line\">        render_kw=&#123;<span class=\"string\">&#x27;class&#x27;</span>: <span class=\"string\">&#x27;form-control&#x27;</span>&#125;</span><br><span class=\"line\">    )</span><br><span class=\"line\"></span><br><span class=\"line\">    gender = core.RadioField(</span><br><span class=\"line\">        label=<span class=\"string\">&#x27;性别&#x27;</span>,</span><br><span class=\"line\">        choices=(</span><br><span class=\"line\">            (<span class=\"number\">1</span>, <span class=\"string\">&#x27;男&#x27;</span>),</span><br><span class=\"line\">            (<span class=\"number\">2</span>, <span class=\"string\">&#x27;女&#x27;</span>),</span><br><span class=\"line\">        ),</span><br><span class=\"line\">        coerce=<span class=\"built_in\">int</span> <span class=\"comment\"># “1” “2”</span></span><br><span class=\"line\">     )</span><br><span class=\"line\">    city = core.SelectField(</span><br><span class=\"line\">        label=<span class=\"string\">&#x27;城市&#x27;</span>,</span><br><span class=\"line\">        choices=(</span><br><span class=\"line\">            (<span class=\"string\">&#x27;bj&#x27;</span>, <span class=\"string\">&#x27;北京&#x27;</span>),</span><br><span class=\"line\">            (<span class=\"string\">&#x27;sh&#x27;</span>, <span class=\"string\">&#x27;上海&#x27;</span>),</span><br><span class=\"line\">        )</span><br><span class=\"line\">    )</span><br><span class=\"line\"></span><br><span class=\"line\">    hobby = core.SelectMultipleField(</span><br><span class=\"line\">        label=<span class=\"string\">&#x27;爱好&#x27;</span>,</span><br><span class=\"line\">        choices=(</span><br><span class=\"line\">            (<span class=\"number\">1</span>, <span class=\"string\">&#x27;篮球&#x27;</span>),</span><br><span class=\"line\">            (<span class=\"number\">2</span>, <span class=\"string\">&#x27;足球&#x27;</span>),</span><br><span class=\"line\">        ),</span><br><span class=\"line\">        coerce=<span class=\"built_in\">int</span></span><br><span class=\"line\">    )</span><br><span class=\"line\"></span><br><span class=\"line\">    favor = core.SelectMultipleField(</span><br><span class=\"line\">        label=<span class=\"string\">&#x27;喜好&#x27;</span>,</span><br><span class=\"line\">        choices=(</span><br><span class=\"line\">            (<span class=\"number\">1</span>, <span class=\"string\">&#x27;篮球&#x27;</span>),</span><br><span class=\"line\">            (<span class=\"number\">2</span>, <span class=\"string\">&#x27;足球&#x27;</span>),</span><br><span class=\"line\">        ),</span><br><span class=\"line\">        widget=widgets.ListWidget(prefix_label=<span class=\"literal\">False</span>),</span><br><span class=\"line\">        option_widget=widgets.CheckboxInput(),</span><br><span class=\"line\">        coerce=<span class=\"built_in\">int</span>,</span><br><span class=\"line\">        default=[<span class=\"number\">1</span>, <span class=\"number\">2</span>]</span><br><span class=\"line\">    )</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span>(<span class=\"params\">self, *args, **kwargs</span>):</span></span><br><span class=\"line\">        <span class=\"built_in\">super</span>(RegisterForm, self).__init__(*args, **kwargs)</span><br><span class=\"line\">        self.favor.choices = ((<span class=\"number\">1</span>, <span class=\"string\">&#x27;篮球&#x27;</span>), (<span class=\"number\">2</span>, <span class=\"string\">&#x27;足球&#x27;</span>), (<span class=\"number\">3</span>, <span class=\"string\">&#x27;羽毛球&#x27;</span>))</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">validate_pwd_confirm</span>(<span class=\"params\">self, field</span>):</span></span><br><span class=\"line\">        <span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">        自定义pwd_confirm字段规则，例：与pwd字段是否一致</span></span><br><span class=\"line\"><span class=\"string\">        :param field:</span></span><br><span class=\"line\"><span class=\"string\">        :return:</span></span><br><span class=\"line\"><span class=\"string\">        &quot;&quot;&quot;</span></span><br><span class=\"line\">        <span class=\"comment\"># 最开始初始化时，self.data中已经有所有的值</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> field.data != self.data[<span class=\"string\">&#x27;pwd&#x27;</span>]:</span><br><span class=\"line\">            <span class=\"comment\"># raise validators.ValidationError(&quot;密码不一致&quot;) # 继续后续验证</span></span><br><span class=\"line\">            <span class=\"keyword\">raise</span> validators.StopValidation(<span class=\"string\">&quot;密码不一致&quot;</span>)  <span class=\"comment\"># 不再继续后续验证</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&#x27;/register&#x27;</span>, methods=[<span class=\"string\">&#x27;GET&#x27;</span>, <span class=\"string\">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">register</span>():</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> request.method == <span class=\"string\">&#x27;GET&#x27;</span>:</span><br><span class=\"line\">        form = RegisterForm(data=&#123;<span class=\"string\">&#x27;gender&#x27;</span>: <span class=\"number\">2</span>,<span class=\"string\">&#x27;hobby&#x27;</span>:[<span class=\"number\">1</span>,]&#125;) <span class=\"comment\"># initial</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> render_template(<span class=\"string\">&#x27;register.html&#x27;</span>, form=form)</span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        form = RegisterForm(formdata=request.form)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> form.validate():</span><br><span class=\"line\">            print(<span class=\"string\">&#x27;用户提交数据通过格式验证，提交的值为：&#x27;</span>, form.data)</span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            print(form.errors)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> render_template(<span class=\"string\">&#x27;register.html&#x27;</span>, form=form)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    app.run()</span><br><span class=\"line\">&lt;!DOCTYPE html&gt;</span><br><span class=\"line\">&lt;html lang=<span class=\"string\">&quot;en&quot;</span>&gt;</span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\">    &lt;meta charset=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span><br><span class=\"line\">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class=\"line\">&lt;/head&gt;</span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">&lt;h1&gt;用户注册&lt;/h1&gt;</span><br><span class=\"line\">&lt;form method=<span class=\"string\">&quot;post&quot;</span> novalidate style=<span class=\"string\">&quot;padding:0  50px&quot;</span>&gt;</span><br><span class=\"line\">    &#123;% <span class=\"keyword\">for</span> field <span class=\"keyword\">in</span> form %&#125;</span><br><span class=\"line\">    &lt;p&gt;&#123;&#123;field.label&#125;&#125;: &#123;&#123;field&#125;&#125; &#123;&#123;field.errors[0] &#125;&#125;&lt;/p&gt;</span><br><span class=\"line\">    &#123;% endfor %&#125;</span><br><span class=\"line\">    &lt;<span class=\"built_in\">input</span> <span class=\"built_in\">type</span>=<span class=\"string\">&quot;submit&quot;</span> value=<span class=\"string\">&quot;提交&quot;</span>&gt;</span><br><span class=\"line\">&lt;/form&gt;</span><br><span class=\"line\">&lt;/body&gt;</span><br><span class=\"line\">&lt;/html&gt;</span><br></pre></td></tr></table></figure>\n<h2 id=\"18信号\"><a class=\"markdownIt-Anchor\" href=\"#18信号\"></a> 18.信号</h2>\n<p>Flask框架中的信号基于blinker，其主要就是让开发者可是在flask请求过程中定制一些用户行为</p>\n<p>安装：<code>pip3 install blinker</code></p>\n<p>内置信号：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">request_started = _signals.signal(<span class=\"string\">&#x27;request-started&#x27;</span>)                <span class=\"comment\"># 请求到来前执行</span></span><br><span class=\"line\">request_finished = _signals.signal(<span class=\"string\">&#x27;request-finished&#x27;</span>)              <span class=\"comment\"># 请求结束后执行</span></span><br><span class=\"line\"> </span><br><span class=\"line\">before_render_template = _signals.signal(<span class=\"string\">&#x27;before-render-template&#x27;</span>)  <span class=\"comment\"># 模板渲染前执行</span></span><br><span class=\"line\">template_rendered = _signals.signal(<span class=\"string\">&#x27;template-rendered&#x27;</span>)            <span class=\"comment\"># 模板渲染后执行</span></span><br><span class=\"line\"> </span><br><span class=\"line\">got_request_exception = _signals.signal(<span class=\"string\">&#x27;got-request-exception&#x27;</span>)    <span class=\"comment\"># 请求执行出现异常时执行</span></span><br><span class=\"line\"> </span><br><span class=\"line\">request_tearing_down = _signals.signal(<span class=\"string\">&#x27;request-tearing-down&#x27;</span>)      <span class=\"comment\"># 请求执行完毕后自动执行（无论成功与否）</span></span><br><span class=\"line\">appcontext_tearing_down = _signals.signal(<span class=\"string\">&#x27;appcontext-tearing-down&#x27;</span>)<span class=\"comment\"># 应用上下文执行完毕后自动执行（无论成功与否）</span></span><br><span class=\"line\"> </span><br><span class=\"line\">appcontext_pushed = _signals.signal(<span class=\"string\">&#x27;appcontext-pushed&#x27;</span>)            <span class=\"comment\"># 应用上下文push时执行</span></span><br><span class=\"line\">appcontext_popped = _signals.signal(<span class=\"string\">&#x27;appcontext-popped&#x27;</span>)            <span class=\"comment\"># 应用上下文pop时执行</span></span><br><span class=\"line\">message_flashed = _signals.signal(<span class=\"string\">&#x27;message-flashed&#x27;</span>)                <span class=\"comment\"># 调用flask在其中添加数据时，自动触发</span></span><br></pre></td></tr></table></figure>\n<p>使用信号：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> Flask,signals,render_template</span><br><span class=\"line\"></span><br><span class=\"line\">app = Flask(__name__)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 往信号中注册函数</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">func</span>(<span class=\"params\">*args,**kwargs</span>):</span></span><br><span class=\"line\">    print(<span class=\"string\">&#x27;触发型号&#x27;</span>,args,kwargs)</span><br><span class=\"line\">signals.request_started.connect(func)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 触发信号： signals.request_started.send()</span></span><br><span class=\"line\"><span class=\"meta\">@app.before_first_request</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">before_first1</span>(<span class=\"params\">*args,**kwargs</span>):</span></span><br><span class=\"line\">    <span class=\"keyword\">pass</span></span><br><span class=\"line\"><span class=\"meta\">@app.before_first_request</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">before_first2</span>(<span class=\"params\">*args,**kwargs</span>):</span></span><br><span class=\"line\">    <span class=\"keyword\">pass</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.before_request</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">before_first3</span>(<span class=\"params\">*args,**kwargs</span>):</span></span><br><span class=\"line\">    <span class=\"keyword\">pass</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&#x27;/&#x27;</span>,methods=[<span class=\"string\">&#x27;GET&#x27;</span>,<span class=\"string\">&quot;POST&quot;</span>]</span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">index</span>():</span></span><br><span class=\"line\">    print(<span class=\"string\">&#x27;视图&#x27;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> render_template(<span class=\"string\">&#x27;index.html&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    app.wsgi_app</span><br><span class=\"line\">    app.run()</span><br></pre></td></tr></table></figure>\n<p>一个流程中的信号触发点（了解）</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a. before_first_request</span><br><span class=\"line\">b. 触发 request_started 信号</span><br><span class=\"line\">c. before_request</span><br><span class=\"line\">d. 模板渲染</span><br><span class=\"line\">\t渲染前的信号 before_render_template.send(app, template=template, context=context)</span><br><span class=\"line\">\t\trv = template.render(context) <span class=\"comment\"># 模板渲染</span></span><br><span class=\"line\">\t渲染后的信号 template_rendered.send(app, template=template, context=context)</span><br><span class=\"line\">e. after_request</span><br><span class=\"line\">f. session.save_session()</span><br><span class=\"line\">g. 触发 request_finished信号\t\t</span><br><span class=\"line\">\t如果上述过程出错：</span><br><span class=\"line\">\t\t触发错误处理信号 got_request_exception.send(self, exception=e)</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">h. 触发信号 request_tearing_down</span><br></pre></td></tr></table></figure>\n<p>自定义信号(了解)：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> Flask, current_app, flash, render_template</span><br><span class=\"line\"><span class=\"keyword\">from</span> flask.signals <span class=\"keyword\">import</span> _signals</span><br><span class=\"line\">app = Flask(import_name=__name__)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 自定义信号</span></span><br><span class=\"line\">xxxxx = _signals.signal(<span class=\"string\">&#x27;xxxxx&#x27;</span>)</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">func</span>(<span class=\"params\">sender, *args, **kwargs</span>):</span></span><br><span class=\"line\">    print(sender)</span><br><span class=\"line\"><span class=\"comment\"># 自定义信号中注册函数</span></span><br><span class=\"line\">xxxxx.connect(func)</span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&quot;/x&quot;</span></span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">index</span>():</span></span><br><span class=\"line\">    <span class=\"comment\"># 触发信号</span></span><br><span class=\"line\">    xxxxx.send(<span class=\"string\">&#x27;123123&#x27;</span>, k1=<span class=\"string\">&#x27;v1&#x27;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&#x27;Index&#x27;</span> </span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    app.run()</span><br></pre></td></tr></table></figure>\n<h2 id=\"19多app应用\"><a class=\"markdownIt-Anchor\" href=\"#19多app应用\"></a> 19.多app应用</h2>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> werkzeug.wsgi <span class=\"keyword\">import</span> DispatcherMiddleware</span><br><span class=\"line\"><span class=\"keyword\">from</span> werkzeug.serving <span class=\"keyword\">import</span> run_simple</span><br><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> Flask, current_app</span><br><span class=\"line\">app1 = Flask(<span class=\"string\">&#x27;app01&#x27;</span>)</span><br><span class=\"line\">app2 = Flask(<span class=\"string\">&#x27;app02&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app1.route(<span class=\"params\"><span class=\"string\">&#x27;/index&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">index</span>():</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&quot;app01&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app2.route(<span class=\"params\"><span class=\"string\">&#x27;/index2&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">index2</span>():</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&quot;app2&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># http://www.oldboyedu.com/index</span></span><br><span class=\"line\"><span class=\"comment\"># http://www.oldboyedu.com/sec/index2</span></span><br><span class=\"line\">dm = DispatcherMiddleware(app1, &#123;</span><br><span class=\"line\">    <span class=\"string\">&#x27;/sec&#x27;</span>: app2,</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&quot;__main__&quot;</span>:</span><br><span class=\"line\">    run_simple(<span class=\"string\">&#x27;localhost&#x27;</span>, <span class=\"number\">5000</span>, dm)</span><br></pre></td></tr></table></figure>\n<h2 id=\"20flask-script\"><a class=\"markdownIt-Anchor\" href=\"#20flask-script\"></a> 20.flask-script</h2>\n<p>用于实现类似于django中 python3 <a href=\"http://manage.py\">manage.py</a> runserver …类似的命令</p>\n<p>安装：pip3 install flask-script</p>\n<h3 id=\"使用\"><a class=\"markdownIt-Anchor\" href=\"#使用\"></a> 使用</h3>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> flask_script <span class=\"keyword\">import</span> Manager</span><br><span class=\"line\">app = Flask(__name__)</span><br><span class=\"line\">manager=Manager(app)</span><br><span class=\"line\">...</span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    manager.run()</span><br><span class=\"line\"><span class=\"comment\">#以后在执行，直接：python3 manage.py runserver</span></span><br><span class=\"line\"><span class=\"comment\">#python3 manage.py runserver --help</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"自定制命令\"><a class=\"markdownIt-Anchor\" href=\"#自定制命令\"></a> 自定制命令</h3>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@manager.command</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">custom</span>(<span class=\"params\">arg</span>):</span></span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">    自定义命令</span></span><br><span class=\"line\"><span class=\"string\">    python manage.py custom 123</span></span><br><span class=\"line\"><span class=\"string\">    :param arg:</span></span><br><span class=\"line\"><span class=\"string\">    :return:</span></span><br><span class=\"line\"><span class=\"string\">    &quot;&quot;&quot;</span></span><br><span class=\"line\">    print(arg)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@manager.option(<span class=\"params\"><span class=\"string\">&#x27;-n&#x27;</span>, <span class=\"string\">&#x27;--name&#x27;</span>, dest=<span class=\"string\">&#x27;name&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"comment\">#@manager.option(&#x27;-u&#x27;, &#x27;--url&#x27;, dest=&#x27;url&#x27;)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">cmd</span>(<span class=\"params\">name, url</span>):</span></span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">    自定义命令（-n也可以写成--name）</span></span><br><span class=\"line\"><span class=\"string\">    执行： python manage.py  cmd -n lqz -u http://www.oldboyedu.com</span></span><br><span class=\"line\"><span class=\"string\">    执行： python manage.py  cmd --name lqz --url http://www.oldboyedu.com</span></span><br><span class=\"line\"><span class=\"string\">    :param name:</span></span><br><span class=\"line\"><span class=\"string\">    :param url:</span></span><br><span class=\"line\"><span class=\"string\">    :return:</span></span><br><span class=\"line\"><span class=\"string\">    &quot;&quot;&quot;</span></span><br><span class=\"line\">    print(name, url)</span><br><span class=\"line\"><span class=\"comment\">#有什么用？</span></span><br><span class=\"line\"><span class=\"comment\">#把excel的数据导入数据库，定制个命令，去执行</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"21flask-admin\"><a class=\"markdownIt-Anchor\" href=\"#21flask-admin\"></a> 21flask-admin</h2>\n<h4 id=\"安装\"><a class=\"markdownIt-Anchor\" href=\"#安装\"></a> 安装</h4>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip3 install flask_admin</span><br></pre></td></tr></table></figure>\n<h4 id=\"简单使用\"><a class=\"markdownIt-Anchor\" href=\"#简单使用\"></a> 简单使用</h4>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> Flask</span><br><span class=\"line\"><span class=\"keyword\">from</span> flask_admin <span class=\"keyword\">import</span> Admin</span><br><span class=\"line\"></span><br><span class=\"line\">app = Flask(__name__)</span><br><span class=\"line\"><span class=\"comment\">#将app注册到adminzhong </span></span><br><span class=\"line\">admin = Admin(app)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__==<span class=\"string\">&quot;mian&quot;</span>:</span><br><span class=\"line\"></span><br><span class=\"line\">\tapp.run()</span><br><span class=\"line\"><span class=\"comment\">#访问</span></span><br><span class=\"line\"><span class=\"comment\">#127.0.0.1:5000/admin端口，会得到一个空白的页面</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"将表模型注册到admin中\"><a class=\"markdownIt-Anchor\" href=\"#将表模型注册到admin中\"></a> 将表模型注册到admin中</h4>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#在将表注册之前应该对app进行配置</span></span><br><span class=\"line\">SQLALCHEMY_DATABASE_URI = <span class=\"string\">&quot;mysql+pymysql://root:@127.0.0.1:3307/py9api?charset=utf8mb4&quot;</span></span><br><span class=\"line\">SQLALCHEMY_POOL_SIZE = <span class=\"number\">5</span></span><br><span class=\"line\">SQLALCHEMY_POOL_TIMEOUT = <span class=\"number\">30</span></span><br><span class=\"line\">SQLALCHEMY_POOL_RECYCLE = -<span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#导入models文件的中的表模型</span></span><br><span class=\"line\"><span class=\"keyword\">from</span> flask_admin.contrib.sqla <span class=\"keyword\">import</span> ModelView</span><br><span class=\"line\"><span class=\"keyword\">from</span> api.models <span class=\"keyword\">import</span> Stock,Product,Images,Category,Wxuser,Banner</span><br><span class=\"line\"></span><br><span class=\"line\">admin.add_view(ModelView(Stock, db.session))</span><br><span class=\"line\">admin.add_view(ModelView(Product, db.session))</span><br><span class=\"line\"></span><br><span class=\"line\">admin.add_view(ModelView(Category, db.session))</span><br></pre></td></tr></table></figure>\n<h4 id=\"如果有个字段是图片指端\"><a class=\"markdownIt-Anchor\" href=\"#如果有个字段是图片指端\"></a> 如果有个字段是图片指端</h4>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#配置上传文件的路径</span></span><br><span class=\"line\"><span class=\"comment\">#导入from flask_admin.contrib.fileadmin import FileAdmin</span></span><br><span class=\"line\"><span class=\"keyword\">from</span> flask_admin.contrib.fileadmin <span class=\"keyword\">import</span> FileAdmin,form</span><br><span class=\"line\">file_path = op.join(op.dirname(__file__), <span class=\"string\">&#x27;static&#x27;</span>)</span><br><span class=\"line\">admin = Admin(app)</span><br><span class=\"line\">admin.add_view(FileAdmin(file_path, <span class=\"string\">&#x27;/static/&#x27;</span>, name=<span class=\"string\">&#x27;文件&#x27;</span>))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#如果有个字段要是上传文件重写该方法的modleView类，假设imgae_url是文件图片的字段</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ImagesView</span>(<span class=\"params\">ModelView</span>):</span></span><br><span class=\"line\"></span><br><span class=\"line\">    form_extra_fields = &#123;</span><br><span class=\"line\">        <span class=\"string\">&#x27;image_url&#x27;</span>: form.ImageUploadField(<span class=\"string\">&#x27;Image&#x27;</span>,</span><br><span class=\"line\">                                          base_path=file_path,</span><br><span class=\"line\">                                          relative_path=<span class=\"string\">&#x27;uploadFile/&#x27;</span></span><br><span class=\"line\">                                          )</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">admin.add_view(ImagesView(Images, db.session))</span><br></pre></td></tr></table></figure>\n","more":"<meta name=\"referrer\" content=\"no-referrer\"/>\n<h2 id=\"0flask简介\"><a class=\"markdownIt-Anchor\" href=\"#0flask简介\"></a> 0.Flask简介</h2>\n<p>Flask是一个基于Python开发并且依赖jinja2模板和Werkzeug WSGI服务的一个微型框架，对于Werkzeug本质是Socket服务端，其用于接收http请求并对请求进行预处理，然后触发Flask框架，开发人员基于Flask框架提供的功能对请求进行相应的处理，并返回给用户，如果要返回给用户复杂的内容时，需要借助jinja2模板来实现对模板的处理，即：将模板和数据进行渲染，将渲染后的字符串返回给用户浏览器。</p>\n<p>“微”(micro) 并不表示你需要把整个 Web 应用塞进单个 Python 文件（虽然确实可以 ），也不意味着 Flask 在功能上有所欠缺。微框架中的“微”意味着 Flask 旨在保持核心简单而易于扩展。Flask 不会替你做出太多决策——比如使用何种数据库。而那些 Flask 所选择的——比如使用何种模板引擎——则很容易替换。除此之外的一切都由可由你掌握。如此，Flask 可以与您珠联璧合。</p>\n<p>默认情况下，Flask 不包含数据库抽象层、表单验证，或是其它任何已有多种库可以胜任的功能。然而，Flask 支持用扩展来给应用添加这些功能，如同是 Flask 本身实现的一样。众多的扩展提供了数据库集成、表单验证、上传处理、各种各样的开放认证技术等功能。Flask 也许是“微小”的，但它已准备好在需求繁杂的生产环境中投入使用</p>\n<h3 id=\"wsgiref\"><a class=\"markdownIt-Anchor\" href=\"#wsgiref\"></a> wsgiref</h3>\n<p>最简单的Web应用就是先把HTML用文件保存好，用一个现成的HTTP服务器软件，接收用户请求，从文件中读取HTML，返回。</p>\n<p>如果要动态生成HTML，就需要把上述步骤自己来实现。不过，接受HTTP请求、解析HTTP请求、发送HTTP响应都是苦力活，如果我们自己来写这些底层代码，还没开始写动态HTML呢，就得花个把月去读HTTP规范。</p>\n<p>正确的做法是底层代码由专门的服务器软件实现，我们用Python专注于生成HTML文档。因为我们不希望接触到TCP连接、HTTP原始请求和响应格式，所以，需要一个统一的接口协议来实现这样的服务器软件，让我们专心用Python编写Web业务。这个接口就是WSGI：Web Server Gateway Interface。而wsgiref模块就是python基于wsgi协议开发的服务模块</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> wsgiref.simple_server <span class=\"keyword\">import</span> make_server</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">mya</span>(<span class=\"params\">environ, start_response</span>):</span></span><br><span class=\"line\">    print(environ)</span><br><span class=\"line\">    start_response(<span class=\"string\">&#x27;200 OK&#x27;</span>, [(<span class=\"string\">&#x27;Content-Type&#x27;</span>, <span class=\"string\">&#x27;text/html&#x27;</span>)])</span><br><span class=\"line\">    <span class=\"keyword\">if</span> environ.get(<span class=\"string\">&#x27;PATH_INFO&#x27;</span>) == <span class=\"string\">&#x27;/index&#x27;</span>:</span><br><span class=\"line\">        <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(<span class=\"string\">&#x27;index.html&#x27;</span>,<span class=\"string\">&#x27;rb&#x27;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">            data=f.read()</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">elif</span> environ.get(<span class=\"string\">&#x27;PATH_INFO&#x27;</span>) == <span class=\"string\">&#x27;/login&#x27;</span>:</span><br><span class=\"line\">        <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(<span class=\"string\">&#x27;login.html&#x27;</span>, <span class=\"string\">&#x27;rb&#x27;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">            data = f.read()</span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        data=<span class=\"string\">b&#x27;&lt;h1&gt;Hello, web!&lt;/h1&gt;&#x27;</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> [data]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    myserver = make_server(<span class=\"string\">&#x27;&#x27;</span>, <span class=\"number\">8011</span>, mya)</span><br><span class=\"line\">    print(<span class=\"string\">&#x27;监听8010&#x27;</span>)</span><br><span class=\"line\">    myserver.serve_forever()</span><br><span class=\"line\"></span><br><span class=\"line\">wsgiref简单应用</span><br></pre></td></tr></table></figure>\n<h2 id=\"1安装\"><a class=\"markdownIt-Anchor\" href=\"#1安装\"></a> 1.安装</h2>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip3 install flask</span><br></pre></td></tr></table></figure>\n<h2 id=\"2werkzeug简介\"><a class=\"markdownIt-Anchor\" href=\"#2werkzeug简介\"></a> 2.werkzeug简介</h2>\n<p>Werkzeug是一个WSGI工具包，他可以作为一个Web框架的底层库。这里稍微说一下， werkzeug 不是一个web服务器，也不是一个web框架，而是一个工具包，官方的介绍说是一个 WSGI 工具包，它可以作为一个 Web 框架的底层库，因为它封装好了很多 Web 框架的东西，例如 Request，Response 等等</p>\n<p>代码示例：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> werkzeug.wrappers <span class=\"keyword\">import</span> Request, Response</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Request.application</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">hello</span>(<span class=\"params\">request</span>):</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> Response(<span class=\"string\">&#x27;Hello World!&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    <span class=\"keyword\">from</span> werkzeug.serving <span class=\"keyword\">import</span> run_simple</span><br><span class=\"line\">    run_simple(<span class=\"string\">&#x27;localhost&#x27;</span>, <span class=\"number\">4000</span>, hello)</span><br></pre></td></tr></table></figure>\n<h2 id=\"3flask快速使用\"><a class=\"markdownIt-Anchor\" href=\"#3flask快速使用\"></a> 3.flask快速使用</h2>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> Flask</span><br><span class=\"line\"><span class=\"comment\"># 实例化产生一个Flask对象</span></span><br><span class=\"line\">app = Flask(__name__)</span><br><span class=\"line\"><span class=\"comment\"># 将 &#x27;/&#x27;和视图函数hello_workd的对应关系添加到路由中</span></span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&#x27;/&#x27;</span></span>) </span><span class=\"comment\"># 1. v=app.route(&#x27;/&#x27;) 2. v(hello_world)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">hello_world</span>():</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&#x27;Hello World!&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    app.run() <span class=\"comment\"># 最终调用了run_simple()</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"案例登录显示用户信息\"><a class=\"markdownIt-Anchor\" href=\"#案例登录显示用户信息\"></a> 案例：登录，显示用户信息</h3>\n<p><a href=\"http://main.py\">main.py</a></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> Flask,render_template,request,redirect,session,url_for</span><br><span class=\"line\">app = Flask(__name__)</span><br><span class=\"line\">app.debug = <span class=\"literal\">True</span></span><br><span class=\"line\">app.secret_key = <span class=\"string\">&#x27;sdfsdfsdfsdf&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">USERS = &#123;</span><br><span class=\"line\">    <span class=\"number\">1</span>:&#123;<span class=\"string\">&#x27;name&#x27;</span>:<span class=\"string\">&#x27;张三&#x27;</span>,<span class=\"string\">&#x27;age&#x27;</span>:<span class=\"number\">18</span>,<span class=\"string\">&#x27;gender&#x27;</span>:<span class=\"string\">&#x27;男&#x27;</span>,<span class=\"string\">&#x27;text&#x27;</span>:<span class=\"string\">&quot;道路千万条&quot;</span>&#125;,</span><br><span class=\"line\">    <span class=\"number\">2</span>:&#123;<span class=\"string\">&#x27;name&#x27;</span>:<span class=\"string\">&#x27;李四&#x27;</span>,<span class=\"string\">&#x27;age&#x27;</span>:<span class=\"number\">28</span>,<span class=\"string\">&#x27;gender&#x27;</span>:<span class=\"string\">&#x27;男&#x27;</span>,<span class=\"string\">&#x27;text&#x27;</span>:<span class=\"string\">&quot;安全第一条&quot;</span>&#125;,</span><br><span class=\"line\">    <span class=\"number\">3</span>:&#123;<span class=\"string\">&#x27;name&#x27;</span>:<span class=\"string\">&#x27;王五&#x27;</span>,<span class=\"string\">&#x27;age&#x27;</span>:<span class=\"number\">18</span>,<span class=\"string\">&#x27;gender&#x27;</span>:<span class=\"string\">&#x27;女&#x27;</span>,<span class=\"string\">&#x27;text&#x27;</span>:<span class=\"string\">&quot;行车不规范&quot;</span>&#125;,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&#x27;/detail/&lt;int:nid&gt;&#x27;</span>,methods=[<span class=\"string\">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">detail</span>(<span class=\"params\">nid</span>):</span></span><br><span class=\"line\">    user = session.get(<span class=\"string\">&#x27;user_info&#x27;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> user:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> redirect(<span class=\"string\">&#x27;/login&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    info = USERS.get(nid)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> render_template(<span class=\"string\">&#x27;detail.html&#x27;</span>,info=info)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&#x27;/index&#x27;</span>,methods=[<span class=\"string\">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">index</span>():</span></span><br><span class=\"line\">    user = session.get(<span class=\"string\">&#x27;user_info&#x27;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> user:</span><br><span class=\"line\">        <span class=\"comment\"># return redirect(&#x27;/login&#x27;)</span></span><br><span class=\"line\">        url = url_for(<span class=\"string\">&#x27;l1&#x27;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> redirect(url)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> render_template(<span class=\"string\">&#x27;index.html&#x27;</span>,user_dict=USERS)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&#x27;/login&#x27;</span>,methods=[<span class=\"string\">&#x27;GET&#x27;</span>,<span class=\"string\">&#x27;POST&#x27;</span>],endpoint=<span class=\"string\">&#x27;l1&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">login</span>():</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> request.method == <span class=\"string\">&quot;GET&quot;</span>:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> render_template(<span class=\"string\">&#x27;login.html&#x27;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        <span class=\"comment\"># request.query_string</span></span><br><span class=\"line\">        user = request.form.get(<span class=\"string\">&#x27;user&#x27;</span>)</span><br><span class=\"line\">        pwd = request.form.get(<span class=\"string\">&#x27;pwd&#x27;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> user == <span class=\"string\">&#x27;cxw&#x27;</span> <span class=\"keyword\">and</span> pwd == <span class=\"string\">&#x27;123&#x27;</span>:</span><br><span class=\"line\">            session[<span class=\"string\">&#x27;user_info&#x27;</span>] = user</span><br><span class=\"line\">            <span class=\"keyword\">return</span> redirect(<span class=\"string\">&#x27;http://www.baidu.com&#x27;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> render_template(<span class=\"string\">&#x27;login.html&#x27;</span>,error=<span class=\"string\">&#x27;用户名或密码错误&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    app.run()</span><br></pre></td></tr></table></figure>\n<p>detail.html</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Title<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>详细信息 &#123;&#123;info.name&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        &#123;&#123;info.text&#125;&#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>index.html</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Title<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>用户列表<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">table</span>&gt;</span></span><br><span class=\"line\">        &#123;% for k,v in user_dict.items() %&#125;</span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">tr</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>&#123;&#123;k&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>&#123;&#123;v.name&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>&#123;&#123;v[&#x27;name&#x27;]&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>&#123;&#123;v.get(&#x27;name&#x27;)&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;/detail/&#123;&#123;k&#125;&#125;&quot;</span>&gt;</span>查看详细<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">tr</span>&gt;</span></span><br><span class=\"line\">        &#123;% endfor %&#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">table</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>login.html</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Title<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>用户登录<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">form</span> <span class=\"attr\">method</span>=<span class=\"string\">&quot;post&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;user&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;pwd&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;submit&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;登录&quot;</span>&gt;</span>&#123;&#123;error&#125;&#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">form</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"作业登录认证装饰器\"><a class=\"markdownIt-Anchor\" href=\"#作业登录认证装饰器\"></a> 作业：登录认证装饰器</h3>\n<p>-多个装饰器执行顺序</p>\n<p>-反向查找的名称（endpoint），不允许重复</p>\n<h2 id=\"4配置文件\"><a class=\"markdownIt-Anchor\" href=\"#4配置文件\"></a> 4.配置文件</h2>\n<p>flask中的配置文件是一个flask.config.Config对象（继承字典）,默认配置为：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"string\">&#x27;DEBUG&#x27;</span>:                                <span class=\"literal\">False</span>  <span class=\"comment\"># get_debug_flag(default=False),  是否开启Debug模式</span></span><br><span class=\"line\">    <span class=\"string\">&#x27;TESTING&#x27;</span>:                              <span class=\"literal\">False</span>, <span class=\"comment\"># 是否开启测试模式</span></span><br><span class=\"line\">    <span class=\"string\">&#x27;PROPAGATE_EXCEPTIONS&#x27;</span>:                 <span class=\"literal\">None</span>,                          </span><br><span class=\"line\">    <span class=\"string\">&#x27;PRESERVE_CONTEXT_ON_EXCEPTION&#x27;</span>:        <span class=\"literal\">None</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;SECRET_KEY&#x27;</span>:                           <span class=\"literal\">None</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;PERMANENT_SESSION_LIFETIME&#x27;</span>:           timedelta(days=<span class=\"number\">31</span>),</span><br><span class=\"line\">    <span class=\"string\">&#x27;USE_X_SENDFILE&#x27;</span>:                       <span class=\"literal\">False</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;LOGGER_NAME&#x27;</span>:                          <span class=\"literal\">None</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;LOGGER_HANDLER_POLICY&#x27;</span>:               <span class=\"string\">&#x27;always&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;SERVER_NAME&#x27;</span>:                          <span class=\"literal\">None</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;APPLICATION_ROOT&#x27;</span>:                     <span class=\"literal\">None</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;SESSION_COOKIE_NAME&#x27;</span>:                  <span class=\"string\">&#x27;session&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;SESSION_COOKIE_DOMAIN&#x27;</span>:                <span class=\"literal\">None</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;SESSION_COOKIE_PATH&#x27;</span>:                  <span class=\"literal\">None</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;SESSION_COOKIE_HTTPONLY&#x27;</span>:              <span class=\"literal\">True</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;SESSION_COOKIE_SECURE&#x27;</span>:                <span class=\"literal\">False</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;SESSION_REFRESH_EACH_REQUEST&#x27;</span>:         <span class=\"literal\">True</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;MAX_CONTENT_LENGTH&#x27;</span>:                   <span class=\"literal\">None</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;SEND_FILE_MAX_AGE_DEFAULT&#x27;</span>:            timedelta(hours=<span class=\"number\">12</span>),</span><br><span class=\"line\">    <span class=\"string\">&#x27;TRAP_BAD_REQUEST_ERRORS&#x27;</span>:              <span class=\"literal\">False</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;TRAP_HTTP_EXCEPTIONS&#x27;</span>:                 <span class=\"literal\">False</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;EXPLAIN_TEMPLATE_LOADING&#x27;</span>:             <span class=\"literal\">False</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;PREFERRED_URL_SCHEME&#x27;</span>:                 <span class=\"string\">&#x27;http&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;JSON_AS_ASCII&#x27;</span>:                        <span class=\"literal\">True</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;JSON_SORT_KEYS&#x27;</span>:                       <span class=\"literal\">True</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;JSONIFY_PRETTYPRINT_REGULAR&#x27;</span>:          <span class=\"literal\">True</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;JSONIFY_MIMETYPE&#x27;</span>:                     <span class=\"string\">&#x27;application/json&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;TEMPLATES_AUTO_RELOAD&#x27;</span>:                <span class=\"literal\">None</span>,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"方式一\"><a class=\"markdownIt-Anchor\" href=\"#方式一\"></a> 方式一</h3>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app.config[<span class=\"string\">&#x27;DEBUG&#x27;</span>] = <span class=\"literal\">True</span></span><br><span class=\"line\">   PS： 由于Config对象本质上是字典，所以还可以使用app.config.update(...)</span><br></pre></td></tr></table></figure>\n<h3 id=\"方式二\"><a class=\"markdownIt-Anchor\" href=\"#方式二\"></a> 方式二</h3>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#通过py文件配置</span></span><br><span class=\"line\">app.config.from_pyfile(<span class=\"string\">&quot;python文件名称&quot;</span>)</span><br><span class=\"line\">如：</span><br><span class=\"line\">settings.py</span><br><span class=\"line\">DEBUG = <span class=\"literal\">True</span></span><br><span class=\"line\"></span><br><span class=\"line\">app.config.from_pyfile(<span class=\"string\">&quot;settings.py&quot;</span>)</span><br><span class=\"line\"><span class=\"comment\">#通过环境变量配置</span></span><br><span class=\"line\">app.config.from_envvar(<span class=\"string\">&quot;环境变量名称&quot;</span>)</span><br><span class=\"line\"><span class=\"comment\">#app.config.from_pyfile(os.environ[&#x27;YOURAPPLICATION_SETTINGS&#x27;])</span></span><br><span class=\"line\">环境变量的值为python文件名称名称，内部调用from_pyfile方法</span><br><span class=\"line\"></span><br><span class=\"line\">app.config.from_json(<span class=\"string\">&quot;json文件名称&quot;</span>)</span><br><span class=\"line\">JSON文件名称，必须是json格式，因为内部会执行json.loads</span><br><span class=\"line\"></span><br><span class=\"line\">app.config.from_mapping(&#123;<span class=\"string\">&#x27;DEBUG&#x27;</span>: <span class=\"literal\">True</span>&#125;)</span><br><span class=\"line\">字典格式</span><br><span class=\"line\"></span><br><span class=\"line\">app.config.from_object(<span class=\"string\">&quot;python类或类的路径&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">app.config.from_object(<span class=\"string\">&#x27;pro_flask.settings.TestingConfig&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">settings.py</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Config</span>(<span class=\"params\"><span class=\"built_in\">object</span></span>):</span></span><br><span class=\"line\">    DEBUG = <span class=\"literal\">False</span></span><br><span class=\"line\">    TESTING = <span class=\"literal\">False</span></span><br><span class=\"line\">    DATABASE_URI = <span class=\"string\">&#x27;sqlite://:memory:&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ProductionConfig</span>(<span class=\"params\">Config</span>):</span></span><br><span class=\"line\">    DATABASE_URI = <span class=\"string\">&#x27;mysql://user@localhost/foo&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DevelopmentConfig</span>(<span class=\"params\">Config</span>):</span></span><br><span class=\"line\">    DEBUG = <span class=\"literal\">True</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TestingConfig</span>(<span class=\"params\">Config</span>):</span></span><br><span class=\"line\">    TESTING = <span class=\"literal\">True</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">PS: 从sys.path中已经存在路径开始写</span><br><span class=\"line\"></span><br><span class=\"line\">PS: settings.py文件默认路径要放在程序root_path目录，如果instance_relative_config为<span class=\"literal\">True</span>，则就是instance_path目录（Flask对象init方法的参数）</span><br></pre></td></tr></table></figure>\n<h3 id=\"典型写法\"><a class=\"markdownIt-Anchor\" href=\"#典型写法\"></a> 典型写法</h3>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&#x27;/detail/&lt;int:nid&gt;&#x27;</span>,methods=[<span class=\"string\">&#x27;GET&#x27;</span>],endpoint=<span class=\"string\">&#x27;detail&#x27;</span></span>)</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"默认转换器\"><a class=\"markdownIt-Anchor\" href=\"#默认转换器\"></a> 默认转换器</h3>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">DEFAULT_CONVERTERS = &#123;</span><br><span class=\"line\">    <span class=\"string\">&#x27;default&#x27;</span>:          UnicodeConverter,</span><br><span class=\"line\">    <span class=\"string\">&#x27;string&#x27;</span>:           UnicodeConverter,</span><br><span class=\"line\">    <span class=\"string\">&#x27;any&#x27;</span>:              AnyConverter,</span><br><span class=\"line\">    <span class=\"string\">&#x27;path&#x27;</span>:             PathConverter,</span><br><span class=\"line\">    <span class=\"string\">&#x27;int&#x27;</span>:              IntegerConverter,</span><br><span class=\"line\">    <span class=\"string\">&#x27;float&#x27;</span>:            FloatConverter,</span><br><span class=\"line\">    <span class=\"string\">&#x27;uuid&#x27;</span>:             UUIDConverter,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"路由系统本质\"><a class=\"markdownIt-Anchor\" href=\"#路由系统本质\"></a> 路由系统本质</h3>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">1. decorator = app.route(&#x27;/&#x27;,methods=[&#x27;GET&#x27;,&#x27;POST&#x27;],endpoint=&#x27;n1&#x27;)</span></span><br><span class=\"line\"><span class=\"string\">    def route(self, rule, **options):</span></span><br><span class=\"line\"><span class=\"string\">        # app对象</span></span><br><span class=\"line\"><span class=\"string\">        # rule= /</span></span><br><span class=\"line\"><span class=\"string\">        # options = &#123;methods=[&#x27;GET&#x27;,&#x27;POST&#x27;],endpoint=&#x27;n1&#x27;&#125;</span></span><br><span class=\"line\"><span class=\"string\">        def decorator(f):</span></span><br><span class=\"line\"><span class=\"string\">            endpoint = options.pop(&#x27;endpoint&#x27;, None)</span></span><br><span class=\"line\"><span class=\"string\">            self.add_url_rule(rule, endpoint, f, **options)</span></span><br><span class=\"line\"><span class=\"string\">            return f</span></span><br><span class=\"line\"><span class=\"string\">        return decorator</span></span><br><span class=\"line\"><span class=\"string\">2. @decorator</span></span><br><span class=\"line\"><span class=\"string\">    decorator(index)</span></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"comment\">#同理</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">login</span>():</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&#x27;登录&#x27;</span></span><br><span class=\"line\">app.add_url_rule(<span class=\"string\">&#x27;/login&#x27;</span>, <span class=\"string\">&#x27;n2&#x27;</span>, login, methods=[<span class=\"string\">&#x27;GET&#x27;</span>,<span class=\"string\">&quot;POST&quot;</span>])</span><br><span class=\"line\"><span class=\"comment\">#与django路由类似</span></span><br><span class=\"line\"><span class=\"comment\">#django与flask路由：flask路由基于装饰器，本质是基于：add_url_rule</span></span><br><span class=\"line\"><span class=\"comment\">#add_url_rule 源码中，endpoint如果为空，endpoint = _endpoint_from_view_func(view_func)，最终取view_func.__name__（函数名）</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"cbv源码分析\"><a class=\"markdownIt-Anchor\" href=\"#cbv源码分析\"></a> CBV(源码分析)</h3>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">auth</span>(<span class=\"params\">func</span>):</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">inner</span>(<span class=\"params\">*args, **kwargs</span>):</span></span><br><span class=\"line\">        print(<span class=\"string\">&#x27;before&#x27;</span>)</span><br><span class=\"line\">        result = func(*args, **kwargs)</span><br><span class=\"line\">        print(<span class=\"string\">&#x27;after&#x27;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> result</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> inner</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">IndexView</span>(<span class=\"params\">views.View</span>):</span></span><br><span class=\"line\">    methods = [<span class=\"string\">&#x27;GET&#x27;</span>]</span><br><span class=\"line\">    decorators = [auth, ]</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">dispatch_request</span>(<span class=\"params\">self</span>):</span></span><br><span class=\"line\">        print(<span class=\"string\">&#x27;Index&#x27;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&#x27;Index!&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">app.add_url_rule(<span class=\"string\">&#x27;/index&#x27;</span>, view_func=IndexView.as_view(name=<span class=\"string\">&#x27;index&#x27;</span>))  <span class=\"comment\"># name=endpoint</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#或者，通常用此方式</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">IndexView</span>(<span class=\"params\">views.MethodView</span>):</span></span><br><span class=\"line\">    methods = [<span class=\"string\">&#x27;GET&#x27;</span>]</span><br><span class=\"line\">    decorators = [auth, ]</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get</span>(<span class=\"params\">self</span>):</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&#x27;Index.GET&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">post</span>(<span class=\"params\">self</span>):</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&#x27;Index.POST&#x27;</span></span><br><span class=\"line\">    app.add_url_rule(<span class=\"string\">&#x27;/index&#x27;</span>, view_func=IndexView.as_view(name=<span class=\"string\">&#x27;index&#x27;</span>))  <span class=\"comment\"># name=endpoint</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"appadd_url_rule参数\"><a class=\"markdownIt-Anchor\" href=\"#appadd_url_rule参数\"></a> app.add_url_rule参数</h3>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@app.route和app.add_url_rule参数:</span></span><br><span class=\"line\">    </span><br><span class=\"line\">rule,       <span class=\"comment\"># URL规则</span></span><br><span class=\"line\">view_func,  <span class=\"comment\"># 视图函数名称</span></span><br><span class=\"line\">defaults = <span class=\"literal\">None</span>,  <span class=\"comment\"># 默认值, 当URL中无参数，函数需要参数时，使用defaults = &#123;&#x27;k&#x27;: &#x27;v&#x27;&#125;</span></span><br><span class=\"line\">为函数提供参数</span><br><span class=\"line\">endpoint = <span class=\"literal\">None</span>,  <span class=\"comment\"># 名称，用于反向生成URL，即： url_for(&#x27;名称&#x27;)</span></span><br><span class=\"line\">methods = <span class=\"literal\">None</span>,   <span class=\"comment\"># 允许的请求方式，如：[&quot;GET&quot;, &quot;POST&quot;]</span></span><br><span class=\"line\"><span class=\"comment\">#对URL最后的 / 符号是否严格要求</span></span><br><span class=\"line\">strict_slashes = <span class=\"literal\">None</span></span><br><span class=\"line\">    <span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"string\">        @app.route(&#x27;/index&#x27;, strict_slashes=False)</span></span><br><span class=\"line\"><span class=\"string\">        #访问http://www.xx.com/index/ 或http://www.xx.com/index均可</span></span><br><span class=\"line\"><span class=\"string\">        @app.route(&#x27;/index&#x27;, strict_slashes=True)</span></span><br><span class=\"line\"><span class=\"string\">        #仅访问http://www.xx.com/index</span></span><br><span class=\"line\"><span class=\"string\">    &#x27;&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"comment\">#重定向到指定地址</span></span><br><span class=\"line\">redirect_to = <span class=\"literal\">None</span>, </span><br><span class=\"line\">    <span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"string\">        @app.route(&#x27;/index/&lt;int:nid&gt;&#x27;, redirect_to=&#x27;/home/&lt;nid&gt;&#x27;)</span></span><br><span class=\"line\"><span class=\"string\">    &#x27;&#x27;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#子域名访问</span></span><br><span class=\"line\">subdomain = <span class=\"literal\">None</span>, </span><br><span class=\"line\">    <span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"string\">    #C:\\Windows\\System32\\drivers\\etc\\hosts</span></span><br><span class=\"line\"><span class=\"string\">    127.0.0.1       www.liuqingzheng.com</span></span><br><span class=\"line\"><span class=\"string\">\t127.0.0.1       admin.liuqingzheng.com</span></span><br><span class=\"line\"><span class=\"string\">\t127.0.0.1       buy.liuqingzheng.com</span></span><br><span class=\"line\"><span class=\"string\">    </span></span><br><span class=\"line\"><span class=\"string\">    from flask import Flask, views, url_for</span></span><br><span class=\"line\"><span class=\"string\">    app = Flask(import_name=__name__)</span></span><br><span class=\"line\"><span class=\"string\">    app.config[&#x27;SERVER_NAME&#x27;] = &#x27;liuqingzheng.com:5000&#x27;</span></span><br><span class=\"line\"><span class=\"string\">    @app.route(&quot;/&quot;, subdomain=&quot;admin&quot;)</span></span><br><span class=\"line\"><span class=\"string\">    def static_index():</span></span><br><span class=\"line\"><span class=\"string\">        &quot;&quot;&quot;Flask supports static subdomains</span></span><br><span class=\"line\"><span class=\"string\">        This is available at static.your-domain.tld&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">        return &quot;static.your-domain.tld&quot;</span></span><br><span class=\"line\"><span class=\"string\">    #可以传入任意的字符串，如传入的字符串为aa，显示为 aa.liuqingzheng.com</span></span><br><span class=\"line\"><span class=\"string\">    @app.route(&quot;/dynamic&quot;, subdomain=&quot;&lt;username&gt;&quot;)</span></span><br><span class=\"line\"><span class=\"string\">    def username_index(username):</span></span><br><span class=\"line\"><span class=\"string\">        &quot;&quot;&quot;Dynamic subdomains are also supported</span></span><br><span class=\"line\"><span class=\"string\">        Try going to user1.your-domain.tld/dynamic&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">        return username + &quot;.your-domain.tld&quot;</span></span><br><span class=\"line\"><span class=\"string\">    if __name__ == &#x27;__main__&#x27;:</span></span><br><span class=\"line\"><span class=\"string\">        app.run()</span></span><br><span class=\"line\"><span class=\"string\">        </span></span><br><span class=\"line\"><span class=\"string\">    访问：</span></span><br><span class=\"line\"><span class=\"string\">    http://www.liuqingzheng.com:5000/dynamic</span></span><br><span class=\"line\"><span class=\"string\">    http://admin.liuqingzheng.com:5000/dynamic</span></span><br><span class=\"line\"><span class=\"string\">    http://buy.liuqingzheng.com:5000/dynamic</span></span><br><span class=\"line\"><span class=\"string\">    &#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"支持正则\"><a class=\"markdownIt-Anchor\" href=\"#支持正则\"></a> 支持正则</h3>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#1 写类，继承BaseConverter</span></span><br><span class=\"line\"><span class=\"comment\">#2 注册：app.url_map.converters[&#x27;regex&#x27;] = RegexConverter</span></span><br><span class=\"line\"><span class=\"comment\">#3 使用：@app.route(&#x27;/index/&lt;regex(&quot;\\d+&quot;):nid&gt;&#x27;)  正则表达式会当作第二个参数传递到类中</span></span><br><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> Flask, views, url_for</span><br><span class=\"line\"><span class=\"keyword\">from</span> werkzeug.routing <span class=\"keyword\">import</span> BaseConverter</span><br><span class=\"line\"></span><br><span class=\"line\">app = Flask(import_name=__name__)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">RegexConverter</span>(<span class=\"params\">BaseConverter</span>):</span></span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">    自定义URL匹配正则表达式</span></span><br><span class=\"line\"><span class=\"string\">    &quot;&quot;&quot;</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span>(<span class=\"params\">self, <span class=\"built_in\">map</span>, regex</span>):</span></span><br><span class=\"line\">        <span class=\"built_in\">super</span>(RegexConverter, self).__init__(<span class=\"built_in\">map</span>)</span><br><span class=\"line\">        self.regex = regex</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">to_python</span>(<span class=\"params\">self, value</span>):</span></span><br><span class=\"line\">        <span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">        路由匹配时，匹配成功后传递给视图函数中参数的值</span></span><br><span class=\"line\"><span class=\"string\">        &quot;&quot;&quot;</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">int</span>(value)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">to_url</span>(<span class=\"params\">self, value</span>):</span></span><br><span class=\"line\">        <span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">        使用url_for反向生成URL时，传递的参数经过该方法处理，返回的值用于生成URL中的参数</span></span><br><span class=\"line\"><span class=\"string\">        &quot;&quot;&quot;</span></span><br><span class=\"line\">        val = <span class=\"built_in\">super</span>(RegexConverter, self).to_url(value)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> val</span><br><span class=\"line\"><span class=\"comment\"># 添加到flask中</span></span><br><span class=\"line\">app.url_map.converters[<span class=\"string\">&#x27;regex&#x27;</span>] = RegexConverter</span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&#x27;/index/&lt;regex(&quot;\\d+&quot;):nid&gt;&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">index</span>(<span class=\"params\">nid</span>):</span></span><br><span class=\"line\">    print(url_for(<span class=\"string\">&#x27;index&#x27;</span>, nid=<span class=\"string\">&#x27;888&#x27;</span>))</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&#x27;Index&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    app.run()</span><br></pre></td></tr></table></figure>\n<h2 id=\"6模版\"><a class=\"markdownIt-Anchor\" href=\"#6模版\"></a> 6.模版</h2>\n<h4 id=\"61渲染变量\"><a class=\"markdownIt-Anchor\" href=\"#61渲染变量\"></a> 6.1渲染变量</h4>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Title<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>用户列表<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">table</span>&gt;</span></span><br><span class=\"line\">        &#123;% for k,v in user_dict.items() %&#125;</span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">tr</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>&#123;&#123;k&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>&#123;&#123;v.name&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>&#123;&#123;v[&#x27;name&#x27;]&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>&#123;&#123;v.get(&#x27;name&#x27;)&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;/detail/&#123;&#123;k&#125;&#125;&quot;</span>&gt;</span>查看详细<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">tr</span>&gt;</span></span><br><span class=\"line\">        &#123;% endfor %&#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">table</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"62变量的循环\"><a class=\"markdownIt-Anchor\" href=\"#62变量的循环\"></a> 6.2变量的循环</h4>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Title<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>用户列表<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">table</span>&gt;</span></span><br><span class=\"line\">        &#123;% for k,v in user_dict.items() %&#125;</span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">tr</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>&#123;&#123;k&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>&#123;&#123;v.name&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>&#123;&#123;v[&#x27;name&#x27;]&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>&#123;&#123;v.get(&#x27;name&#x27;)&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;/detail/&#123;&#123;k&#125;&#125;&quot;</span>&gt;</span>查看详细<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">tr</span>&gt;</span></span><br><span class=\"line\">        &#123;% endfor %&#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">table</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"63逻辑判断\"><a class=\"markdownIt-Anchor\" href=\"#63逻辑判断\"></a> 6.3逻辑判断</h4>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Title<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>用户列表<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">table</span>&gt;</span></span><br><span class=\"line\">        &#123;% if name %&#125;</span><br><span class=\"line\">          <span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>Hello &#123;&#123; name &#125;&#125;!<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\">        &#123;% else %&#125;</span><br><span class=\"line\">          <span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>Hello World!<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\">        &#123;% endif %&#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">table</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>比django中多可以加括号，执行函数，传参数</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> Flask,render_template,Markup,jsonify,make_response</span><br><span class=\"line\">app = Flask(__name__)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">func1</span>(<span class=\"params\">arg</span>):</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> Markup(<span class=\"string\">&quot;&lt;input type=&#x27;text&#x27; value=&#x27;%s&#x27; /&gt;&quot;</span> %(arg,))</span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&#x27;/&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">index</span>():</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> render_template(<span class=\"string\">&#x27;index.html&#x27;</span>,ff = func1)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    app.run()</span><br></pre></td></tr></table></figure>\n<p>index.html</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Title<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    &#123;&#123;ff(&#x27;六五&#x27;)&#125;&#125;</span><br><span class=\"line\">\t&#123;&#123;ff(&#x27;六五&#x27;)|safe&#125;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>注意：</p>\n<p>1.Markup等价django的mark_safe ,</p>\n<p>2.extends,include一模一样</p>\n<h2 id=\"7请求响应\"><a class=\"markdownIt-Anchor\" href=\"#7请求响应\"></a> 7.请求响应</h2>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> Flask</span><br><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> request</span><br><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> render_template</span><br><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> redirect</span><br><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> make_response</span><br><span class=\"line\"></span><br><span class=\"line\">app = Flask(__name__)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&#x27;/login.html&#x27;</span>, methods=[<span class=\"string\">&#x27;GET&#x27;</span>, <span class=\"string\">&quot;POST&quot;</span>]</span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">login</span>():</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 请求相关信息</span></span><br><span class=\"line\">    <span class=\"comment\"># request.method  提交的方法</span></span><br><span class=\"line\">    <span class=\"comment\"># request.args  get请求提及的数据</span></span><br><span class=\"line\">    <span class=\"comment\"># request.form   post请求提交的数据</span></span><br><span class=\"line\">    <span class=\"comment\"># request.values  post和get提交的数据总和</span></span><br><span class=\"line\">    <span class=\"comment\"># request.cookies  客户端所带的cookie</span></span><br><span class=\"line\">    <span class=\"comment\"># request.headers  请求头</span></span><br><span class=\"line\">    <span class=\"comment\"># request.path     不带域名，请求路径</span></span><br><span class=\"line\">    <span class=\"comment\"># request.full_path  不带域名，带参数的请求路径</span></span><br><span class=\"line\">    <span class=\"comment\"># request.script_root  </span></span><br><span class=\"line\">    <span class=\"comment\"># request.url           带域名带参数的请求路径</span></span><br><span class=\"line\">    <span class=\"comment\"># request.base_url\t\t带域名请求路径</span></span><br><span class=\"line\">    <span class=\"comment\"># request.url_root      域名</span></span><br><span class=\"line\">    <span class=\"comment\"># request.host_url\t\t域名</span></span><br><span class=\"line\">    <span class=\"comment\"># request.host\t\t\t127.0.0.1:500</span></span><br><span class=\"line\">    <span class=\"comment\"># request.files</span></span><br><span class=\"line\">    <span class=\"comment\"># obj = request.files[&#x27;the_file_name&#x27;]</span></span><br><span class=\"line\">    <span class=\"comment\"># obj.save(&#x27;/var/www/uploads/&#x27; + secure_filename(f.filename))</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 响应相关信息</span></span><br><span class=\"line\">    <span class=\"comment\"># return &quot;字符串&quot;</span></span><br><span class=\"line\">    <span class=\"comment\"># return render_template(&#x27;html模板路径&#x27;,**&#123;&#125;)</span></span><br><span class=\"line\">    <span class=\"comment\"># return redirect(&#x27;/index.html&#x27;)</span></span><br><span class=\"line\">    <span class=\"comment\">#return jsonify(&#123;&#x27;k1&#x27;:&#x27;v1&#x27;&#125;)</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># response = make_response(render_template(&#x27;index.html&#x27;))</span></span><br><span class=\"line\">    <span class=\"comment\"># response是flask.wrappers.Response类型</span></span><br><span class=\"line\">    <span class=\"comment\"># response.delete_cookie(&#x27;key&#x27;)</span></span><br><span class=\"line\">    <span class=\"comment\"># response.set_cookie(&#x27;key&#x27;, &#x27;value&#x27;)</span></span><br><span class=\"line\">    <span class=\"comment\"># response.headers[&#x27;X-Something&#x27;] = &#x27;A value&#x27;</span></span><br><span class=\"line\">    <span class=\"comment\"># return response</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&quot;内容&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    app.run()</span><br></pre></td></tr></table></figure>\n<h2 id=\"8session\"><a class=\"markdownIt-Anchor\" href=\"#8session\"></a> 8.session</h2>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cookie:存放在客户端的键值对</span><br><span class=\"line\">session：存放在客户端的键值对</span><br><span class=\"line\">token:存放在客户端，通过算法来校验</span><br></pre></td></tr></table></figure>\n<p>在使用session之前必须现在设置一下密钥</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app.secret_key=<span class=\"string\">&quot;asdas&quot;</span> <span class=\"comment\">#值随便</span></span><br></pre></td></tr></table></figure>\n<p>除请求对象之外，还有一个 session 对象。它允许你在不同请求间存储特定用户的信息。它是在 Cookies 的基础上实现的，并且对 Cookies 进行密钥签名要使用会话，你需要设置一个密钥。 (app.session_interface对象)</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">设置：session[<span class=\"string\">&#x27;username&#x27;</span>] ＝ <span class=\"string\">&#x27;xxx&#x27;</span></span><br><span class=\"line\"><span class=\"comment\">#在django中发什么三件事，1，生成一个随机的字符串 2 往数据库存 3 写入cookie返回浏览器</span></span><br><span class=\"line\"><span class=\"comment\">#在flask中他没有数据库，但session是怎样实现的？</span></span><br><span class=\"line\">\t<span class=\"comment\"># 生成一个密钥写入这个cookie,然后下次请求的时候，通过这个cookie解密，然后赋值给session</span></span><br><span class=\"line\">    <span class=\"comment\">#我们通过app.session_interface来查看</span></span><br><span class=\"line\">  </span><br><span class=\"line\">删除：session.pop(<span class=\"string\">&#x27;username&#x27;</span>, <span class=\"literal\">None</span>)</span><br></pre></td></tr></table></figure>\n<h4 id=\"appsession_interface中save_session的参数设置cookie的参数\"><a class=\"markdownIt-Anchor\" href=\"#appsession_interface中save_session的参数设置cookie的参数\"></a> app.session_interface中save_session的参数（设置cookie的参数）</h4>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">key,             <span class=\"comment\"># 键</span></span><br><span class=\"line\">value=<span class=\"string\">&#x27;&#x27;</span>,        <span class=\"comment\"># 值</span></span><br><span class=\"line\">max_age=<span class=\"literal\">None</span>,    <span class=\"comment\"># 超时时间 cookie需要延续的时间（以秒为单位）如果参数是\\ None`` ，这个cookie会延续到浏览器关闭为止</span></span><br><span class=\"line\">expires=<span class=\"literal\">None</span>,    <span class=\"comment\"># 超时时间(IE requires expires, so set it if hasn&#x27;t been already.)</span></span><br><span class=\"line\">path=<span class=\"string\">&#x27;/&#x27;</span>,        <span class=\"comment\"># Cookie生效的路径，/ 表示根路径，特殊的：根路径的cookie可以被任何url的页面访问，浏览器只会把cookie回传给带有该路径的页面，这样可以避免将cookie传给站点中的其他的应用。</span></span><br><span class=\"line\">domain=<span class=\"literal\">None</span>,     <span class=\"comment\"># Cookie生效的域名 你可用这个参数来构造一个跨站cookie。如， domain=&quot;.example.com&quot;所构造的cookie对下面这些站点都是可读的：www.example.com 、 www2.example.com 和an.other.sub.domain.example.com 。如果该参数设置为 None ，cookie只能由设置它的站点读取</span></span><br><span class=\"line\">secure=<span class=\"literal\">False</span>,    <span class=\"comment\"># 浏览器将通过HTTPS来回传cookie</span></span><br><span class=\"line\">httponly=<span class=\"literal\">False</span>   <span class=\"comment\"># 只能http协议传输，无法被JavaScript获取（不是绝对，底层抓包可以获取到也可以被覆盖）</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"session源码的执行流程\"><a class=\"markdownIt-Anchor\" href=\"#session源码的执行流程\"></a> session源码的执行流程</h4>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-save_seesion</span><br><span class=\"line\">\t-响应的时候，把session中的值加密序列化放大到了cookie中，返回到浏览器中</span><br><span class=\"line\">-open_session</span><br><span class=\"line\">\t-请求来了，从cookie中取出值，反解，生成session对象，以后再视图函数中直接用sessoin就可以了。</span><br></pre></td></tr></table></figure>\n<h2 id=\"9闪现message\"><a class=\"markdownIt-Anchor\" href=\"#9闪现message\"></a> 9.闪现（message）</h2>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-设置:flash(<span class=\"string\">&#x27;aaa&#x27;</span>)</span><br><span class=\"line\">-取值：get_flashed_message()</span><br><span class=\"line\">-</span><br><span class=\"line\">-假设在a页面操作出错，跳转到b页面，在b页面显示a页面的错误信息</span><br></pre></td></tr></table></figure>\n<p>示例：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> Flask,flash,get_flashed_messages,request,redirect</span><br><span class=\"line\"></span><br><span class=\"line\">app = Flask(__name__)</span><br><span class=\"line\">app.secret_key = <span class=\"string\">&#x27;asdfasdf&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&#x27;/index&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">index</span>():</span></span><br><span class=\"line\">    <span class=\"comment\"># 从某个地方获取设置过的所有值，并清除。</span></span><br><span class=\"line\">    val = request.args.get(<span class=\"string\">&#x27;v&#x27;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> val == <span class=\"string\">&#x27;oldboy&#x27;</span>:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&#x27;Hello World!&#x27;</span></span><br><span class=\"line\">    flash(<span class=\"string\">&#x27;超时错误&#x27;</span>,category=<span class=\"string\">&quot;x1&quot;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&quot;ssdsdsdfsd&quot;</span></span><br><span class=\"line\">    <span class=\"comment\"># return redirect(&#x27;/error&#x27;)</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&#x27;/error&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">error</span>():</span></span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">    展示错误信息</span></span><br><span class=\"line\"><span class=\"string\">    :return:</span></span><br><span class=\"line\"><span class=\"string\">    如果get_flashed_messages(with_category=True)</span></span><br><span class=\"line\"><span class=\"string\">    &quot;&quot;&quot;</span></span><br><span class=\"line\">    data = get_flashed_messages(category_filter=[<span class=\"string\">&#x27;x1&#x27;</span>])</span><br><span class=\"line\">    <span class=\"keyword\">if</span> data:</span><br><span class=\"line\">        msg = data[<span class=\"number\">0</span>]</span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        msg = <span class=\"string\">&quot;...&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&quot;错误信息：%s&quot;</span> %(msg,)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    app.run()</span><br></pre></td></tr></table></figure>\n<h2 id=\"10请求扩展\"><a class=\"markdownIt-Anchor\" href=\"#10请求扩展\"></a> 10.请求扩展</h2>\n<h3 id=\"1-before_request\"><a class=\"markdownIt-Anchor\" href=\"#1-before_request\"></a> 1 before_request</h3>\n<p>类比django中间件中的process_request，在请求收到之前绑定一个函数做一些事情</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#基于它做用户登录认证</span></span><br><span class=\"line\"><span class=\"meta\">@app.before_request</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">process_request</span>(<span class=\"params\">*args,**kwargs</span>):</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> request.path == <span class=\"string\">&#x27;/login&#x27;</span>:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">None</span></span><br><span class=\"line\">    user = session.get(<span class=\"string\">&#x27;user_info&#x27;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> user:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">None</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> redirect(<span class=\"string\">&#x27;/login&#x27;</span>)</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-after_request\"><a class=\"markdownIt-Anchor\" href=\"#2-after_request\"></a> 2 after_request</h3>\n<p>类比django中间件中的process_response，每一个请求之后绑定一个函数，如果请求没有异常</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@app.after_request</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">process_response1</span>(<span class=\"params\">response</span>):</span></span><br><span class=\"line\">    print(<span class=\"string\">&#x27;process_response1 走了&#x27;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> response</span><br></pre></td></tr></table></figure>\n<h3 id=\"3-before_first_request\"><a class=\"markdownIt-Anchor\" href=\"#3-before_first_request\"></a> 3 before_first_request</h3>\n<p>第一次请求时,跟浏览器无关</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@app.before_first_request</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">first</span>():</span></span><br><span class=\"line\">    <span class=\"keyword\">pass</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"4-teardown_request\"><a class=\"markdownIt-Anchor\" href=\"#4-teardown_request\"></a> 4 teardown_request</h3>\n<p>每一个请求之后绑定一个函数，即使遇到了异常</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@app.teardown_request </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">ter</span>(<span class=\"params\">e</span>):</span></span><br><span class=\"line\">    <span class=\"keyword\">pass</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"5-errorhandler\"><a class=\"markdownIt-Anchor\" href=\"#5-errorhandler\"></a> 5 errorhandler</h3>\n<p>路径不存在时404，服务器内部错误500</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@app.errorhandler(<span class=\"params\"><span class=\"number\">404</span></span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">error_404</span>(<span class=\"params\">arg</span>):</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&quot;404错误了&quot;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"6-template_global\"><a class=\"markdownIt-Anchor\" href=\"#6-template_global\"></a> 6 template_global</h3>\n<p>标签</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@app.template_global()</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">sb</span>(<span class=\"params\">a1, a2</span>):</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> a1 + a2</span><br><span class=\"line\"><span class=\"comment\">#&#123;&#123;sb(1,2)&#125;&#125;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"7-template_filter\"><a class=\"markdownIt-Anchor\" href=\"#7-template_filter\"></a> 7 template_filter</h3>\n<p>过滤器</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@app.template_filter()</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">db</span>(<span class=\"params\">a1, a2, a3</span>):</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> a1 + a2 + a3</span><br><span class=\"line\"><span class=\"comment\">#&#123;&#123; 1|db(2,3)&#125;&#125;</span></span><br></pre></td></tr></table></figure>\n<p>总结：</p>\n<p>1 重点掌握before_request和after_request，</p>\n<p>2 注意有多个的情况，执行顺序</p>\n<p>3 before_request请求拦截后（也就是有return值），response所有都执行</p>\n<h2 id=\"11-中间件了解\"><a class=\"markdownIt-Anchor\" href=\"#11-中间件了解\"></a> 11 中间件（了解）</h2>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> Flask</span><br><span class=\"line\"></span><br><span class=\"line\">app = Flask(__name__)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&#x27;/&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">index</span>():</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&#x27;Hello World!&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># 模拟中间件</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Md</span>(<span class=\"params\"><span class=\"built_in\">object</span></span>):</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span>(<span class=\"params\">self,old_wsgi_app</span>):</span></span><br><span class=\"line\">        self.old_wsgi_app = old_wsgi_app</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__call__</span>(<span class=\"params\">self,  environ, start_response</span>):</span></span><br><span class=\"line\">        print(<span class=\"string\">&#x27;开始之前&#x27;</span>)</span><br><span class=\"line\">        ret = self.old_wsgi_app(environ, start_response)</span><br><span class=\"line\">        print(<span class=\"string\">&#x27;结束之后&#x27;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ret</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    <span class=\"comment\">#1我们发现当执行app.run方法的时候，最终执行run_simple，最后执行app(),也就是在执行app.__call__方法\t</span></span><br><span class=\"line\">    <span class=\"comment\">#2 在__call__里面，执行的是self.wsgi_app().那我们希望在执行他本身的wsgi之前做点事情。</span></span><br><span class=\"line\">    <span class=\"comment\">#3 所以我们先用Md类中__init__，保存之前的wsgi,然后我们用将app.wsgi转化成Md的对象。</span></span><br><span class=\"line\">    <span class=\"comment\">#4 那执行新的的app.wsgi_app，就是执行Md的__call__方法。</span></span><br><span class=\"line\">    <span class=\"comment\">#把原来的wsgi_app替换为自定义的，</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    app.wsgi_app = Md(app.wsgi_app)</span><br><span class=\"line\">    app.run()</span><br></pre></td></tr></table></figure>\n<p>请求所有的流程</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ctx = self.request_context(environ)</span><br><span class=\"line\">\terror = <span class=\"literal\">None</span></span><br><span class=\"line\">    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">        <span class=\"keyword\">try</span>:</span><br><span class=\"line\">            ctx.push()</span><br><span class=\"line\">            <span class=\"comment\">#根据路径去执行视图函数，视图类</span></span><br><span class=\"line\">            response = self.full_dispatch_request()</span><br><span class=\"line\">        <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">            error = e</span><br><span class=\"line\">            response = self.handle_exception(e)</span><br><span class=\"line\">    <span class=\"keyword\">except</span>:  <span class=\"comment\"># noqa: B001</span></span><br><span class=\"line\">        error = sys.exc_info()[<span class=\"number\">1</span>]</span><br><span class=\"line\">        <span class=\"keyword\">raise</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> response(environ, start_response)</span><br><span class=\"line\">    <span class=\"keyword\">finally</span>:</span><br><span class=\"line\">        <span class=\"comment\">#不管出不出异常，都会走这里</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> self.should_ignore_error(error):</span><br><span class=\"line\">            error = <span class=\"literal\">None</span></span><br><span class=\"line\">            ctx.auto_pop(error)</span><br></pre></td></tr></table></figure>\n<h2 id=\"12蓝图\"><a class=\"markdownIt-Anchor\" href=\"#12蓝图\"></a> 12.蓝图</h2>\n<p>对程序进行目录结构划分</p>\n<h3 id=\"不使用蓝图自己分文件\"><a class=\"markdownIt-Anchor\" href=\"#不使用蓝图自己分文件\"></a> 不使用蓝图，自己分文件</h3>\n<p>目录结构：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-templates</span><br><span class=\"line\">-views</span><br><span class=\"line\">\t-__init__.py</span><br><span class=\"line\">    -user.py</span><br><span class=\"line\">    -order.py</span><br><span class=\"line\">-app.py</span><br></pre></td></tr></table></figure>\n<p><a href=\"http://app.py\">app.py</a></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> views <span class=\"keyword\">import</span> app</span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    app.run()</span><br></pre></td></tr></table></figure>\n<p><a href=\"http://init.py\">init.py</a></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> Flask,request</span><br><span class=\"line\">app = Flask(__name__)</span><br><span class=\"line\"><span class=\"comment\">#不导入这个不行</span></span><br><span class=\"line\"><span class=\"keyword\">from</span> . <span class=\"keyword\">import</span> account</span><br><span class=\"line\"><span class=\"keyword\">from</span> . <span class=\"keyword\">import</span> order</span><br><span class=\"line\"><span class=\"keyword\">from</span> . <span class=\"keyword\">import</span> user</span><br></pre></td></tr></table></figure>\n<p><a href=\"http://user.py\">user.py</a></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> . <span class=\"keyword\">import</span> app</span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&#x27;/user&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">user</span>():</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&#x27;user&#x27;</span></span><br></pre></td></tr></table></figure>\n<p><a href=\"http://order.py\">order.py</a></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> . <span class=\"keyword\">import</span> app</span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&#x27;/order&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">order</span>():</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&#x27;order&#x27;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"使用蓝图之中小型系统\"><a class=\"markdownIt-Anchor\" href=\"#使用蓝图之中小型系统\"></a> 使用蓝图之中小型系统</h3>\n<p>详见代码：pro_flask_简单应用程序目录示例.zip</p>\n<p>目录结构：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-flask_pro</span><br><span class=\"line\">\t-flask_test</span><br><span class=\"line\">    \t-__init__.py</span><br><span class=\"line\">    \t-static</span><br><span class=\"line\">        -templates</span><br><span class=\"line\">        -views</span><br><span class=\"line\">        \t-order.py</span><br><span class=\"line\">            -user.py</span><br><span class=\"line\">     -manage.py </span><br><span class=\"line\">        </span><br></pre></td></tr></table></figure>\n<p>_<em>init</em>.py</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span>  Flask</span><br><span class=\"line\">app=Flask(__name__)</span><br><span class=\"line\"><span class=\"keyword\">from</span> flask_test.views <span class=\"keyword\">import</span> user</span><br><span class=\"line\"><span class=\"keyword\">from</span> flask_test.views <span class=\"keyword\">import</span> order</span><br><span class=\"line\">app.register_blueprint(user.us)</span><br><span class=\"line\">app.register_blueprint(order.<span class=\"built_in\">ord</span>)</span><br></pre></td></tr></table></figure>\n<p><a href=\"http://manage.py\">manage.py</a></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> flask_test <span class=\"keyword\">import</span>  app</span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    app.run(port=<span class=\"number\">8008</span>)</span><br></pre></td></tr></table></figure>\n<p><a href=\"http://user.py\">user.py</a></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> Blueprint</span><br><span class=\"line\">us=Blueprint(<span class=\"string\">&#x27;user&#x27;</span>,__name__)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@us.route(<span class=\"params\"><span class=\"string\">&#x27;/login&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">login</span>():</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&#x27;login&#x27;</span></span><br></pre></td></tr></table></figure>\n<p><a href=\"http://order.py\">order.py</a></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> Blueprint</span><br><span class=\"line\"><span class=\"built_in\">ord</span>=Blueprint(<span class=\"string\">&#x27;order&#x27;</span>,__name__)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@ord.route(<span class=\"params\"><span class=\"string\">&#x27;/test&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">test</span>():</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&#x27;order test&#x27;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"使用蓝图之大型系统\"><a class=\"markdownIt-Anchor\" href=\"#使用蓝图之大型系统\"></a> 使用蓝图之大型系统</h3>\n<p>详见代码：pro_flask_大型应用目录示例.zip</p>\n<p>总结：</p>\n<p>1 xxx = Blueprint(‘account’, <strong>name</strong>,url_prefix=’/xxx’) ：蓝图URL前缀，表示url的前缀，在该蓝图下所有url都加前缀</p>\n<p>2 xxx = Blueprint(‘account’, name,url_prefix=’/xxx’,template_folder=‘tpls’)：给当前蓝图单独使用templates，向上查找，当前找不到，会找总templates</p>\n<p>3 蓝图的befort_request，对当前蓝图有效</p>\n<p>4 大型项目，可以模拟出类似于django中app的概念</p>\n<h2 id=\"13请求上下文源码分析\"><a class=\"markdownIt-Anchor\" href=\"#13请求上下文源码分析\"></a> 13.请求上下文源码分析</h2>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">第一阶段：将ctx(request,session)放到Local对象上</span><br><span class=\"line\">\t\t\t\t   </span><br><span class=\"line\">第二阶段：视图函数导入：request/session </span><br><span class=\"line\">request.method</span><br><span class=\"line\">\t-LocalProxy对象.method,执行<span class=\"built_in\">getattr</span>方法，<span class=\"built_in\">getattr</span>(self._get_current_object(), name)</span><br><span class=\"line\">\t\t-self._get_current_object()返回<span class=\"keyword\">return</span> self.__local()，self.__local()，在LocakProxy实例化的时候,<span class=\"built_in\">object</span>.__setattr__(self, <span class=\"string\">&#x27;_LocalProxy__local&#x27;</span>, local),此处local就是：partial(_lookup_req_object, <span class=\"string\">&#x27;request&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">\t-<span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">_lookup_req_object</span>(<span class=\"params\">name</span>):</span></span><br><span class=\"line\">\t\t\ttop = _request_ctx_stack.top <span class=\"comment\">#_request_ctx_stack 就是LocalStack()对象，top方法把ctx取出来</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> top <span class=\"keyword\">is</span> <span class=\"literal\">None</span>:</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">raise</span> RuntimeError(_request_ctx_err_msg)</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"built_in\">getattr</span>(top, name)<span class=\"comment\">#获取ctx中的request或session对象</span></span><br><span class=\"line\"></span><br><span class=\"line\">第三阶段：请求处理完毕</span><br><span class=\"line\">\t\t- 获取session并保存到cookie</span><br><span class=\"line\">\t\t- 将ctx删除</span><br></pre></td></tr></table></figure>\n<p>程序运行，两个LocalStack()对象，一个里面放request和session，另一个放g和<code>current_app</code></p>\n<h2 id=\"14g对象\"><a class=\"markdownIt-Anchor\" href=\"#14g对象\"></a> 14.g对象</h2>\n<p>专门用来存储用户信息的g对象，g的全称的为global</p>\n<p>g对象在一次请求中的所有的代码的地方，都是可以使用的</p>\n<h3 id=\"g对象和session的区别\"><a class=\"markdownIt-Anchor\" href=\"#g对象和session的区别\"></a> g对象和session的区别</h3>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">session对象是可以跨request的，只要session还未失效，不同的request的请求会获取到同一个session，但是g对象不是，g对象不需要管过期时间，请求一次就g对象就改变了一次，或者重新赋值了一次</span><br></pre></td></tr></table></figure>\n<h2 id=\"15flask-session\"><a class=\"markdownIt-Anchor\" href=\"#15flask-session\"></a> 15.flask-session</h2>\n<p>作用：将默认保存的签名cookie中的值 保存到 redis/memcached/file/Mongodb/SQLAlchemy</p>\n<p>安装：pip3 install flask-session</p>\n<p>使用1：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> Flask,session</span><br><span class=\"line\"><span class=\"keyword\">from</span> flask_session <span class=\"keyword\">import</span> RedisSessionInterface</span><br><span class=\"line\"><span class=\"keyword\">import</span> redis</span><br><span class=\"line\">app = Flask(__name__)</span><br><span class=\"line\">conn=redis.Redis(host=<span class=\"string\">&#x27;127.0.0.1&#x27;</span>,port=<span class=\"number\">6379</span>)</span><br><span class=\"line\"><span class=\"comment\">#use_signer是否对key签名</span></span><br><span class=\"line\">app.session_interface=RedisSessionInterface(conn,key_prefix=<span class=\"string\">&#x27;lqz&#x27;</span>)</span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&#x27;/&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">hello_world</span>():</span></span><br><span class=\"line\">    session[<span class=\"string\">&#x27;name&#x27;</span>]=<span class=\"string\">&#x27;lqz&#x27;</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&#x27;Hello World!&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    app.run()</span><br></pre></td></tr></table></figure>\n<p>使用2：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> redis <span class=\"keyword\">import</span> Redis</span><br><span class=\"line\"><span class=\"keyword\">from</span> flask.ext.session <span class=\"keyword\">import</span> Session</span><br><span class=\"line\">app.config[<span class=\"string\">&#x27;SESSION_TYPE&#x27;</span>] = <span class=\"string\">&#x27;redis&#x27;</span></span><br><span class=\"line\">app.config[<span class=\"string\">&#x27;SESSION_REDIS&#x27;</span>] = Redis(host=<span class=\"string\">&#x27;192.168.0.94&#x27;</span>,port=<span class=\"string\">&#x27;6379&#x27;</span>)</span><br><span class=\"line\">Session(app)</span><br></pre></td></tr></table></figure>\n<p>问题：设置cookie时，如何设定关闭浏览器则cookie失效。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">response.set_cookie(<span class=\"string\">&#x27;k&#x27;</span>,<span class=\"string\">&#x27;v&#x27;</span>,exipre=<span class=\"literal\">None</span>)<span class=\"comment\">#这样设置即可</span></span><br><span class=\"line\"><span class=\"comment\">#在session中设置</span></span><br><span class=\"line\">app.session_interface=RedisSessionInterface(conn,key_prefix=<span class=\"string\">&#x27;lqz&#x27;</span>,permanent=<span class=\"literal\">False</span>)</span><br><span class=\"line\"><span class=\"comment\">#一般不用，我们一般都设置超时时间，多长时间后失效</span></span><br></pre></td></tr></table></figure>\n<p>问题：cookie默认超时时间是多少？如何设置超时时间</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#源码expires = self.get_expiration_time(app, session)</span></span><br><span class=\"line\"><span class=\"string\">&#x27;PERMANENT_SESSION_LIFETIME&#x27;</span>:           timedelta(days=<span class=\"number\">31</span>),<span class=\"comment\">#这个配置文件控制</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"16数据库连接池\"><a class=\"markdownIt-Anchor\" href=\"#16数据库连接池\"></a> 16.数据库连接池</h2>\n<h3 id=\"pymsql链接数据库\"><a class=\"markdownIt-Anchor\" href=\"#pymsql链接数据库\"></a> pymsql链接数据库</h3>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> pymysql</span><br><span class=\"line\"></span><br><span class=\"line\">conn = pymysql.connect(host=<span class=\"string\">&#x27;127.0.0.1&#x27;</span>, port=<span class=\"number\">3306</span>, user=<span class=\"string\">&#x27;root&#x27;</span>, passwd=<span class=\"string\">&#x27;123456&#x27;</span>, db=<span class=\"string\">&#x27;s8day127db&#x27;</span>)</span><br><span class=\"line\">cursor = conn.cursor(cursor=pymysql.cursors.DictCursor)</span><br><span class=\"line\"><span class=\"comment\"># cursor.execute(&quot;select id,name from users where name=%s and pwd=%s&quot;,[&#x27;lqz&#x27;,&#x27;123&#x27;,])</span></span><br><span class=\"line\">cursor.execute(<span class=\"string\">&quot;select id,name from users where name=%(user)s and pwd=%(pwd)s&quot;</span>,&#123;<span class=\"string\">&#x27;user&#x27;</span>:<span class=\"string\">&#x27;lqz&#x27;</span>,<span class=\"string\">&#x27;pwd&#x27;</span>:<span class=\"string\">&#x27;123&#x27;</span>&#125;)</span><br><span class=\"line\">obj = cursor.fetchone()</span><br><span class=\"line\">conn.commit()</span><br><span class=\"line\">cursor.close()</span><br><span class=\"line\">conn.close()</span><br><span class=\"line\"></span><br><span class=\"line\">print(obj)</span><br></pre></td></tr></table></figure>\n<h3 id=\"数据库连接池版\"><a class=\"markdownIt-Anchor\" href=\"#数据库连接池版\"></a> 数据库连接池版</h3>\n<p><a href=\"http://setting.py\">setting.py</a></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> datetime <span class=\"keyword\">import</span> timedelta</span><br><span class=\"line\"><span class=\"keyword\">from</span> redis <span class=\"keyword\">import</span> Redis</span><br><span class=\"line\"><span class=\"keyword\">import</span> pymysql</span><br><span class=\"line\"><span class=\"keyword\">from</span> DBUtils.PooledDB <span class=\"keyword\">import</span> PooledDB, SharedDBConnection</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Config</span>(<span class=\"params\"><span class=\"built_in\">object</span></span>):</span></span><br><span class=\"line\">    DEBUG = <span class=\"literal\">True</span></span><br><span class=\"line\">    SECRET_KEY = <span class=\"string\">&quot;umsuldfsdflskjdf&quot;</span></span><br><span class=\"line\">    PERMANENT_SESSION_LIFETIME = timedelta(minutes=<span class=\"number\">20</span>)</span><br><span class=\"line\">    SESSION_REFRESH_EACH_REQUEST= <span class=\"literal\">True</span></span><br><span class=\"line\">    SESSION_TYPE = <span class=\"string\">&quot;redis&quot;</span></span><br><span class=\"line\">    PYMYSQL_POOL = PooledDB(</span><br><span class=\"line\">        creator=pymysql,  <span class=\"comment\"># 使用链接数据库的模块</span></span><br><span class=\"line\">        maxconnections=<span class=\"number\">6</span>,  <span class=\"comment\"># 连接池允许的最大连接数，0和None表示不限制连接数</span></span><br><span class=\"line\">        mincached=<span class=\"number\">2</span>,  <span class=\"comment\"># 初始化时，链接池中至少创建的空闲的链接，0表示不创建</span></span><br><span class=\"line\">        maxcached=<span class=\"number\">5</span>,  <span class=\"comment\"># 链接池中最多闲置的链接，0和None不限制</span></span><br><span class=\"line\">        maxshared=<span class=\"number\">3</span>,</span><br><span class=\"line\">        <span class=\"comment\"># 链接池中最多共享的链接数量，0和None表示全部共享。PS: 无用，因为pymysql和MySQLdb等模块的 threadsafety都为1，所有值无论设置为多少，_maxcached永远为0，所以永远是所有链接都共享。</span></span><br><span class=\"line\">        blocking=<span class=\"literal\">True</span>,  <span class=\"comment\"># 连接池中如果没有可用连接后，是否阻塞等待。True，等待；False，不等待然后报错</span></span><br><span class=\"line\">        maxusage=<span class=\"literal\">None</span>,  <span class=\"comment\"># 一个链接最多被重复使用的次数，None表示无限制</span></span><br><span class=\"line\">        setsession=[],  <span class=\"comment\"># 开始会话前执行的命令列表。如：[&quot;set datestyle to ...&quot;, &quot;set time zone ...&quot;]</span></span><br><span class=\"line\">        ping=<span class=\"number\">0</span>,</span><br><span class=\"line\">        <span class=\"comment\"># ping MySQL服务端，检查是否服务可用。# 如：0 = None = never, 1 = default = whenever it is requested, 2 = when a cursor is created, 4 = when a query is executed, 7 = always</span></span><br><span class=\"line\">        host=<span class=\"string\">&#x27;127.0.0.1&#x27;</span>,</span><br><span class=\"line\">        port=<span class=\"number\">3306</span>,</span><br><span class=\"line\">        user=<span class=\"string\">&#x27;root&#x27;</span>,</span><br><span class=\"line\">        password=<span class=\"string\">&#x27;123456&#x27;</span>,</span><br><span class=\"line\">        database=<span class=\"string\">&#x27;s8day127db&#x27;</span>,</span><br><span class=\"line\">        charset=<span class=\"string\">&#x27;utf8&#x27;</span></span><br><span class=\"line\">    )</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ProductionConfig</span>(<span class=\"params\">Config</span>):</span></span><br><span class=\"line\">    SESSION_REDIS = Redis(host=<span class=\"string\">&#x27;192.168.0.94&#x27;</span>, port=<span class=\"string\">&#x27;6379&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DevelopmentConfig</span>(<span class=\"params\">Config</span>):</span></span><br><span class=\"line\">    SESSION_REDIS = Redis(host=<span class=\"string\">&#x27;127.0.0.1&#x27;</span>, port=<span class=\"string\">&#x27;6379&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TestingConfig</span>(<span class=\"params\">Config</span>):</span></span><br><span class=\"line\">    <span class=\"keyword\">pass</span></span><br></pre></td></tr></table></figure>\n<p>utils/sql.py</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> pymysql</span><br><span class=\"line\"><span class=\"keyword\">from</span> settings <span class=\"keyword\">import</span> Config</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SQLHelper</span>(<span class=\"params\"><span class=\"built_in\">object</span></span>):</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">    @staticmethod</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">open</span>(<span class=\"params\">cursor</span>):</span></span><br><span class=\"line\">        POOL = Config.PYMYSQL_POOL</span><br><span class=\"line\">        conn = POOL.connection()</span><br><span class=\"line\">        cursor = conn.cursor(cursor=cursor)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> conn,cursor</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">    @staticmethod</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">close</span>(<span class=\"params\">conn,cursor</span>):</span></span><br><span class=\"line\">        conn.commit()</span><br><span class=\"line\">        cursor.close()</span><br><span class=\"line\">        conn.close()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">    @classmethod</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">fetch_one</span>(<span class=\"params\">cls,sql,args,cursor =pymysql.cursors.DictCursor</span>):</span></span><br><span class=\"line\">        conn,cursor = cls.<span class=\"built_in\">open</span>(cursor)</span><br><span class=\"line\">        cursor.execute(sql, args)</span><br><span class=\"line\">        obj = cursor.fetchone()</span><br><span class=\"line\">        cls.close(conn,cursor)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> obj</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">    @classmethod</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">fetch_all</span>(<span class=\"params\">cls,sql, args,cursor =pymysql.cursors.DictCursor</span>):</span></span><br><span class=\"line\">        conn, cursor = cls.<span class=\"built_in\">open</span>(cursor)</span><br><span class=\"line\">        cursor.execute(sql, args)</span><br><span class=\"line\">        obj = cursor.fetchall()</span><br><span class=\"line\">        cls.close(conn, cursor)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> obj</span><br></pre></td></tr></table></figure>\n<p>使用：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">obj = SQLHelper.fetch_one(<span class=\"string\">&quot;select id,name from users where name=%(user)s and pwd=%(pwd)s&quot;</span>, form.data)</span><br></pre></td></tr></table></figure>\n<h2 id=\"17wtforms\"><a class=\"markdownIt-Anchor\" href=\"#17wtforms\"></a> 17.wtforms</h2>\n<p>安装:pip3 install wtforms</p>\n<h3 id=\"使用1\"><a class=\"markdownIt-Anchor\" href=\"#使用1\"></a> 使用1：</h3>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> Flask, render_template, request, redirect</span><br><span class=\"line\"><span class=\"keyword\">from</span> wtforms <span class=\"keyword\">import</span> Form</span><br><span class=\"line\"><span class=\"keyword\">from</span> wtforms.fields <span class=\"keyword\">import</span> simple</span><br><span class=\"line\"><span class=\"keyword\">from</span> wtforms <span class=\"keyword\">import</span> validators</span><br><span class=\"line\"><span class=\"keyword\">from</span> wtforms <span class=\"keyword\">import</span> widgets</span><br><span class=\"line\"></span><br><span class=\"line\">app = Flask(__name__, template_folder=<span class=\"string\">&#x27;templates&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">app.debug = <span class=\"literal\">True</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">LoginForm</span>(<span class=\"params\">Form</span>):</span></span><br><span class=\"line\">    <span class=\"comment\"># 字段（内部包含正则表达式）</span></span><br><span class=\"line\">    name = simple.StringField(</span><br><span class=\"line\">        label=<span class=\"string\">&#x27;用户名&#x27;</span>,</span><br><span class=\"line\">        validators=[</span><br><span class=\"line\">            validators.DataRequired(message=<span class=\"string\">&#x27;用户名不能为空.&#x27;</span>),</span><br><span class=\"line\">            validators.Length(<span class=\"built_in\">min</span>=<span class=\"number\">6</span>, <span class=\"built_in\">max</span>=<span class=\"number\">18</span>, message=<span class=\"string\">&#x27;用户名长度必须大于%(min)d且小于%(max)d&#x27;</span>)</span><br><span class=\"line\">        ],</span><br><span class=\"line\">        widget=widgets.TextInput(), <span class=\"comment\"># 页面上显示的插件</span></span><br><span class=\"line\">        render_kw=&#123;<span class=\"string\">&#x27;class&#x27;</span>: <span class=\"string\">&#x27;form-control&#x27;</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    )</span><br><span class=\"line\">    <span class=\"comment\"># 字段（内部包含正则表达式）</span></span><br><span class=\"line\">    pwd = simple.PasswordField(</span><br><span class=\"line\">        label=<span class=\"string\">&#x27;密码&#x27;</span>,</span><br><span class=\"line\">        validators=[</span><br><span class=\"line\">            validators.DataRequired(message=<span class=\"string\">&#x27;密码不能为空.&#x27;</span>),</span><br><span class=\"line\">            validators.Length(<span class=\"built_in\">min</span>=<span class=\"number\">8</span>, message=<span class=\"string\">&#x27;用户名长度必须大于%(min)d&#x27;</span>),</span><br><span class=\"line\">            validators.Regexp(regex=<span class=\"string\">&quot;^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)(?=.*[$@$!%*?&amp;])[A-Za-z\\d$@$!%*?&amp;]&#123;8,&#125;&quot;</span>,</span><br><span class=\"line\">                              message=<span class=\"string\">&#x27;密码至少8个字符，至少1个大写字母，1个小写字母，1个数字和1个特殊字符&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">        ],</span><br><span class=\"line\">        widget=widgets.PasswordInput(),</span><br><span class=\"line\">        render_kw=&#123;<span class=\"string\">&#x27;class&#x27;</span>: <span class=\"string\">&#x27;form-control&#x27;</span>&#125;</span><br><span class=\"line\">    )</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&#x27;/login&#x27;</span>, methods=[<span class=\"string\">&#x27;GET&#x27;</span>, <span class=\"string\">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">login</span>():</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> request.method == <span class=\"string\">&#x27;GET&#x27;</span>:</span><br><span class=\"line\">        form = LoginForm()</span><br><span class=\"line\">        <span class=\"keyword\">return</span> render_template(<span class=\"string\">&#x27;login.html&#x27;</span>, form=form)</span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        form = LoginForm(formdata=request.form)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> form.validate():</span><br><span class=\"line\">            print(<span class=\"string\">&#x27;用户提交数据通过格式验证，提交的值为：&#x27;</span>, form.data)</span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            print(form.errors)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> render_template(<span class=\"string\">&#x27;login.html&#x27;</span>, form=form)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    app.run()</span><br></pre></td></tr></table></figure>\n<p>login.html</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Title<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>登录<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">form</span> <span class=\"attr\">method</span>=<span class=\"string\">&quot;post&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>&#123;&#123;form.name.label&#125;&#125; &#123;&#123;form.name&#125;&#125; &#123;&#123;form.name.errors[0] &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>&#123;&#123;form.pwd.label&#125;&#125; &#123;&#123;form.pwd&#125;&#125; &#123;&#123;form.pwd.errors[0] &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;submit&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;提交&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">form</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"使用2\"><a class=\"markdownIt-Anchor\" href=\"#使用2\"></a> 使用2：</h3>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> Flask, render_template, request, redirect</span><br><span class=\"line\"><span class=\"keyword\">from</span> wtforms <span class=\"keyword\">import</span> Form</span><br><span class=\"line\"><span class=\"keyword\">from</span> wtforms.fields <span class=\"keyword\">import</span> core</span><br><span class=\"line\"><span class=\"keyword\">from</span> wtforms.fields <span class=\"keyword\">import</span> html5</span><br><span class=\"line\"><span class=\"keyword\">from</span> wtforms.fields <span class=\"keyword\">import</span> simple</span><br><span class=\"line\"><span class=\"keyword\">from</span> wtforms <span class=\"keyword\">import</span> validators</span><br><span class=\"line\"><span class=\"keyword\">from</span> wtforms <span class=\"keyword\">import</span> widgets</span><br><span class=\"line\"></span><br><span class=\"line\">app = Flask(__name__, template_folder=<span class=\"string\">&#x27;templates&#x27;</span>)</span><br><span class=\"line\">app.debug = <span class=\"literal\">True</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">RegisterForm</span>(<span class=\"params\">Form</span>):</span></span><br><span class=\"line\">    name = simple.StringField(</span><br><span class=\"line\">        label=<span class=\"string\">&#x27;用户名&#x27;</span>,</span><br><span class=\"line\">        validators=[</span><br><span class=\"line\">            validators.DataRequired()</span><br><span class=\"line\">        ],</span><br><span class=\"line\">        widget=widgets.TextInput(),</span><br><span class=\"line\">        render_kw=&#123;<span class=\"string\">&#x27;class&#x27;</span>: <span class=\"string\">&#x27;form-control&#x27;</span>&#125;,</span><br><span class=\"line\">        default=<span class=\"string\">&#x27;alex&#x27;</span></span><br><span class=\"line\">    )</span><br><span class=\"line\"></span><br><span class=\"line\">    pwd = simple.PasswordField(</span><br><span class=\"line\">        label=<span class=\"string\">&#x27;密码&#x27;</span>,</span><br><span class=\"line\">        validators=[</span><br><span class=\"line\">            validators.DataRequired(message=<span class=\"string\">&#x27;密码不能为空.&#x27;</span>)</span><br><span class=\"line\">        ],</span><br><span class=\"line\">        widget=widgets.PasswordInput(),</span><br><span class=\"line\">        render_kw=&#123;<span class=\"string\">&#x27;class&#x27;</span>: <span class=\"string\">&#x27;form-control&#x27;</span>&#125;</span><br><span class=\"line\">    )</span><br><span class=\"line\"></span><br><span class=\"line\">    pwd_confirm = simple.PasswordField(</span><br><span class=\"line\">        label=<span class=\"string\">&#x27;重复密码&#x27;</span>,</span><br><span class=\"line\">        validators=[</span><br><span class=\"line\">            validators.DataRequired(message=<span class=\"string\">&#x27;重复密码不能为空.&#x27;</span>),</span><br><span class=\"line\">            validators.EqualTo(<span class=\"string\">&#x27;pwd&#x27;</span>, message=<span class=\"string\">&quot;两次密码输入不一致&quot;</span>)</span><br><span class=\"line\">        ],</span><br><span class=\"line\">        widget=widgets.PasswordInput(),</span><br><span class=\"line\">        render_kw=&#123;<span class=\"string\">&#x27;class&#x27;</span>: <span class=\"string\">&#x27;form-control&#x27;</span>&#125;</span><br><span class=\"line\">    )</span><br><span class=\"line\"></span><br><span class=\"line\">    email = html5.EmailField(</span><br><span class=\"line\">        label=<span class=\"string\">&#x27;邮箱&#x27;</span>,</span><br><span class=\"line\">        validators=[</span><br><span class=\"line\">            validators.DataRequired(message=<span class=\"string\">&#x27;邮箱不能为空.&#x27;</span>),</span><br><span class=\"line\">            validators.Email(message=<span class=\"string\">&#x27;邮箱格式错误&#x27;</span>)</span><br><span class=\"line\">        ],</span><br><span class=\"line\">        widget=widgets.TextInput(input_type=<span class=\"string\">&#x27;email&#x27;</span>),</span><br><span class=\"line\">        render_kw=&#123;<span class=\"string\">&#x27;class&#x27;</span>: <span class=\"string\">&#x27;form-control&#x27;</span>&#125;</span><br><span class=\"line\">    )</span><br><span class=\"line\"></span><br><span class=\"line\">    gender = core.RadioField(</span><br><span class=\"line\">        label=<span class=\"string\">&#x27;性别&#x27;</span>,</span><br><span class=\"line\">        choices=(</span><br><span class=\"line\">            (<span class=\"number\">1</span>, <span class=\"string\">&#x27;男&#x27;</span>),</span><br><span class=\"line\">            (<span class=\"number\">2</span>, <span class=\"string\">&#x27;女&#x27;</span>),</span><br><span class=\"line\">        ),</span><br><span class=\"line\">        coerce=<span class=\"built_in\">int</span> <span class=\"comment\"># “1” “2”</span></span><br><span class=\"line\">     )</span><br><span class=\"line\">    city = core.SelectField(</span><br><span class=\"line\">        label=<span class=\"string\">&#x27;城市&#x27;</span>,</span><br><span class=\"line\">        choices=(</span><br><span class=\"line\">            (<span class=\"string\">&#x27;bj&#x27;</span>, <span class=\"string\">&#x27;北京&#x27;</span>),</span><br><span class=\"line\">            (<span class=\"string\">&#x27;sh&#x27;</span>, <span class=\"string\">&#x27;上海&#x27;</span>),</span><br><span class=\"line\">        )</span><br><span class=\"line\">    )</span><br><span class=\"line\"></span><br><span class=\"line\">    hobby = core.SelectMultipleField(</span><br><span class=\"line\">        label=<span class=\"string\">&#x27;爱好&#x27;</span>,</span><br><span class=\"line\">        choices=(</span><br><span class=\"line\">            (<span class=\"number\">1</span>, <span class=\"string\">&#x27;篮球&#x27;</span>),</span><br><span class=\"line\">            (<span class=\"number\">2</span>, <span class=\"string\">&#x27;足球&#x27;</span>),</span><br><span class=\"line\">        ),</span><br><span class=\"line\">        coerce=<span class=\"built_in\">int</span></span><br><span class=\"line\">    )</span><br><span class=\"line\"></span><br><span class=\"line\">    favor = core.SelectMultipleField(</span><br><span class=\"line\">        label=<span class=\"string\">&#x27;喜好&#x27;</span>,</span><br><span class=\"line\">        choices=(</span><br><span class=\"line\">            (<span class=\"number\">1</span>, <span class=\"string\">&#x27;篮球&#x27;</span>),</span><br><span class=\"line\">            (<span class=\"number\">2</span>, <span class=\"string\">&#x27;足球&#x27;</span>),</span><br><span class=\"line\">        ),</span><br><span class=\"line\">        widget=widgets.ListWidget(prefix_label=<span class=\"literal\">False</span>),</span><br><span class=\"line\">        option_widget=widgets.CheckboxInput(),</span><br><span class=\"line\">        coerce=<span class=\"built_in\">int</span>,</span><br><span class=\"line\">        default=[<span class=\"number\">1</span>, <span class=\"number\">2</span>]</span><br><span class=\"line\">    )</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span>(<span class=\"params\">self, *args, **kwargs</span>):</span></span><br><span class=\"line\">        <span class=\"built_in\">super</span>(RegisterForm, self).__init__(*args, **kwargs)</span><br><span class=\"line\">        self.favor.choices = ((<span class=\"number\">1</span>, <span class=\"string\">&#x27;篮球&#x27;</span>), (<span class=\"number\">2</span>, <span class=\"string\">&#x27;足球&#x27;</span>), (<span class=\"number\">3</span>, <span class=\"string\">&#x27;羽毛球&#x27;</span>))</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">validate_pwd_confirm</span>(<span class=\"params\">self, field</span>):</span></span><br><span class=\"line\">        <span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">        自定义pwd_confirm字段规则，例：与pwd字段是否一致</span></span><br><span class=\"line\"><span class=\"string\">        :param field:</span></span><br><span class=\"line\"><span class=\"string\">        :return:</span></span><br><span class=\"line\"><span class=\"string\">        &quot;&quot;&quot;</span></span><br><span class=\"line\">        <span class=\"comment\"># 最开始初始化时，self.data中已经有所有的值</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> field.data != self.data[<span class=\"string\">&#x27;pwd&#x27;</span>]:</span><br><span class=\"line\">            <span class=\"comment\"># raise validators.ValidationError(&quot;密码不一致&quot;) # 继续后续验证</span></span><br><span class=\"line\">            <span class=\"keyword\">raise</span> validators.StopValidation(<span class=\"string\">&quot;密码不一致&quot;</span>)  <span class=\"comment\"># 不再继续后续验证</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&#x27;/register&#x27;</span>, methods=[<span class=\"string\">&#x27;GET&#x27;</span>, <span class=\"string\">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">register</span>():</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> request.method == <span class=\"string\">&#x27;GET&#x27;</span>:</span><br><span class=\"line\">        form = RegisterForm(data=&#123;<span class=\"string\">&#x27;gender&#x27;</span>: <span class=\"number\">2</span>,<span class=\"string\">&#x27;hobby&#x27;</span>:[<span class=\"number\">1</span>,]&#125;) <span class=\"comment\"># initial</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> render_template(<span class=\"string\">&#x27;register.html&#x27;</span>, form=form)</span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        form = RegisterForm(formdata=request.form)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> form.validate():</span><br><span class=\"line\">            print(<span class=\"string\">&#x27;用户提交数据通过格式验证，提交的值为：&#x27;</span>, form.data)</span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            print(form.errors)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> render_template(<span class=\"string\">&#x27;register.html&#x27;</span>, form=form)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    app.run()</span><br><span class=\"line\">&lt;!DOCTYPE html&gt;</span><br><span class=\"line\">&lt;html lang=<span class=\"string\">&quot;en&quot;</span>&gt;</span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\">    &lt;meta charset=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span><br><span class=\"line\">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class=\"line\">&lt;/head&gt;</span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">&lt;h1&gt;用户注册&lt;/h1&gt;</span><br><span class=\"line\">&lt;form method=<span class=\"string\">&quot;post&quot;</span> novalidate style=<span class=\"string\">&quot;padding:0  50px&quot;</span>&gt;</span><br><span class=\"line\">    &#123;% <span class=\"keyword\">for</span> field <span class=\"keyword\">in</span> form %&#125;</span><br><span class=\"line\">    &lt;p&gt;&#123;&#123;field.label&#125;&#125;: &#123;&#123;field&#125;&#125; &#123;&#123;field.errors[0] &#125;&#125;&lt;/p&gt;</span><br><span class=\"line\">    &#123;% endfor %&#125;</span><br><span class=\"line\">    &lt;<span class=\"built_in\">input</span> <span class=\"built_in\">type</span>=<span class=\"string\">&quot;submit&quot;</span> value=<span class=\"string\">&quot;提交&quot;</span>&gt;</span><br><span class=\"line\">&lt;/form&gt;</span><br><span class=\"line\">&lt;/body&gt;</span><br><span class=\"line\">&lt;/html&gt;</span><br></pre></td></tr></table></figure>\n<h2 id=\"18信号\"><a class=\"markdownIt-Anchor\" href=\"#18信号\"></a> 18.信号</h2>\n<p>Flask框架中的信号基于blinker，其主要就是让开发者可是在flask请求过程中定制一些用户行为</p>\n<p>安装：<code>pip3 install blinker</code></p>\n<p>内置信号：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">request_started = _signals.signal(<span class=\"string\">&#x27;request-started&#x27;</span>)                <span class=\"comment\"># 请求到来前执行</span></span><br><span class=\"line\">request_finished = _signals.signal(<span class=\"string\">&#x27;request-finished&#x27;</span>)              <span class=\"comment\"># 请求结束后执行</span></span><br><span class=\"line\"> </span><br><span class=\"line\">before_render_template = _signals.signal(<span class=\"string\">&#x27;before-render-template&#x27;</span>)  <span class=\"comment\"># 模板渲染前执行</span></span><br><span class=\"line\">template_rendered = _signals.signal(<span class=\"string\">&#x27;template-rendered&#x27;</span>)            <span class=\"comment\"># 模板渲染后执行</span></span><br><span class=\"line\"> </span><br><span class=\"line\">got_request_exception = _signals.signal(<span class=\"string\">&#x27;got-request-exception&#x27;</span>)    <span class=\"comment\"># 请求执行出现异常时执行</span></span><br><span class=\"line\"> </span><br><span class=\"line\">request_tearing_down = _signals.signal(<span class=\"string\">&#x27;request-tearing-down&#x27;</span>)      <span class=\"comment\"># 请求执行完毕后自动执行（无论成功与否）</span></span><br><span class=\"line\">appcontext_tearing_down = _signals.signal(<span class=\"string\">&#x27;appcontext-tearing-down&#x27;</span>)<span class=\"comment\"># 应用上下文执行完毕后自动执行（无论成功与否）</span></span><br><span class=\"line\"> </span><br><span class=\"line\">appcontext_pushed = _signals.signal(<span class=\"string\">&#x27;appcontext-pushed&#x27;</span>)            <span class=\"comment\"># 应用上下文push时执行</span></span><br><span class=\"line\">appcontext_popped = _signals.signal(<span class=\"string\">&#x27;appcontext-popped&#x27;</span>)            <span class=\"comment\"># 应用上下文pop时执行</span></span><br><span class=\"line\">message_flashed = _signals.signal(<span class=\"string\">&#x27;message-flashed&#x27;</span>)                <span class=\"comment\"># 调用flask在其中添加数据时，自动触发</span></span><br></pre></td></tr></table></figure>\n<p>使用信号：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> Flask,signals,render_template</span><br><span class=\"line\"></span><br><span class=\"line\">app = Flask(__name__)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 往信号中注册函数</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">func</span>(<span class=\"params\">*args,**kwargs</span>):</span></span><br><span class=\"line\">    print(<span class=\"string\">&#x27;触发型号&#x27;</span>,args,kwargs)</span><br><span class=\"line\">signals.request_started.connect(func)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 触发信号： signals.request_started.send()</span></span><br><span class=\"line\"><span class=\"meta\">@app.before_first_request</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">before_first1</span>(<span class=\"params\">*args,**kwargs</span>):</span></span><br><span class=\"line\">    <span class=\"keyword\">pass</span></span><br><span class=\"line\"><span class=\"meta\">@app.before_first_request</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">before_first2</span>(<span class=\"params\">*args,**kwargs</span>):</span></span><br><span class=\"line\">    <span class=\"keyword\">pass</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.before_request</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">before_first3</span>(<span class=\"params\">*args,**kwargs</span>):</span></span><br><span class=\"line\">    <span class=\"keyword\">pass</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&#x27;/&#x27;</span>,methods=[<span class=\"string\">&#x27;GET&#x27;</span>,<span class=\"string\">&quot;POST&quot;</span>]</span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">index</span>():</span></span><br><span class=\"line\">    print(<span class=\"string\">&#x27;视图&#x27;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> render_template(<span class=\"string\">&#x27;index.html&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    app.wsgi_app</span><br><span class=\"line\">    app.run()</span><br></pre></td></tr></table></figure>\n<p>一个流程中的信号触发点（了解）</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a. before_first_request</span><br><span class=\"line\">b. 触发 request_started 信号</span><br><span class=\"line\">c. before_request</span><br><span class=\"line\">d. 模板渲染</span><br><span class=\"line\">\t渲染前的信号 before_render_template.send(app, template=template, context=context)</span><br><span class=\"line\">\t\trv = template.render(context) <span class=\"comment\"># 模板渲染</span></span><br><span class=\"line\">\t渲染后的信号 template_rendered.send(app, template=template, context=context)</span><br><span class=\"line\">e. after_request</span><br><span class=\"line\">f. session.save_session()</span><br><span class=\"line\">g. 触发 request_finished信号\t\t</span><br><span class=\"line\">\t如果上述过程出错：</span><br><span class=\"line\">\t\t触发错误处理信号 got_request_exception.send(self, exception=e)</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">h. 触发信号 request_tearing_down</span><br></pre></td></tr></table></figure>\n<p>自定义信号(了解)：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> Flask, current_app, flash, render_template</span><br><span class=\"line\"><span class=\"keyword\">from</span> flask.signals <span class=\"keyword\">import</span> _signals</span><br><span class=\"line\">app = Flask(import_name=__name__)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 自定义信号</span></span><br><span class=\"line\">xxxxx = _signals.signal(<span class=\"string\">&#x27;xxxxx&#x27;</span>)</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">func</span>(<span class=\"params\">sender, *args, **kwargs</span>):</span></span><br><span class=\"line\">    print(sender)</span><br><span class=\"line\"><span class=\"comment\"># 自定义信号中注册函数</span></span><br><span class=\"line\">xxxxx.connect(func)</span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&quot;/x&quot;</span></span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">index</span>():</span></span><br><span class=\"line\">    <span class=\"comment\"># 触发信号</span></span><br><span class=\"line\">    xxxxx.send(<span class=\"string\">&#x27;123123&#x27;</span>, k1=<span class=\"string\">&#x27;v1&#x27;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&#x27;Index&#x27;</span> </span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    app.run()</span><br></pre></td></tr></table></figure>\n<h2 id=\"19多app应用\"><a class=\"markdownIt-Anchor\" href=\"#19多app应用\"></a> 19.多app应用</h2>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> werkzeug.wsgi <span class=\"keyword\">import</span> DispatcherMiddleware</span><br><span class=\"line\"><span class=\"keyword\">from</span> werkzeug.serving <span class=\"keyword\">import</span> run_simple</span><br><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> Flask, current_app</span><br><span class=\"line\">app1 = Flask(<span class=\"string\">&#x27;app01&#x27;</span>)</span><br><span class=\"line\">app2 = Flask(<span class=\"string\">&#x27;app02&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app1.route(<span class=\"params\"><span class=\"string\">&#x27;/index&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">index</span>():</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&quot;app01&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app2.route(<span class=\"params\"><span class=\"string\">&#x27;/index2&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">index2</span>():</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&quot;app2&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># http://www.oldboyedu.com/index</span></span><br><span class=\"line\"><span class=\"comment\"># http://www.oldboyedu.com/sec/index2</span></span><br><span class=\"line\">dm = DispatcherMiddleware(app1, &#123;</span><br><span class=\"line\">    <span class=\"string\">&#x27;/sec&#x27;</span>: app2,</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&quot;__main__&quot;</span>:</span><br><span class=\"line\">    run_simple(<span class=\"string\">&#x27;localhost&#x27;</span>, <span class=\"number\">5000</span>, dm)</span><br></pre></td></tr></table></figure>\n<h2 id=\"20flask-script\"><a class=\"markdownIt-Anchor\" href=\"#20flask-script\"></a> 20.flask-script</h2>\n<p>用于实现类似于django中 python3 <a href=\"http://manage.py\">manage.py</a> runserver …类似的命令</p>\n<p>安装：pip3 install flask-script</p>\n<h3 id=\"使用\"><a class=\"markdownIt-Anchor\" href=\"#使用\"></a> 使用</h3>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> flask_script <span class=\"keyword\">import</span> Manager</span><br><span class=\"line\">app = Flask(__name__)</span><br><span class=\"line\">manager=Manager(app)</span><br><span class=\"line\">...</span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    manager.run()</span><br><span class=\"line\"><span class=\"comment\">#以后在执行，直接：python3 manage.py runserver</span></span><br><span class=\"line\"><span class=\"comment\">#python3 manage.py runserver --help</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"自定制命令\"><a class=\"markdownIt-Anchor\" href=\"#自定制命令\"></a> 自定制命令</h3>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@manager.command</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">custom</span>(<span class=\"params\">arg</span>):</span></span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">    自定义命令</span></span><br><span class=\"line\"><span class=\"string\">    python manage.py custom 123</span></span><br><span class=\"line\"><span class=\"string\">    :param arg:</span></span><br><span class=\"line\"><span class=\"string\">    :return:</span></span><br><span class=\"line\"><span class=\"string\">    &quot;&quot;&quot;</span></span><br><span class=\"line\">    print(arg)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@manager.option(<span class=\"params\"><span class=\"string\">&#x27;-n&#x27;</span>, <span class=\"string\">&#x27;--name&#x27;</span>, dest=<span class=\"string\">&#x27;name&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"comment\">#@manager.option(&#x27;-u&#x27;, &#x27;--url&#x27;, dest=&#x27;url&#x27;)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">cmd</span>(<span class=\"params\">name, url</span>):</span></span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">    自定义命令（-n也可以写成--name）</span></span><br><span class=\"line\"><span class=\"string\">    执行： python manage.py  cmd -n lqz -u http://www.oldboyedu.com</span></span><br><span class=\"line\"><span class=\"string\">    执行： python manage.py  cmd --name lqz --url http://www.oldboyedu.com</span></span><br><span class=\"line\"><span class=\"string\">    :param name:</span></span><br><span class=\"line\"><span class=\"string\">    :param url:</span></span><br><span class=\"line\"><span class=\"string\">    :return:</span></span><br><span class=\"line\"><span class=\"string\">    &quot;&quot;&quot;</span></span><br><span class=\"line\">    print(name, url)</span><br><span class=\"line\"><span class=\"comment\">#有什么用？</span></span><br><span class=\"line\"><span class=\"comment\">#把excel的数据导入数据库，定制个命令，去执行</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"21flask-admin\"><a class=\"markdownIt-Anchor\" href=\"#21flask-admin\"></a> 21flask-admin</h2>\n<h4 id=\"安装\"><a class=\"markdownIt-Anchor\" href=\"#安装\"></a> 安装</h4>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip3 install flask_admin</span><br></pre></td></tr></table></figure>\n<h4 id=\"简单使用\"><a class=\"markdownIt-Anchor\" href=\"#简单使用\"></a> 简单使用</h4>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> Flask</span><br><span class=\"line\"><span class=\"keyword\">from</span> flask_admin <span class=\"keyword\">import</span> Admin</span><br><span class=\"line\"></span><br><span class=\"line\">app = Flask(__name__)</span><br><span class=\"line\"><span class=\"comment\">#将app注册到adminzhong </span></span><br><span class=\"line\">admin = Admin(app)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__==<span class=\"string\">&quot;mian&quot;</span>:</span><br><span class=\"line\"></span><br><span class=\"line\">\tapp.run()</span><br><span class=\"line\"><span class=\"comment\">#访问</span></span><br><span class=\"line\"><span class=\"comment\">#127.0.0.1:5000/admin端口，会得到一个空白的页面</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"将表模型注册到admin中\"><a class=\"markdownIt-Anchor\" href=\"#将表模型注册到admin中\"></a> 将表模型注册到admin中</h4>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#在将表注册之前应该对app进行配置</span></span><br><span class=\"line\">SQLALCHEMY_DATABASE_URI = <span class=\"string\">&quot;mysql+pymysql://root:@127.0.0.1:3307/py9api?charset=utf8mb4&quot;</span></span><br><span class=\"line\">SQLALCHEMY_POOL_SIZE = <span class=\"number\">5</span></span><br><span class=\"line\">SQLALCHEMY_POOL_TIMEOUT = <span class=\"number\">30</span></span><br><span class=\"line\">SQLALCHEMY_POOL_RECYCLE = -<span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#导入models文件的中的表模型</span></span><br><span class=\"line\"><span class=\"keyword\">from</span> flask_admin.contrib.sqla <span class=\"keyword\">import</span> ModelView</span><br><span class=\"line\"><span class=\"keyword\">from</span> api.models <span class=\"keyword\">import</span> Stock,Product,Images,Category,Wxuser,Banner</span><br><span class=\"line\"></span><br><span class=\"line\">admin.add_view(ModelView(Stock, db.session))</span><br><span class=\"line\">admin.add_view(ModelView(Product, db.session))</span><br><span class=\"line\"></span><br><span class=\"line\">admin.add_view(ModelView(Category, db.session))</span><br></pre></td></tr></table></figure>\n<h4 id=\"如果有个字段是图片指端\"><a class=\"markdownIt-Anchor\" href=\"#如果有个字段是图片指端\"></a> 如果有个字段是图片指端</h4>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#配置上传文件的路径</span></span><br><span class=\"line\"><span class=\"comment\">#导入from flask_admin.contrib.fileadmin import FileAdmin</span></span><br><span class=\"line\"><span class=\"keyword\">from</span> flask_admin.contrib.fileadmin <span class=\"keyword\">import</span> FileAdmin,form</span><br><span class=\"line\">file_path = op.join(op.dirname(__file__), <span class=\"string\">&#x27;static&#x27;</span>)</span><br><span class=\"line\">admin = Admin(app)</span><br><span class=\"line\">admin.add_view(FileAdmin(file_path, <span class=\"string\">&#x27;/static/&#x27;</span>, name=<span class=\"string\">&#x27;文件&#x27;</span>))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#如果有个字段要是上传文件重写该方法的modleView类，假设imgae_url是文件图片的字段</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ImagesView</span>(<span class=\"params\">ModelView</span>):</span></span><br><span class=\"line\"></span><br><span class=\"line\">    form_extra_fields = &#123;</span><br><span class=\"line\">        <span class=\"string\">&#x27;image_url&#x27;</span>: form.ImageUploadField(<span class=\"string\">&#x27;Image&#x27;</span>,</span><br><span class=\"line\">                                          base_path=file_path,</span><br><span class=\"line\">                                          relative_path=<span class=\"string\">&#x27;uploadFile/&#x27;</span></span><br><span class=\"line\">                                          )</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">admin.add_view(ImagesView(Images, db.session))</span><br></pre></td></tr></table></figure>\n","categories":[{"name":"flask","path":"api/categories/flask.json"}],"tags":[{"name":"flask","path":"api/tags/flask.json"},{"name":"python","path":"api/tags/python.json"}]}